<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head>
  <meta charset="utf-8">
  <meta name="generator" content="quarto-(Local Development)">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <meta name="author" content="neocarto">
  <meta name="dcterms.date" content="2021-02-09">
  <title>Quarto – France Covid-19 Vaccination</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>

  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
  <script src="../../../../site_libs/quarto-nav/headroom.min.js"></script>
  <meta name="quarto:offset" content="../../../../">
  <script src="../../../../site_libs/quarto-search/autocomplete.min.js"></script>
  <script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
  <script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
  <link href="../../../../docs/interactive/js/examples/mens-tennis/mens-tennis.html" rel="next">
  <link href="../../../../docs/interactive/js/examples/passeports-colors.html" rel="prev">
  <script src="../../../../site_libs/quarto-html/quarto.js"></script>
  <script src="../../../../site_libs/quarto-html/popper.min.js"></script>
  <script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
  <script src="../../../../site_libs/quarto-html/clipboard.min.js"></script>
  <script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
  <script src="../../../../site_libs/quarto-html/quarto-html.js"></script>
  <link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
  <link class="quarto-color-scheme" href="../../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
  <link class="quarto-color-scheme quarto-color-alternate" rel="prefetch" href="../../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css">
  <script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
  <link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
  <link class="quarto-color-scheme" href="../../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
  <link class="quarto-color-scheme quarto-color-alternate" rel="prefetch" href="../../../../site_libs/bootstrap/bootstrap-dark.min.css">
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-FV9Z7SDZ0M"></script>

  <script type="text/javascript">

  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-FV9Z7SDZ0M', { 'anonymize_ip': true});
  </script>
  <script type="module" src="../../../../site_libs/quarto-ojs/ojs-bundle.js"></script>
  <link href="../../../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
  <link rel="stylesheet" href="../../../../styles.css">
<meta name="og:title" content="Quarto - France Covid-19 Vaccination">
<meta name="og:description" content="Originally published at: <https://observablehq.com/@neocartocnrs/vaccination-against-covid-19-in-france>">
<meta name="og:image" content="https://quarto.org/quarto.png">
<meta name="og:site-name" content="Quarto">
<meta name="og:image:height" content="152">
<meta name="og:image:width" content="624">
<meta name="twitter:title" content="Quarto - France Covid-19 Vaccination">
<meta name="twitter:description" content="Originally published at: <https://observablehq.com/@neocartocnrs/vaccination-against-covid-19-in-france>">
<meta name="twitter:image" content="https://quarto.org/quarto.png">
<meta name="twitter:image-height" content="152">
<meta name="twitter:image-width" content="624">
<meta name="twitter:card" content="summary_large_image">
</head>
<body>
<div id="quarto-search-results"></div>
<header id="quarto-header" class="headroom fixed-top">
<nav class="navbar navbar-expand-lg navbar-light bg-light ">
    <div class="container-fluid">
  <a class="navbar-brand" href="../../../../index.html">
    <img src="../../../../quarto.png" alt="">
  </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
      <div class="collapse navbar-collapse" id="navbarCollapse">
        <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../index.html">
 Get Started</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../../../../docs/authoring/markdown-basics.html" aria-current="page">
 Using</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../docs/output-formats/html-basics.html">
 Formats</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../docs/projects/quarto-projects.html">
 Projects</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../about.html">
 About</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/quarto-dev/quarto-cli"><i class="bi-github" role="img">
</i> 
 </a>
  </li>  
</ul>
          <div>
            <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;"><i class="bi"></i></a>
          </div>
          <form class="d-flex mb-0">
  <input id="quarto-search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>
      </div> <!-- /navcollapse -->
  </div> <!-- /container-fluid -->
</nav>
<nav class="quarto-secondary-nav py-2 d-lg-none d-md-block " data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <div class="container-fluid d-flex justify-content-between">
    <h1 class="quarto-secondary-nav-title mb-0 fs-3 d-inline">France Covid-19 Vaccination</h1>
    <button type="button" class="quarto-btn-toggle btn d-lg-none py-0 px-1 d-inline-block border-0 ">
      <i class="bi bi-chevron-right"></i>
    </button>
  </div>
</nav>
</header>
 <!-- /navbar/sidebar -->
<div class="container-fluid quarto-container d-flex flex-column page-layout-custom">
<div class="row flex-fill" id="quarto-content">
  <div id="quarto-sidebar" class="col col-12 col-lg-3 d-lg-flex px-0 pt-0 sidebar collapse sidebar-navigation">
    <nav class="me-lg-auto py-2 docked  overflow-scroll">
  <div class="sidebar-menu-container"> 
  <ul class="list-unstyled mt-3 px-3">
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto ">
            <a class="sidebar-section-item d-inline-flex text-start w-100 " data-bs-toggle="collapse" data-bs-target="#authoring-collapse" aria-expanded="true">
              <div class="me-auto  sidebar-section-item">Authoring</div>
            <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
        </div>
      <div class="collapse  show" id="authoring-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../../../../docs/authoring/markdown-basics.html" class="">Markdown Basics</a>
</li>
          <li class="sidebar-item">
  <a href="../../../../docs/authoring/footnotes-and-citations.html" class="">Citations &amp; Footnotes</a>
</li>
          <li class="sidebar-item">
  <a href="../../../../docs/authoring/figures-and-layout.html" class="">Figures &amp; Layout</a>
</li>
          <li class="sidebar-item">
  <a href="../../../../docs/authoring/cross-references.html" class="">Cross References</a>
</li>
          <li class="sidebar-item">
  <a href="../../../../docs/authoring/callouts.html" class="">Callout Blocks</a>
</li>
          <li class="sidebar-item">
  <a href="../../../../docs/authoring/shortcodes-and-filters.html" class="">Shortcodes &amp; Filters</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto ">
            <a class="sidebar-section-item d-inline-flex text-start w-100 " data-bs-toggle="collapse" data-bs-target="#computations-collapse" aria-expanded="true">
              <div class="me-auto  sidebar-section-item">Computations</div>
            <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
        </div>
      <div class="collapse  show" id="computations-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../../../../docs/computations/running-code.html" class="">Running Code</a>
</li>
          <li class="sidebar-item">
  <a href="../../../../docs/computations/execution-options.html" class="">Execution Options</a>
</li>
          <li class="sidebar-item">
  <a href="../../../../docs/computations/parameters.html" class="">Parameters</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto ">
            <a class="sidebar-section-item d-inline-flex text-start w-100 " data-bs-toggle="collapse" data-bs-target="#interactivedocs-collapse" aria-expanded="true">
              <div class="me-auto  sidebar-section-item">Interactive Docs</div>
            <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
        </div>
      <div class="collapse  show" id="interactivedocs-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../../../../docs/interactive/index.html" class="">Overview</a>
</li>
          <ul class="list-unstyled sidebar-section depth2">
    <li class="">
        <div class="me-auto ">
          <div class="d-inline-flex w-100 sidebar-item">
            <div class="sidebar-section-link me-auto ">
            <a href="../../../../docs/interactive/js/index.html" class="">JavaScript</a>
            </div>
            <a class="text-start  " data-bs-toggle="collapse" data-bs-target="#javascript-collapse" aria-expanded="true">
              <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
            </div>
        </div>
      <div class="collapse  show" id="javascript-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../../../../docs/interactive/js/" class="">Introduction</a>
</li>
          <li class="sidebar-item">
  <a href="../../../../docs/interactive/js/reactivity.html" class="">Reactivity</a>
</li>
          <li class="sidebar-item">
  <a href="../../../../docs/interactive/js/data-sources.html" class="">Data Sources</a>
</li>
          <li class="sidebar-item">
  <a href="../../../../docs/interactive/js/components.html" class="">Components</a>
</li>
          <li class="sidebar-item">
  <a href="../../../../docs/interactive/js/scaling-up.html" class="">Scaling Up</a>
</li>
          <ul class="list-unstyled sidebar-section depth3">
    <li class="">
        <div class="me-auto ">
            <a class="sidebar-section-item d-inline-flex text-start w-100 " data-bs-toggle="collapse" data-bs-target="#examples-collapse" aria-expanded="true">
              <div class="me-auto  sidebar-item">Examples</div>
            <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
        </div>
      <div class="collapse  show" id="examples-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../../../../docs/interactive/js/examples/dotdensity-map.html" class="" data-resolve-title="true">Dot Density Map</a>
</li>
          <li class="sidebar-item">
  <a href="../../../../docs/interactive/js/examples/passeports-colors.html" class="" data-resolve-title="true">Passports &amp; Colors</a>
</li>
          <li class="sidebar-item">
  <a href="../../../../docs/interactive/js/examples/france-vaccination.html" class="active">France Vaccination</a>
</li>
          <li class="sidebar-item">
  <a href="../../../../docs/interactive/js/examples/mens-tennis/mens-tennis.html" class="" data-resolve-title="true">Men's Tennis</a>
</li>
          <li class="sidebar-item">
  <a href="../../../../docs/interactive/js/examples/brushable-scatterplot-matrix/" class="">Scatterplot Matrix</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
        </ul>
      </div>
    </li>
  </ul>
          <ul class="list-unstyled sidebar-section depth2">
    <li class="">
        <div class="me-auto ">
          <div class="d-inline-flex w-100 sidebar-item">
            <div class="sidebar-section-link me-auto ">
            <a href="../../../../docs/interactive/shiny/index.html" class="">Shiny</a>
            </div>
            <a class="text-start collapsed " data-bs-toggle="collapse" data-bs-target="#shiny-collapse" aria-expanded="false">
              <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
            </div>
        </div>
      <div class="collapse  " id="shiny-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../../../../docs/interactive/shiny/index.html" class="">Introduction</a>
</li>
          <li class="sidebar-item">
  <a href="../../../../docs/interactive/shiny/running.html" class="">Running Documents</a>
</li>
          <li class="sidebar-item">
  <a href="../../../../docs/interactive/shiny/execution.html" class="">Execution Contexts</a>
</li>
          <li class="sidebar-item">
  <a href="../../../../docs/interactive/shiny/resources.html" class="">External Resources</a>
</li>
          <li class="sidebar-item">
  <a href="../../../../docs/interactive/shiny/ojs.html" class="">JavaScript &amp; Shiny</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
          <ul class="list-unstyled sidebar-section depth2">
    <li class="">
        <div class="me-auto ">
            <a class="sidebar-section-item d-inline-flex text-start w-100 collapsed" data-bs-toggle="collapse" data-bs-target="#widgets-collapse" aria-expanded="false">
              <div class="me-auto  sidebar-item">Widgets</div>
            <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
        </div>
      <div class="collapse  " id="widgets-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../../../../docs/interactive/widgets/jupyter.html" class="">Jupyter Widgets</a>
</li>
          <li class="sidebar-item">
  <a href="../../../../docs/interactive/widgets/htmlwidgets.html" class="">htmlwidgets for R</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
          <li class="sidebar-item">
  <a href="../../../../docs/interactive/layout.html" class="">Layout</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
  </ul>
  </div>
</nav>
  </div>
  <div class="col col-12 col-lg-9">
<main>
<header id="title-block-header">
<div class="quarto-title-block d-none d-lg-block"><div><h1 class="title d-none d-lg-block">France Covid-19 Vaccination</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
<p class="subtitle lead">Originally published at: <a href="https://observablehq.com/@neocartocnrs/vaccination-against-covid-19-in-france" class="uri">https://observablehq.com/@neocartocnrs/vaccination-against-covid-19-in-france</a></p>
<p class="author">neocarto</p>
<p class="date">2021-02-09</p>
</header>
<div class="row layout-sidebar ms-md-0">
<div class="panel-sidebar card bg-light p-2 col col-12 col-lg-3">
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-1">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-2">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-3">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-4">

</div>
</div>
</div>
</div>
<div class="panel-fill row col col-12 col-lg-9 pt-3 pt-lg-0 ps-0 ps-lg-3">
<div class="col col-12">
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-5">

</div>
</div>
</div>
</div>
</div>
</div>
<section id="texts" class="level2">
<h2 class="anchored" data-anchor-id="texts">Texts</h2>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-6">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-7">

</div>
</div>
</div>
</section>
<section id="variables" class="level2">
<h2 class="anchored" data-anchor-id="variables">Variables</h2>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-8">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-9">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-10">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-11">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-12">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-13">

</div>
</div>
</div>
</section>
<section id="geometries" class="level2">
<h2 class="anchored" data-anchor-id="geometries">Geometries</h2>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-14">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-15">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-16">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-17">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-18">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-19">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-20">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-21">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-22">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-23">

</div>
</div>
</div>
</section>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-24">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-25">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-26">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-27">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="sourceCode js cell-code code-with-copy"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>vaccins <span class="op">=</span> {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> psv <span class="op">=</span> d3<span class="op">.</span><span class="fu">dsvFormat</span>(<span class="st">";"</span>)<span class="op">;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> url <span class="op">=</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://www.data.gouv.fr/fr/datasets/r/de4b356b-8cd9-4b9a-8878-459a62646107"</span><span class="op">;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span> {</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> v <span class="op">=</span> d3<span class="op">.</span><span class="fu">csv</span>(url)<span class="op">;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    v[<span class="dv">0</span>]<span class="op">.</span><span class="at">clage_vacsi</span><span class="op">;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> v<span class="op">;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">catch</span> (e) {</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> v <span class="op">=</span> d3<span class="op">.</span><span class="fu">text</span>(url)<span class="op">.</span><span class="fu">then</span>((txt) <span class="kw">=&gt;</span> psv<span class="op">.</span><span class="fu">parse</span>(txt))<span class="op">;</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> v<span class="op">;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="ojs-cell-28">

</div>
</div>
</div>
</section>
<section id="helpers" class="level2">
<h2 class="anchored" data-anchor-id="helpers">Helpers</h2>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="sourceCode js cell-code code-with-copy"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>getcentroids <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  dpt<span class="op">.</span><span class="at">features</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> d<span class="op">;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> [d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">DEP</span><span class="op">,</span> path<span class="op">.</span><span class="fu">centroid</span>(d)])</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="ojs-cell-29">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-30">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-31">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-32">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-33">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-34">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-35">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-36">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="sourceCode js cell-code code-with-copy"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>datetodate <span class="op">=</span> <span class="kw">function</span>(dat) {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> m <span class="op">=</span> [</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mois"</span><span class="op">,</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"janvier"</span><span class="op">,</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"février"</span><span class="op">,</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mars"</span><span class="op">,</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"avril"</span><span class="op">,</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mai"</span><span class="op">,</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"juin"</span><span class="op">,</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"juillet"</span><span class="op">,</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"août"</span><span class="op">,</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"septembre"</span><span class="op">,</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"octobre"</span><span class="op">,</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"novembre"</span><span class="op">,</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"décembre"</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> j1 <span class="op">=</span> <span class="op">+</span>dat<span class="op">.</span><span class="fu">substr</span>(<span class="dv">8</span><span class="op">,</span> <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> j <span class="op">=</span> j1 <span class="op">==</span> <span class="dv">1</span> <span class="op">?</span> j1 <span class="op">+</span> <span class="st">"er"</span> <span class="op">:</span> j1<span class="op">;</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> m1 <span class="op">=</span> m[<span class="op">+</span>dat<span class="op">.</span><span class="fu">substr</span>(<span class="dv">5</span><span class="op">,</span> <span class="dv">2</span>)]<span class="op">;</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> a1 <span class="op">=</span> dat<span class="op">.</span><span class="fu">substr</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">4</span>)<span class="op">;</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> j <span class="op">+</span> <span class="st">" "</span> <span class="op">+</span> m1 <span class="op">+</span> <span class="st">" "</span> <span class="op">+</span> a1<span class="op">;</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="ojs-cell-37">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-38">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-39">

</div>
</div>
</div>
</section>
<section id="depedencies" class="level2">
<h2 class="anchored" data-anchor-id="depedencies">Depedencies</h2>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-40">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-41">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-42">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-43">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-44">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-45">

</div>
</div>
</div>
<!-- -->
<div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title anchored" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb4" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "France Covid-19 Vaccination"</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Originally published at: &lt;https://observablehq.com/@neocartocnrs/vaccination-against-covid-19-in-france&gt;"</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "neocarto"</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2021-02-09</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="an">license:</span><span class="co"> mit</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: false</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">    page-layout: custom</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: false</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>::: {.panel-sidebar}</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="in">viewof myage = {</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="in">  const myage = select({</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="in">    title: "Quelle classe d'âge voulez-vous cartographier ?",</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="in">    options: ages,</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="in">    value: "80etplus"</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="in">  });</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="in">  return myage;</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="in">viewof pctvax = slider({</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="in">  title: '&lt;br/&gt;Objectif de vaccination',</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="in">  description: '200% signifie 2 doses par personnes pour tout le monde',</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="in">  min: 50,</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="in">  max: 200,</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a><span class="in">  value: 200,</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="in">  step: 10,</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a><span class="in">  format: v =&gt; v + "%"</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a><span class="in">})</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a><span class="in">viewof overlay = radio({</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a><span class="in">  title: "Écarter les cercles",</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a><span class="in">  options: [{ label: 'Oui', value: 'Y' }, { label: 'Non', value: 'N' }],</span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a><span class="in">  value: 'N'</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a><span class="in">})</span></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a><span class="in">viewof label = radio({</span></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a><span class="in">  title: "Numéros des départements",</span></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a><span class="in">  options: [{ label: 'Afficher', value: 'Y' }, { label: 'Masquer', value: 'N' }],</span></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a><span class="in">  value: 'N'</span></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a><span class="in">})</span></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a><span class="in">//| panel: fill</span></span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a><span class="in">map = {</span></span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a><span class="in">  for (let i = 0; i &lt; 200; i++) {</span></span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a><span class="in">    simulation.tick();</span></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a><span class="in">  const svg = d3</span></span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a><span class="in">    .create("svg")</span></span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("viewBox", [0, 0, width, height])</span></span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a><span class="in">    .style('background-color', "white");</span></span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a><span class="in">  // Filters</span></span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a><span class="in">  var defs = svg.append("defs");</span></span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a><span class="in">  const pattern = defs</span></span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("pattern")</span></span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("id", "hatch")</span></span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("patternUnits", "userSpaceOnUse")</span></span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("width", 6)</span></span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("height", 6);</span></span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a><span class="in">  const filter = defs</span></span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('filter')</span></span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('id', 'border-blur')</span></span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('feGaussianBlur')</span></span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('in', 'SourceGraphic')</span></span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('stdDeviation', 10)</span></span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('result', 'shadow');</span></span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a><span class="in">  const filter2 = defs</span></span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('filter')</span></span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('id', 'border-blur2')</span></span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('feGaussianBlur')</span></span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('in', 'SourceGraphic')</span></span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('stdDeviation', 50)</span></span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('result', 'shadow');</span></span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a><span class="in">  pattern</span></span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("line")</span></span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x1", 0)</span></span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y1", 0)</span></span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x2", 6)</span></span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y1", 6)</span></span>
<span id="cb4-116"><a href="#cb4-116" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke", "#f4f4f4")</span></span>
<span id="cb4-117"><a href="#cb4-117" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke-width", 1)</span></span>
<span id="cb4-118"><a href="#cb4-118" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke-opacity", 0.4);</span></span>
<span id="cb4-119"><a href="#cb4-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-120"><a href="#cb4-120" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb4-121"><a href="#cb4-121" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("rect")</span></span>
<span id="cb4-122"><a href="#cb4-122" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", 0)</span></span>
<span id="cb4-123"><a href="#cb4-123" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", 0)</span></span>
<span id="cb4-124"><a href="#cb4-124" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("width", width)</span></span>
<span id="cb4-125"><a href="#cb4-125" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("height", height)</span></span>
<span id="cb4-126"><a href="#cb4-126" aria-hidden="true" tabindex="-1"></a><span class="in">    .style('fill', "#9ACBE3")</span></span>
<span id="cb4-127"><a href="#cb4-127" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('filter', 'url(#border-blur2)');</span></span>
<span id="cb4-128"><a href="#cb4-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-129"><a href="#cb4-129" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb4-130"><a href="#cb4-130" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("rect")</span></span>
<span id="cb4-131"><a href="#cb4-131" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill-opacity", 0.4)</span></span>
<span id="cb4-132"><a href="#cb4-132" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", 0)</span></span>
<span id="cb4-133"><a href="#cb4-133" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", 0)</span></span>
<span id="cb4-134"><a href="#cb4-134" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("width", width)</span></span>
<span id="cb4-135"><a href="#cb4-135" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("height", height)</span></span>
<span id="cb4-136"><a href="#cb4-136" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('fill', "url('#hatch')");</span></span>
<span id="cb4-137"><a href="#cb4-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-138"><a href="#cb4-138" aria-hidden="true" tabindex="-1"></a><span class="in">  // Graticule</span></span>
<span id="cb4-139"><a href="#cb4-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-140"><a href="#cb4-140" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb4-141"><a href="#cb4-141" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("g")</span></span>
<span id="cb4-142"><a href="#cb4-142" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("path")</span></span>
<span id="cb4-143"><a href="#cb4-143" aria-hidden="true" tabindex="-1"></a><span class="in">    .datum(graticule)</span></span>
<span id="cb4-144"><a href="#cb4-144" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("class", "graticule")</span></span>
<span id="cb4-145"><a href="#cb4-145" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("d", path)</span></span>
<span id="cb4-146"><a href="#cb4-146" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("clip-path", "url(#clip)")</span></span>
<span id="cb4-147"><a href="#cb4-147" aria-hidden="true" tabindex="-1"></a><span class="in">    .style('fill', "none")</span></span>
<span id="cb4-148"><a href="#cb4-148" aria-hidden="true" tabindex="-1"></a><span class="in">    .style('stroke', "white")</span></span>
<span id="cb4-149"><a href="#cb4-149" aria-hidden="true" tabindex="-1"></a><span class="in">    .style('stroke-width', .5)</span></span>
<span id="cb4-150"><a href="#cb4-150" aria-hidden="true" tabindex="-1"></a><span class="in">    .style('stroke-opacity', .4)</span></span>
<span id="cb4-151"><a href="#cb4-151" aria-hidden="true" tabindex="-1"></a><span class="in">    .style('stroke-dasharray', 0.5);</span></span>
<span id="cb4-152"><a href="#cb4-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-153"><a href="#cb4-153" aria-hidden="true" tabindex="-1"></a><span class="in">  // Boxes for remotes territories</span></span>
<span id="cb4-154"><a href="#cb4-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-155"><a href="#cb4-155" aria-hidden="true" tabindex="-1"></a><span class="in">  const delta = 12;</span></span>
<span id="cb4-156"><a href="#cb4-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-157"><a href="#cb4-157" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb4-158"><a href="#cb4-158" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("rect")</span></span>
<span id="cb4-159"><a href="#cb4-159" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", 30)</span></span>
<span id="cb4-160"><a href="#cb4-160" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", 480)</span></span>
<span id="cb4-161"><a href="#cb4-161" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("width", 80)</span></span>
<span id="cb4-162"><a href="#cb4-162" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("height", 80)</span></span>
<span id="cb4-163"><a href="#cb4-163" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke", "white")</span></span>
<span id="cb4-164"><a href="#cb4-164" aria-hidden="true" tabindex="-1"></a><span class="in">    .style('fill', "#9ACBE3");</span></span>
<span id="cb4-165"><a href="#cb4-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-166"><a href="#cb4-166" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb4-167"><a href="#cb4-167" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("rect")</span></span>
<span id="cb4-168"><a href="#cb4-168" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", 30)</span></span>
<span id="cb4-169"><a href="#cb4-169" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", 480 + 80 + delta)</span></span>
<span id="cb4-170"><a href="#cb4-170" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("width", 80)</span></span>
<span id="cb4-171"><a href="#cb4-171" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("height", 80)</span></span>
<span id="cb4-172"><a href="#cb4-172" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke", "white")</span></span>
<span id="cb4-173"><a href="#cb4-173" aria-hidden="true" tabindex="-1"></a><span class="in">    .style('fill', "#9ACBE3");</span></span>
<span id="cb4-174"><a href="#cb4-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-175"><a href="#cb4-175" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb4-176"><a href="#cb4-176" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("rect")</span></span>
<span id="cb4-177"><a href="#cb4-177" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", 30)</span></span>
<span id="cb4-178"><a href="#cb4-178" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", 480 + 80 + 80 + delta + delta)</span></span>
<span id="cb4-179"><a href="#cb4-179" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("width", 80)</span></span>
<span id="cb4-180"><a href="#cb4-180" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("height", 80)</span></span>
<span id="cb4-181"><a href="#cb4-181" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke", "white")</span></span>
<span id="cb4-182"><a href="#cb4-182" aria-hidden="true" tabindex="-1"></a><span class="in">    .style('fill', "#9ACBE3");</span></span>
<span id="cb4-183"><a href="#cb4-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-184"><a href="#cb4-184" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb4-185"><a href="#cb4-185" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("rect")</span></span>
<span id="cb4-186"><a href="#cb4-186" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", 670)</span></span>
<span id="cb4-187"><a href="#cb4-187" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", 885)</span></span>
<span id="cb4-188"><a href="#cb4-188" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("width", 80)</span></span>
<span id="cb4-189"><a href="#cb4-189" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("height", 80)</span></span>
<span id="cb4-190"><a href="#cb4-190" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke", "white")</span></span>
<span id="cb4-191"><a href="#cb4-191" aria-hidden="true" tabindex="-1"></a><span class="in">    .style('fill', "#9ACBE3");</span></span>
<span id="cb4-192"><a href="#cb4-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-193"><a href="#cb4-193" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb4-194"><a href="#cb4-194" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("rect")</span></span>
<span id="cb4-195"><a href="#cb4-195" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", 670 + 80 + delta)</span></span>
<span id="cb4-196"><a href="#cb4-196" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", 885)</span></span>
<span id="cb4-197"><a href="#cb4-197" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("width", 80)</span></span>
<span id="cb4-198"><a href="#cb4-198" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("height", 80)</span></span>
<span id="cb4-199"><a href="#cb4-199" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke", "white")</span></span>
<span id="cb4-200"><a href="#cb4-200" aria-hidden="true" tabindex="-1"></a><span class="in">    .style('fill', "#9ACBE3");</span></span>
<span id="cb4-201"><a href="#cb4-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-202"><a href="#cb4-202" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb4-203"><a href="#cb4-203" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("path")</span></span>
<span id="cb4-204"><a href="#cb4-204" aria-hidden="true" tabindex="-1"></a><span class="in">    .datum(land)</span></span>
<span id="cb4-205"><a href="#cb4-205" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("d", path)</span></span>
<span id="cb4-206"><a href="#cb4-206" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("fill", "white")</span></span>
<span id="cb4-207"><a href="#cb4-207" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill-opacity", .6)</span></span>
<span id="cb4-208"><a href="#cb4-208" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('filter', 'url(#border-blur)');</span></span>
<span id="cb4-209"><a href="#cb4-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-210"><a href="#cb4-210" aria-hidden="true" tabindex="-1"></a><span class="in">  // Chart</span></span>
<span id="cb4-211"><a href="#cb4-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-212"><a href="#cb4-212" aria-hidden="true" tabindex="-1"></a><span class="in">  let infos = svg</span></span>
<span id="cb4-213"><a href="#cb4-213" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("g")</span></span>
<span id="cb4-214"><a href="#cb4-214" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("id", "tooltip")</span></span>
<span id="cb4-215"><a href="#cb4-215" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-family", "sans-serif")</span></span>
<span id="cb4-216"><a href="#cb4-216" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-weight", "bold");</span></span>
<span id="cb4-217"><a href="#cb4-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-218"><a href="#cb4-218" aria-hidden="true" tabindex="-1"></a><span class="in">  let chart_x = 830;</span></span>
<span id="cb4-219"><a href="#cb4-219" aria-hidden="true" tabindex="-1"></a><span class="in">  let chart_y = 155;</span></span>
<span id="cb4-220"><a href="#cb4-220" aria-hidden="true" tabindex="-1"></a><span class="in">  let chart_height = 400;</span></span>
<span id="cb4-221"><a href="#cb4-221" aria-hidden="true" tabindex="-1"></a><span class="in">  let rect_max = 270;</span></span>
<span id="cb4-222"><a href="#cb4-222" aria-hidden="true" tabindex="-1"></a><span class="in">  let myval = 50;</span></span>
<span id="cb4-223"><a href="#cb4-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-224"><a href="#cb4-224" aria-hidden="true" tabindex="-1"></a><span class="in">  let fr_label = "France";</span></span>
<span id="cb4-225"><a href="#cb4-225" aria-hidden="true" tabindex="-1"></a><span class="in">  let fr_pop = format(d3.sum(data, d =&gt; d["pop_" + myage]));</span></span>
<span id="cb4-226"><a href="#cb4-226" aria-hidden="true" tabindex="-1"></a><span class="in">  let fr_doses = format(d3.sum(data, d =&gt; d["doses_" + myage]));</span></span>
<span id="cb4-227"><a href="#cb4-227" aria-hidden="true" tabindex="-1"></a><span class="in">  let fr_tx =</span></span>
<span id="cb4-228"><a href="#cb4-228" aria-hidden="true" tabindex="-1"></a><span class="in">    (100 * d3.sum(data, d =&gt; d["doses_" + myage])) /</span></span>
<span id="cb4-229"><a href="#cb4-229" aria-hidden="true" tabindex="-1"></a><span class="in">    d3.sum(data, d =&gt; d["pop_" + myage]);</span></span>
<span id="cb4-230"><a href="#cb4-230" aria-hidden="true" tabindex="-1"></a><span class="in">  let fr_ratio =</span></span>
<span id="cb4-231"><a href="#cb4-231" aria-hidden="true" tabindex="-1"></a><span class="in">    Math.round(</span></span>
<span id="cb4-232"><a href="#cb4-232" aria-hidden="true" tabindex="-1"></a><span class="in">      (1000 * d3.sum(data, d =&gt; d["doses_" + myage])) /</span></span>
<span id="cb4-233"><a href="#cb4-233" aria-hidden="true" tabindex="-1"></a><span class="in">        d3.sum(data, d =&gt; d["pop_" + myage])</span></span>
<span id="cb4-234"><a href="#cb4-234" aria-hidden="true" tabindex="-1"></a><span class="in">    ) /</span></span>
<span id="cb4-235"><a href="#cb4-235" aria-hidden="true" tabindex="-1"></a><span class="in">      10 +</span></span>
<span id="cb4-236"><a href="#cb4-236" aria-hidden="true" tabindex="-1"></a><span class="in">    "%";</span></span>
<span id="cb4-237"><a href="#cb4-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-238"><a href="#cb4-238" aria-hidden="true" tabindex="-1"></a><span class="in">  infos</span></span>
<span id="cb4-239"><a href="#cb4-239" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("rect")</span></span>
<span id="cb4-240"><a href="#cb4-240" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("id", "info_rect")</span></span>
<span id="cb4-241"><a href="#cb4-241" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", 870)</span></span>
<span id="cb4-242"><a href="#cb4-242" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("width", 55)</span></span>
<span id="cb4-243"><a href="#cb4-243" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("height", fr_tx * (rect_max / pctvax))</span></span>
<span id="cb4-244"><a href="#cb4-244" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", 217 - fr_tx * (rect_max / pctvax) + rect_max)</span></span>
<span id="cb4-245"><a href="#cb4-245" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "#647382");</span></span>
<span id="cb4-246"><a href="#cb4-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-247"><a href="#cb4-247" aria-hidden="true" tabindex="-1"></a><span class="in">  let seringue = svg</span></span>
<span id="cb4-248"><a href="#cb4-248" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("svg:image")</span></span>
<span id="cb4-249"><a href="#cb4-249" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", chart_x)</span></span>
<span id="cb4-250"><a href="#cb4-250" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", chart_y)</span></span>
<span id="cb4-251"><a href="#cb4-251" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("height", chart_height)</span></span>
<span id="cb4-252"><a href="#cb4-252" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr(</span></span>
<span id="cb4-253"><a href="#cb4-253" aria-hidden="true" tabindex="-1"></a><span class="in">      "xlink:href",</span></span>
<span id="cb4-254"><a href="#cb4-254" aria-hidden="true" tabindex="-1"></a><span class="in">      "https://nlambert.gitpages.huma-num.fr/resources/images/sering_b.svg"</span></span>
<span id="cb4-255"><a href="#cb4-255" aria-hidden="true" tabindex="-1"></a><span class="in">    );</span></span>
<span id="cb4-256"><a href="#cb4-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-257"><a href="#cb4-257" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb4-258"><a href="#cb4-258" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("line")</span></span>
<span id="cb4-259"><a href="#cb4-259" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x1", 920)</span></span>
<span id="cb4-260"><a href="#cb4-260" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x2", 956)</span></span>
<span id="cb4-261"><a href="#cb4-261" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y1", 102)</span></span>
<span id="cb4-262"><a href="#cb4-262" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y2", 102)</span></span>
<span id="cb4-263"><a href="#cb4-263" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke", countrycol)</span></span>
<span id="cb4-264"><a href="#cb4-264" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke-linecap", "round")</span></span>
<span id="cb4-265"><a href="#cb4-265" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke-width", 2.5);</span></span>
<span id="cb4-266"><a href="#cb4-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-267"><a href="#cb4-267" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb4-268"><a href="#cb4-268" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("line")</span></span>
<span id="cb4-269"><a href="#cb4-269" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x1", 956)</span></span>
<span id="cb4-270"><a href="#cb4-270" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x2", 956)</span></span>
<span id="cb4-271"><a href="#cb4-271" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y1", 102)</span></span>
<span id="cb4-272"><a href="#cb4-272" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y2", 140)</span></span>
<span id="cb4-273"><a href="#cb4-273" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke", countrycol)</span></span>
<span id="cb4-274"><a href="#cb4-274" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke-linecap", "round")</span></span>
<span id="cb4-275"><a href="#cb4-275" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke-width", 2.5);</span></span>
<span id="cb4-276"><a href="#cb4-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-277"><a href="#cb4-277" aria-hidden="true" tabindex="-1"></a><span class="in">  infos</span></span>
<span id="cb4-278"><a href="#cb4-278" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("text")</span></span>
<span id="cb4-279"><a href="#cb4-279" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("id", "info_name")</span></span>
<span id="cb4-280"><a href="#cb4-280" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", width - 60)</span></span>
<span id="cb4-281"><a href="#cb4-281" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", 137)</span></span>
<span id="cb4-282"><a href="#cb4-282" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("text-anchor", "end")</span></span>
<span id="cb4-283"><a href="#cb4-283" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", countrycol)</span></span>
<span id="cb4-284"><a href="#cb4-284" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("font-size", "35px")</span></span>
<span id="cb4-285"><a href="#cb4-285" aria-hidden="true" tabindex="-1"></a><span class="in">    .text(fr_label);</span></span>
<span id="cb4-286"><a href="#cb4-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-287"><a href="#cb4-287" aria-hidden="true" tabindex="-1"></a><span class="in">  let yref = 580;</span></span>
<span id="cb4-288"><a href="#cb4-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-289"><a href="#cb4-289" aria-hidden="true" tabindex="-1"></a><span class="in">  infos</span></span>
<span id="cb4-290"><a href="#cb4-290" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("text")</span></span>
<span id="cb4-291"><a href="#cb4-291" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", 895)</span></span>
<span id="cb4-292"><a href="#cb4-292" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", yref)</span></span>
<span id="cb4-293"><a href="#cb4-293" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("text-anchor", "middle")</span></span>
<span id="cb4-294"><a href="#cb4-294" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", countrycol)</span></span>
<span id="cb4-295"><a href="#cb4-295" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("font-size", "15px")</span></span>
<span id="cb4-296"><a href="#cb4-296" aria-hidden="true" tabindex="-1"></a><span class="in">    .text("Nombre de personnes");</span></span>
<span id="cb4-297"><a href="#cb4-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-298"><a href="#cb4-298" aria-hidden="true" tabindex="-1"></a><span class="in">  infos</span></span>
<span id="cb4-299"><a href="#cb4-299" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("text")</span></span>
<span id="cb4-300"><a href="#cb4-300" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("id", "info_pop")</span></span>
<span id="cb4-301"><a href="#cb4-301" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", 895)</span></span>
<span id="cb4-302"><a href="#cb4-302" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", yref + 27)</span></span>
<span id="cb4-303"><a href="#cb4-303" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("text-anchor", "middle")</span></span>
<span id="cb4-304"><a href="#cb4-304" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "#4a524d")</span></span>
<span id="cb4-305"><a href="#cb4-305" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill-opacity", 0.8)</span></span>
<span id="cb4-306"><a href="#cb4-306" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("font-size", "20px")</span></span>
<span id="cb4-307"><a href="#cb4-307" aria-hidden="true" tabindex="-1"></a><span class="in">    .text(fr_pop);</span></span>
<span id="cb4-308"><a href="#cb4-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-309"><a href="#cb4-309" aria-hidden="true" tabindex="-1"></a><span class="in">  infos</span></span>
<span id="cb4-310"><a href="#cb4-310" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("text")</span></span>
<span id="cb4-311"><a href="#cb4-311" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", 895)</span></span>
<span id="cb4-312"><a href="#cb4-312" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", yref + 50)</span></span>
<span id="cb4-313"><a href="#cb4-313" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("text-anchor", "middle")</span></span>
<span id="cb4-314"><a href="#cb4-314" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", countrycol)</span></span>
<span id="cb4-315"><a href="#cb4-315" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("font-size", "15px")</span></span>
<span id="cb4-316"><a href="#cb4-316" aria-hidden="true" tabindex="-1"></a><span class="in">    .text("Nombre de doses");</span></span>
<span id="cb4-317"><a href="#cb4-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-318"><a href="#cb4-318" aria-hidden="true" tabindex="-1"></a><span class="in">  infos</span></span>
<span id="cb4-319"><a href="#cb4-319" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("text")</span></span>
<span id="cb4-320"><a href="#cb4-320" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("id", "info_doses")</span></span>
<span id="cb4-321"><a href="#cb4-321" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", 895)</span></span>
<span id="cb4-322"><a href="#cb4-322" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", yref + 27 + 50)</span></span>
<span id="cb4-323"><a href="#cb4-323" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("text-anchor", "middle")</span></span>
<span id="cb4-324"><a href="#cb4-324" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "#4a524d")</span></span>
<span id="cb4-325"><a href="#cb4-325" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill-opacity", 0.8)</span></span>
<span id="cb4-326"><a href="#cb4-326" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("font-size", "20px")</span></span>
<span id="cb4-327"><a href="#cb4-327" aria-hidden="true" tabindex="-1"></a><span class="in">    .text(fr_doses);</span></span>
<span id="cb4-328"><a href="#cb4-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-329"><a href="#cb4-329" aria-hidden="true" tabindex="-1"></a><span class="in">  infos</span></span>
<span id="cb4-330"><a href="#cb4-330" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("text")</span></span>
<span id="cb4-331"><a href="#cb4-331" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", 895)</span></span>
<span id="cb4-332"><a href="#cb4-332" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", yref + 100)</span></span>
<span id="cb4-333"><a href="#cb4-333" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("text-anchor", "middle")</span></span>
<span id="cb4-334"><a href="#cb4-334" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", countrycol)</span></span>
<span id="cb4-335"><a href="#cb4-335" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("font-size", "15px")</span></span>
<span id="cb4-336"><a href="#cb4-336" aria-hidden="true" tabindex="-1"></a><span class="in">    .text("Ratio");</span></span>
<span id="cb4-337"><a href="#cb4-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-338"><a href="#cb4-338" aria-hidden="true" tabindex="-1"></a><span class="in">  infos</span></span>
<span id="cb4-339"><a href="#cb4-339" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("text")</span></span>
<span id="cb4-340"><a href="#cb4-340" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("id", "info_tx")</span></span>
<span id="cb4-341"><a href="#cb4-341" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", 895)</span></span>
<span id="cb4-342"><a href="#cb4-342" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", yref + 42 + 100)</span></span>
<span id="cb4-343"><a href="#cb4-343" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("text-anchor", "middle")</span></span>
<span id="cb4-344"><a href="#cb4-344" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "#4a524d")</span></span>
<span id="cb4-345"><a href="#cb4-345" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill-opacity", 0.8)</span></span>
<span id="cb4-346"><a href="#cb4-346" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("font-size", "40px")</span></span>
<span id="cb4-347"><a href="#cb4-347" aria-hidden="true" tabindex="-1"></a><span class="in">    .text(fr_ratio);</span></span>
<span id="cb4-348"><a href="#cb4-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-349"><a href="#cb4-349" aria-hidden="true" tabindex="-1"></a><span class="in">  // Basemap;</span></span>
<span id="cb4-350"><a href="#cb4-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-351"><a href="#cb4-351" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb4-352"><a href="#cb4-352" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("g")</span></span>
<span id="cb4-353"><a href="#cb4-353" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("id", "map")</span></span>
<span id="cb4-354"><a href="#cb4-354" aria-hidden="true" tabindex="-1"></a><span class="in">    .selectAll("path")</span></span>
<span id="cb4-355"><a href="#cb4-355" aria-hidden="true" tabindex="-1"></a><span class="in">    .data(dpt.features)</span></span>
<span id="cb4-356"><a href="#cb4-356" aria-hidden="true" tabindex="-1"></a><span class="in">    .join("path")</span></span>
<span id="cb4-357"><a href="#cb4-357" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("class", "dpt")</span></span>
<span id="cb4-358"><a href="#cb4-358" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke", overlay == "N" ? "white" : countrycol)</span></span>
<span id="cb4-359"><a href="#cb4-359" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke-width", 0.5)</span></span>
<span id="cb4-360"><a href="#cb4-360" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", countrycol)</span></span>
<span id="cb4-361"><a href="#cb4-361" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill-opacity", fr_doses == 0 ? 0.1 : 1)</span></span>
<span id="cb4-362"><a href="#cb4-362" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke-opacity", fr_doses == 0 ? 0 : 1)</span></span>
<span id="cb4-363"><a href="#cb4-363" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("d", path);</span></span>
<span id="cb4-364"><a href="#cb4-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-365"><a href="#cb4-365" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb4-366"><a href="#cb4-366" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("path")</span></span>
<span id="cb4-367"><a href="#cb4-367" aria-hidden="true" tabindex="-1"></a><span class="in">    .datum(france)</span></span>
<span id="cb4-368"><a href="#cb4-368" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("d", path)</span></span>
<span id="cb4-369"><a href="#cb4-369" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "none")</span></span>
<span id="cb4-370"><a href="#cb4-370" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke", "#75a8c9")</span></span>
<span id="cb4-371"><a href="#cb4-371" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke-width", 1);</span></span>
<span id="cb4-372"><a href="#cb4-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-373"><a href="#cb4-373" aria-hidden="true" tabindex="-1"></a><span class="in">  // Bubbles;</span></span>
<span id="cb4-374"><a href="#cb4-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-375"><a href="#cb4-375" aria-hidden="true" tabindex="-1"></a><span class="in">  if (fr_doses != 0) {</span></span>
<span id="cb4-376"><a href="#cb4-376" aria-hidden="true" tabindex="-1"></a><span class="in">    svg</span></span>
<span id="cb4-377"><a href="#cb4-377" aria-hidden="true" tabindex="-1"></a><span class="in">      .append("g")</span></span>
<span id="cb4-378"><a href="#cb4-378" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("fill-opacity", 0.9)</span></span>
<span id="cb4-379"><a href="#cb4-379" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("stroke", "#fff")</span></span>
<span id="cb4-380"><a href="#cb4-380" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("stroke-width", 0.5)</span></span>
<span id="cb4-381"><a href="#cb4-381" aria-hidden="true" tabindex="-1"></a><span class="in">      .selectAll("circle")</span></span>
<span id="cb4-382"><a href="#cb4-382" aria-hidden="true" tabindex="-1"></a><span class="in">      .data(</span></span>
<span id="cb4-383"><a href="#cb4-383" aria-hidden="true" tabindex="-1"></a><span class="in">        data</span></span>
<span id="cb4-384"><a href="#cb4-384" aria-hidden="true" tabindex="-1"></a><span class="in">          .filter(d =&gt; d.coordx)</span></span>
<span id="cb4-385"><a href="#cb4-385" aria-hidden="true" tabindex="-1"></a><span class="in">          .sort((a, b) =&gt;</span></span>
<span id="cb4-386"><a href="#cb4-386" aria-hidden="true" tabindex="-1"></a><span class="in">            d3.descending(a["doses_" + myage], b["doses_" + myage])</span></span>
<span id="cb4-387"><a href="#cb4-387" aria-hidden="true" tabindex="-1"></a><span class="in">          )</span></span>
<span id="cb4-388"><a href="#cb4-388" aria-hidden="true" tabindex="-1"></a><span class="in">      )</span></span>
<span id="cb4-389"><a href="#cb4-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-390"><a href="#cb4-390" aria-hidden="true" tabindex="-1"></a><span class="in">      .join("circle")</span></span>
<span id="cb4-391"><a href="#cb4-391" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("id", d =&gt; d.id)</span></span>
<span id="cb4-392"><a href="#cb4-392" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("fill", d =&gt; getcolor(ratiobyid.get(d.id)))</span></span>
<span id="cb4-393"><a href="#cb4-393" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("cx", overlay == 'N' ? d =&gt; d.coordx : d =&gt; d.x)</span></span>
<span id="cb4-394"><a href="#cb4-394" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("cy", overlay == 'N' ? d =&gt; d.coordy : d =&gt; d.y)</span></span>
<span id="cb4-395"><a href="#cb4-395" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("r", d =&gt; radius(+d["doses_" + myage]))</span></span>
<span id="cb4-396"><a href="#cb4-396" aria-hidden="true" tabindex="-1"></a><span class="in">      // Interactivity</span></span>
<span id="cb4-397"><a href="#cb4-397" aria-hidden="true" tabindex="-1"></a><span class="in">      .on("touchmove mousemove", function(event, d) {</span></span>
<span id="cb4-398"><a href="#cb4-398" aria-hidden="true" tabindex="-1"></a><span class="in">        let tx = (100 * d["doses_" + myage]) / d["pop_" + myage];</span></span>
<span id="cb4-399"><a href="#cb4-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-400"><a href="#cb4-400" aria-hidden="true" tabindex="-1"></a><span class="in">        d3.select(this)</span></span>
<span id="cb4-401"><a href="#cb4-401" aria-hidden="true" tabindex="-1"></a><span class="in">          .style("cursor", "pointer")</span></span>
<span id="cb4-402"><a href="#cb4-402" aria-hidden="true" tabindex="-1"></a><span class="in">          .attr("stroke", "red")</span></span>
<span id="cb4-403"><a href="#cb4-403" aria-hidden="true" tabindex="-1"></a><span class="in">          .attr("stroke-width", 2);</span></span>
<span id="cb4-404"><a href="#cb4-404" aria-hidden="true" tabindex="-1"></a><span class="in">        d3.select("#info_rect")</span></span>
<span id="cb4-405"><a href="#cb4-405" aria-hidden="true" tabindex="-1"></a><span class="in">          .attr("height", tx * (rect_max / pctvax))</span></span>
<span id="cb4-406"><a href="#cb4-406" aria-hidden="true" tabindex="-1"></a><span class="in">          .attr("y", 217 - tx * (rect_max / pctvax) + rect_max)</span></span>
<span id="cb4-407"><a href="#cb4-407" aria-hidden="true" tabindex="-1"></a><span class="in">          .attr("fill", getcolor(tx));</span></span>
<span id="cb4-408"><a href="#cb4-408" aria-hidden="true" tabindex="-1"></a><span class="in">        d3.select("#info_name").text(d.name);</span></span>
<span id="cb4-409"><a href="#cb4-409" aria-hidden="true" tabindex="-1"></a><span class="in">        d3.select("#info_pop").text(format(d["pop_" + myage]));</span></span>
<span id="cb4-410"><a href="#cb4-410" aria-hidden="true" tabindex="-1"></a><span class="in">        d3.select("#info_doses").text(format(d["doses_" + myage]));</span></span>
<span id="cb4-411"><a href="#cb4-411" aria-hidden="true" tabindex="-1"></a><span class="in">        d3.select("#info_tx").text(</span></span>
<span id="cb4-412"><a href="#cb4-412" aria-hidden="true" tabindex="-1"></a><span class="in">          Math.round(1000 * (d["doses_" + myage] / d["pop_" + myage])) / 10 +</span></span>
<span id="cb4-413"><a href="#cb4-413" aria-hidden="true" tabindex="-1"></a><span class="in">            "%"</span></span>
<span id="cb4-414"><a href="#cb4-414" aria-hidden="true" tabindex="-1"></a><span class="in">        );</span></span>
<span id="cb4-415"><a href="#cb4-415" aria-hidden="true" tabindex="-1"></a><span class="in">      })</span></span>
<span id="cb4-416"><a href="#cb4-416" aria-hidden="true" tabindex="-1"></a><span class="in">      .on("touchend mouseleave", function() {</span></span>
<span id="cb4-417"><a href="#cb4-417" aria-hidden="true" tabindex="-1"></a><span class="in">        d3.select(this)</span></span>
<span id="cb4-418"><a href="#cb4-418" aria-hidden="true" tabindex="-1"></a><span class="in">          .attr("stroke", "white")</span></span>
<span id="cb4-419"><a href="#cb4-419" aria-hidden="true" tabindex="-1"></a><span class="in">          .attr("stroke-width", 0.5);</span></span>
<span id="cb4-420"><a href="#cb4-420" aria-hidden="true" tabindex="-1"></a><span class="in">        d3.select("#info_rect")</span></span>
<span id="cb4-421"><a href="#cb4-421" aria-hidden="true" tabindex="-1"></a><span class="in">          .attr("height", fr_tx * (rect_max / pctvax))</span></span>
<span id="cb4-422"><a href="#cb4-422" aria-hidden="true" tabindex="-1"></a><span class="in">          .attr("y", 217 - fr_tx * (rect_max / pctvax) + rect_max)</span></span>
<span id="cb4-423"><a href="#cb4-423" aria-hidden="true" tabindex="-1"></a><span class="in">          .attr("fill", "#647382");</span></span>
<span id="cb4-424"><a href="#cb4-424" aria-hidden="true" tabindex="-1"></a><span class="in">        d3.select("#info_name").text(fr_label);</span></span>
<span id="cb4-425"><a href="#cb4-425" aria-hidden="true" tabindex="-1"></a><span class="in">        d3.select("#info_pop").text(fr_pop);</span></span>
<span id="cb4-426"><a href="#cb4-426" aria-hidden="true" tabindex="-1"></a><span class="in">        d3.select("#info_doses").text(fr_doses);</span></span>
<span id="cb4-427"><a href="#cb4-427" aria-hidden="true" tabindex="-1"></a><span class="in">        d3.select("#info_tx").text(fr_ratio);</span></span>
<span id="cb4-428"><a href="#cb4-428" aria-hidden="true" tabindex="-1"></a><span class="in">      });</span></span>
<span id="cb4-429"><a href="#cb4-429" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-430"><a href="#cb4-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-431"><a href="#cb4-431" aria-hidden="true" tabindex="-1"></a><span class="in">  //labels</span></span>
<span id="cb4-432"><a href="#cb4-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-433"><a href="#cb4-433" aria-hidden="true" tabindex="-1"></a><span class="in">  if (label == "Y") {</span></span>
<span id="cb4-434"><a href="#cb4-434" aria-hidden="true" tabindex="-1"></a><span class="in">    svg</span></span>
<span id="cb4-435"><a href="#cb4-435" aria-hidden="true" tabindex="-1"></a><span class="in">      .selectAll("text")</span></span>
<span id="cb4-436"><a href="#cb4-436" aria-hidden="true" tabindex="-1"></a><span class="in">      .data(data)</span></span>
<span id="cb4-437"><a href="#cb4-437" aria-hidden="true" tabindex="-1"></a><span class="in">      .enter()</span></span>
<span id="cb4-438"><a href="#cb4-438" aria-hidden="true" tabindex="-1"></a><span class="in">      .append("text")</span></span>
<span id="cb4-439"><a href="#cb4-439" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("x", d =&gt; (overlay == "N" ? d.coordx : d.x))</span></span>
<span id="cb4-440"><a href="#cb4-440" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("y", d =&gt; (overlay == "N" ? d.coordy : d.y))</span></span>
<span id="cb4-441"><a href="#cb4-441" aria-hidden="true" tabindex="-1"></a><span class="in">      .text(d =&gt; d.id)</span></span>
<span id="cb4-442"><a href="#cb4-442" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("text-anchor", "middle")</span></span>
<span id="cb4-443"><a href="#cb4-443" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("dominant-baseline", "middle")</span></span>
<span id="cb4-444"><a href="#cb4-444" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("font-family", function(d, i) {</span></span>
<span id="cb4-445"><a href="#cb4-445" aria-hidden="true" tabindex="-1"></a><span class="in">        return i &lt; 5 ? "serif" : "sans-serif";</span></span>
<span id="cb4-446"><a href="#cb4-446" aria-hidden="true" tabindex="-1"></a><span class="in">      })</span></span>
<span id="cb4-447"><a href="#cb4-447" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("fill", "#4e524f")</span></span>
<span id="cb4-448"><a href="#cb4-448" aria-hidden="true" tabindex="-1"></a><span class="in">      .style("font-size", "12px");</span></span>
<span id="cb4-449"><a href="#cb4-449" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-450"><a href="#cb4-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-451"><a href="#cb4-451" aria-hidden="true" tabindex="-1"></a><span class="in">  // Legend</span></span>
<span id="cb4-452"><a href="#cb4-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-453"><a href="#cb4-453" aria-hidden="true" tabindex="-1"></a><span class="in">  if (fr_doses != 0) {</span></span>
<span id="cb4-454"><a href="#cb4-454" aria-hidden="true" tabindex="-1"></a><span class="in">    svg</span></span>
<span id="cb4-455"><a href="#cb4-455" aria-hidden="true" tabindex="-1"></a><span class="in">      .append("text")</span></span>
<span id="cb4-456"><a href="#cb4-456" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("x", 35)</span></span>
<span id="cb4-457"><a href="#cb4-457" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("y", 905)</span></span>
<span id="cb4-458"><a href="#cb4-458" aria-hidden="true" tabindex="-1"></a><span class="in">      .text("Nombre de doses / nombre de personnes (en %)")</span></span>
<span id="cb4-459"><a href="#cb4-459" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("font-family", "sans-serif")</span></span>
<span id="cb4-460"><a href="#cb4-460" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("font-weight", "bold")</span></span>
<span id="cb4-461"><a href="#cb4-461" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("fill", "#4a524d")</span></span>
<span id="cb4-462"><a href="#cb4-462" aria-hidden="true" tabindex="-1"></a><span class="in">      .style("font-size", "16px");</span></span>
<span id="cb4-463"><a href="#cb4-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-464"><a href="#cb4-464" aria-hidden="true" tabindex="-1"></a><span class="in">    svg</span></span>
<span id="cb4-465"><a href="#cb4-465" aria-hidden="true" tabindex="-1"></a><span class="in">      .append("g")</span></span>
<span id="cb4-466"><a href="#cb4-466" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("transform", "translate(35, 900)")</span></span>
<span id="cb4-467"><a href="#cb4-467" aria-hidden="true" tabindex="-1"></a><span class="in">      .append(() =&gt;</span></span>
<span id="cb4-468"><a href="#cb4-468" aria-hidden="true" tabindex="-1"></a><span class="in">        legend({</span></span>
<span id="cb4-469"><a href="#cb4-469" aria-hidden="true" tabindex="-1"></a><span class="in">          color: getcolor,</span></span>
<span id="cb4-470"><a href="#cb4-470" aria-hidden="true" tabindex="-1"></a><span class="in">          width: 360,</span></span>
<span id="cb4-471"><a href="#cb4-471" aria-hidden="true" tabindex="-1"></a><span class="in">          height: 60,</span></span>
<span id="cb4-472"><a href="#cb4-472" aria-hidden="true" tabindex="-1"></a><span class="in">          tickFormat: ".1f"</span></span>
<span id="cb4-473"><a href="#cb4-473" aria-hidden="true" tabindex="-1"></a><span class="in">        })</span></span>
<span id="cb4-474"><a href="#cb4-474" aria-hidden="true" tabindex="-1"></a><span class="in">      );</span></span>
<span id="cb4-475"><a href="#cb4-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-476"><a href="#cb4-476" aria-hidden="true" tabindex="-1"></a><span class="in">    svg</span></span>
<span id="cb4-477"><a href="#cb4-477" aria-hidden="true" tabindex="-1"></a><span class="in">      .append("text")</span></span>
<span id="cb4-478"><a href="#cb4-478" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("x", 35)</span></span>
<span id="cb4-479"><a href="#cb4-479" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("y", 780)</span></span>
<span id="cb4-480"><a href="#cb4-480" aria-hidden="true" tabindex="-1"></a><span class="in">      .text("Nombre de doses")</span></span>
<span id="cb4-481"><a href="#cb4-481" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("font-family", "sans-serif")</span></span>
<span id="cb4-482"><a href="#cb4-482" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("font-weight", "bold")</span></span>
<span id="cb4-483"><a href="#cb4-483" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("fill", "#4a524d")</span></span>
<span id="cb4-484"><a href="#cb4-484" aria-hidden="true" tabindex="-1"></a><span class="in">      .style("font-size", "16px");</span></span>
<span id="cb4-485"><a href="#cb4-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-486"><a href="#cb4-486" aria-hidden="true" tabindex="-1"></a><span class="in">    svg</span></span>
<span id="cb4-487"><a href="#cb4-487" aria-hidden="true" tabindex="-1"></a><span class="in">      .append("g")</span></span>
<span id="cb4-488"><a href="#cb4-488" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("transform", `translate(35, 800)`)</span></span>
<span id="cb4-489"><a href="#cb4-489" aria-hidden="true" tabindex="-1"></a><span class="in">      .call(legcircles);</span></span>
<span id="cb4-490"><a href="#cb4-490" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-491"><a href="#cb4-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-492"><a href="#cb4-492" aria-hidden="true" tabindex="-1"></a><span class="in">  // Title</span></span>
<span id="cb4-493"><a href="#cb4-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-494"><a href="#cb4-494" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb4-495"><a href="#cb4-495" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("rect")</span></span>
<span id="cb4-496"><a href="#cb4-496" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", 0)</span></span>
<span id="cb4-497"><a href="#cb4-497" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", 0)</span></span>
<span id="cb4-498"><a href="#cb4-498" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("width", width)</span></span>
<span id="cb4-499"><a href="#cb4-499" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("height", 80)</span></span>
<span id="cb4-500"><a href="#cb4-500" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", countrycol)</span></span>
<span id="cb4-501"><a href="#cb4-501" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill-opacity", 0.3);</span></span>
<span id="cb4-502"><a href="#cb4-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-503"><a href="#cb4-503" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb4-504"><a href="#cb4-504" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("text")</span></span>
<span id="cb4-505"><a href="#cb4-505" aria-hidden="true" tabindex="-1"></a><span class="in">    .text(</span></span>
<span id="cb4-506"><a href="#cb4-506" aria-hidden="true" tabindex="-1"></a><span class="in">      "État de la vaccination dans votre département au " + datetodate(mydate)</span></span>
<span id="cb4-507"><a href="#cb4-507" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb4-508"><a href="#cb4-508" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", width / 2)</span></span>
<span id="cb4-509"><a href="#cb4-509" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", 50)</span></span>
<span id="cb4-510"><a href="#cb4-510" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-family", "sans-serif")</span></span>
<span id="cb4-511"><a href="#cb4-511" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-weight", "bold")</span></span>
<span id="cb4-512"><a href="#cb4-512" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("text-anchor", "middle")</span></span>
<span id="cb4-513"><a href="#cb4-513" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "#4a524d")</span></span>
<span id="cb4-514"><a href="#cb4-514" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("font-size", "28px")</span></span>
<span id="cb4-515"><a href="#cb4-515" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill-opacity", 1);</span></span>
<span id="cb4-516"><a href="#cb4-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-517"><a href="#cb4-517" aria-hidden="true" tabindex="-1"></a><span class="in">  // Staging</span></span>
<span id="cb4-518"><a href="#cb4-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-519"><a href="#cb4-519" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb4-520"><a href="#cb4-520" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("g")</span></span>
<span id="cb4-521"><a href="#cb4-521" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("transform", `translate(-100, 0)`)</span></span>
<span id="cb4-522"><a href="#cb4-522" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("g")</span></span>
<span id="cb4-523"><a href="#cb4-523" aria-hidden="true" tabindex="-1"></a><span class="in">    .call(scaleBar);</span></span>
<span id="cb4-524"><a href="#cb4-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-525"><a href="#cb4-525" aria-hidden="true" tabindex="-1"></a><span class="in">  var source = svg</span></span>
<span id="cb4-526"><a href="#cb4-526" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("text")</span></span>
<span id="cb4-527"><a href="#cb4-527" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", 0)</span></span>
<span id="cb4-528"><a href="#cb4-528" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", 0)</span></span>
<span id="cb4-529"><a href="#cb4-529" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('transform', 'translate(17,973) rotate(-90)')</span></span>
<span id="cb4-530"><a href="#cb4-530" aria-hidden="true" tabindex="-1"></a><span class="in">    .text(txtsource)</span></span>
<span id="cb4-531"><a href="#cb4-531" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-family", "sans-serif")</span></span>
<span id="cb4-532"><a href="#cb4-532" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("font-size", "11px")</span></span>
<span id="cb4-533"><a href="#cb4-533" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("font-style", "italic")</span></span>
<span id="cb4-534"><a href="#cb4-534" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill-opacity", 1)</span></span>
<span id="cb4-535"><a href="#cb4-535" aria-hidden="true" tabindex="-1"></a><span class="in">    .style('fill', "#616161");</span></span>
<span id="cb4-536"><a href="#cb4-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-537"><a href="#cb4-537" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb4-538"><a href="#cb4-538" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("text")</span></span>
<span id="cb4-539"><a href="#cb4-539" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", 210)</span></span>
<span id="cb4-540"><a href="#cb4-540" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", 120)</span></span>
<span id="cb4-541"><a href="#cb4-541" aria-hidden="true" tabindex="-1"></a><span class="in">    .text("Classe d'âge")</span></span>
<span id="cb4-542"><a href="#cb4-542" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-family", "sans-serif")</span></span>
<span id="cb4-543"><a href="#cb4-543" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-weight", "bold")</span></span>
<span id="cb4-544"><a href="#cb4-544" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("text-anchor", "middle")</span></span>
<span id="cb4-545"><a href="#cb4-545" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "#4a524d")</span></span>
<span id="cb4-546"><a href="#cb4-546" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill-opacity", 0.8)</span></span>
<span id="cb4-547"><a href="#cb4-547" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("font-size", "16px");</span></span>
<span id="cb4-548"><a href="#cb4-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-549"><a href="#cb4-549" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb4-550"><a href="#cb4-550" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("rect")</span></span>
<span id="cb4-551"><a href="#cb4-551" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", 82)</span></span>
<span id="cb4-552"><a href="#cb4-552" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", 133)</span></span>
<span id="cb4-553"><a href="#cb4-553" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("width", 260)</span></span>
<span id="cb4-554"><a href="#cb4-554" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("height", 50)</span></span>
<span id="cb4-555"><a href="#cb4-555" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke", "#4a524d")</span></span>
<span id="cb4-556"><a href="#cb4-556" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke-opacity", 0.8)</span></span>
<span id="cb4-557"><a href="#cb4-557" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "none");</span></span>
<span id="cb4-558"><a href="#cb4-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-559"><a href="#cb4-559" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb4-560"><a href="#cb4-560" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("text")</span></span>
<span id="cb4-561"><a href="#cb4-561" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", 210)</span></span>
<span id="cb4-562"><a href="#cb4-562" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", 170)</span></span>
<span id="cb4-563"><a href="#cb4-563" aria-hidden="true" tabindex="-1"></a><span class="in">    .text(agesbyid.get(myage))</span></span>
<span id="cb4-564"><a href="#cb4-564" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-family", "sans-serif")</span></span>
<span id="cb4-565"><a href="#cb4-565" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-weight", "bold")</span></span>
<span id="cb4-566"><a href="#cb4-566" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("text-anchor", "middle")</span></span>
<span id="cb4-567"><a href="#cb4-567" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "#4a524d")</span></span>
<span id="cb4-568"><a href="#cb4-568" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill-opacity", 0.8)</span></span>
<span id="cb4-569"><a href="#cb4-569" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("font-size", "35px");</span></span>
<span id="cb4-570"><a href="#cb4-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-571"><a href="#cb4-571" aria-hidden="true" tabindex="-1"></a><span class="in">  // Signature</span></span>
<span id="cb4-572"><a href="#cb4-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-573"><a href="#cb4-573" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb4-574"><a href="#cb4-574" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("svg:image")</span></span>
<span id="cb4-575"><a href="#cb4-575" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", 954)</span></span>
<span id="cb4-576"><a href="#cb4-576" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", 960)</span></span>
<span id="cb4-577"><a href="#cb4-577" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("width", 40)</span></span>
<span id="cb4-578"><a href="#cb4-578" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr(</span></span>
<span id="cb4-579"><a href="#cb4-579" aria-hidden="true" tabindex="-1"></a><span class="in">      "xlink:href",</span></span>
<span id="cb4-580"><a href="#cb4-580" aria-hidden="true" tabindex="-1"></a><span class="in">      "https://nlambert.gitpages.huma-num.fr/resources/images/signature_black.svg"</span></span>
<span id="cb4-581"><a href="#cb4-581" aria-hidden="true" tabindex="-1"></a><span class="in">    );</span></span>
<span id="cb4-582"><a href="#cb4-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-583"><a href="#cb4-583" aria-hidden="true" tabindex="-1"></a><span class="in">  return svg.node();</span></span>
<span id="cb4-584"><a href="#cb4-584" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-585"><a href="#cb4-585" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-586"><a href="#cb4-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-587"><a href="#cb4-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-588"><a href="#cb4-588" aria-hidden="true" tabindex="-1"></a><span class="fu">## Texts</span></span>
<span id="cb4-589"><a href="#cb4-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-592"><a href="#cb4-592" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-593"><a href="#cb4-593" aria-hidden="true" tabindex="-1"></a><span class="in">txtlegend = "Taux de vaccination dans les départements (%)"</span></span>
<span id="cb4-594"><a href="#cb4-594" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-595"><a href="#cb4-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-598"><a href="#cb4-598" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-599"><a href="#cb4-599" aria-hidden="true" tabindex="-1"></a><span class="in">txtsource = "Carte réalisée par Nicolas Lambert, 2021. Sources : Santé publique France (https://www.data.gouv.fr/fr/datasets/donnees-relatives-aux-personnes-vaccinees-contre-la-covid-19-1/)"</span></span>
<span id="cb4-600"><a href="#cb4-600" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-601"><a href="#cb4-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-602"><a href="#cb4-602" aria-hidden="true" tabindex="-1"></a><span class="fu">## Variables</span></span>
<span id="cb4-603"><a href="#cb4-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-606"><a href="#cb4-606" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-607"><a href="#cb4-607" aria-hidden="true" tabindex="-1"></a><span class="in">countrycol = "#a3b7cc"</span></span>
<span id="cb4-608"><a href="#cb4-608" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-609"><a href="#cb4-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-612"><a href="#cb4-612" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-613"><a href="#cb4-613" aria-hidden="true" tabindex="-1"></a><span class="in">mydate = d3.max(vaccins, d =&gt; d.jour)</span></span>
<span id="cb4-614"><a href="#cb4-614" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-615"><a href="#cb4-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-618"><a href="#cb4-618" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-619"><a href="#cb4-619" aria-hidden="true" tabindex="-1"></a><span class="in">yellow = "#fbd14b"</span></span>
<span id="cb4-620"><a href="#cb4-620" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-621"><a href="#cb4-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-624"><a href="#cb4-624" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-625"><a href="#cb4-625" aria-hidden="true" tabindex="-1"></a><span class="in">height = 980</span></span>
<span id="cb4-626"><a href="#cb4-626" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-627"><a href="#cb4-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-630"><a href="#cb4-630" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-631"><a href="#cb4-631" aria-hidden="true" tabindex="-1"></a><span class="in">width = 1000</span></span>
<span id="cb4-632"><a href="#cb4-632" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-633"><a href="#cb4-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-636"><a href="#cb4-636" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-637"><a href="#cb4-637" aria-hidden="true" tabindex="-1"></a><span class="in">colors = [</span></span>
<span id="cb4-638"><a href="#cb4-638" aria-hidden="true" tabindex="-1"></a><span class="in">  '#a50026',</span></span>
<span id="cb4-639"><a href="#cb4-639" aria-hidden="true" tabindex="-1"></a><span class="in">  '#d73027',</span></span>
<span id="cb4-640"><a href="#cb4-640" aria-hidden="true" tabindex="-1"></a><span class="in">  '#f46d43',</span></span>
<span id="cb4-641"><a href="#cb4-641" aria-hidden="true" tabindex="-1"></a><span class="in">  '#fdae61',</span></span>
<span id="cb4-642"><a href="#cb4-642" aria-hidden="true" tabindex="-1"></a><span class="in">  '#fee08b',</span></span>
<span id="cb4-643"><a href="#cb4-643" aria-hidden="true" tabindex="-1"></a><span class="in">  '#ffffbf',</span></span>
<span id="cb4-644"><a href="#cb4-644" aria-hidden="true" tabindex="-1"></a><span class="in">  '#d9ef8b',</span></span>
<span id="cb4-645"><a href="#cb4-645" aria-hidden="true" tabindex="-1"></a><span class="in">  '#a6d96a',</span></span>
<span id="cb4-646"><a href="#cb4-646" aria-hidden="true" tabindex="-1"></a><span class="in">  '#66bd63',</span></span>
<span id="cb4-647"><a href="#cb4-647" aria-hidden="true" tabindex="-1"></a><span class="in">  '#1a9850',</span></span>
<span id="cb4-648"><a href="#cb4-648" aria-hidden="true" tabindex="-1"></a><span class="in">  '#006837'</span></span>
<span id="cb4-649"><a href="#cb4-649" aria-hidden="true" tabindex="-1"></a><span class="in">]</span></span>
<span id="cb4-650"><a href="#cb4-650" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-651"><a href="#cb4-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-652"><a href="#cb4-652" aria-hidden="true" tabindex="-1"></a><span class="fu">## Geometries</span></span>
<span id="cb4-653"><a href="#cb4-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-656"><a href="#cb4-656" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-657"><a href="#cb4-657" aria-hidden="true" tabindex="-1"></a><span class="in">features = new Map(</span></span>
<span id="cb4-658"><a href="#cb4-658" aria-hidden="true" tabindex="-1"></a><span class="in">  dpt.features</span></span>
<span id="cb4-659"><a href="#cb4-659" aria-hidden="true" tabindex="-1"></a><span class="in">    .map(d =&gt; {</span></span>
<span id="cb4-660"><a href="#cb4-660" aria-hidden="true" tabindex="-1"></a><span class="in">      d.properties.centroid = d3.geoCentroid(d);</span></span>
<span id="cb4-661"><a href="#cb4-661" aria-hidden="true" tabindex="-1"></a><span class="in">      return d;</span></span>
<span id="cb4-662"><a href="#cb4-662" aria-hidden="true" tabindex="-1"></a><span class="in">    })</span></span>
<span id="cb4-663"><a href="#cb4-663" aria-hidden="true" tabindex="-1"></a><span class="in">    .map(d =&gt; [d.properties.DEP, d])</span></span>
<span id="cb4-664"><a href="#cb4-664" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb4-665"><a href="#cb4-665" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-666"><a href="#cb4-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-669"><a href="#cb4-669" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-670"><a href="#cb4-670" aria-hidden="true" tabindex="-1"></a><span class="in">land = topojson.merge(</span></span>
<span id="cb4-671"><a href="#cb4-671" aria-hidden="true" tabindex="-1"></a><span class="in">  countries,</span></span>
<span id="cb4-672"><a href="#cb4-672" aria-hidden="true" tabindex="-1"></a><span class="in">  countries.objects.CNTR_RG_10M_2020_4326.geometries</span></span>
<span id="cb4-673"><a href="#cb4-673" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb4-674"><a href="#cb4-674" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-675"><a href="#cb4-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-678"><a href="#cb4-678" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-679"><a href="#cb4-679" aria-hidden="true" tabindex="-1"></a><span class="in">dpt = topojson.feature(departements, departements.objects.DEPT)</span></span>
<span id="cb4-680"><a href="#cb4-680" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-681"><a href="#cb4-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-684"><a href="#cb4-684" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-685"><a href="#cb4-685" aria-hidden="true" tabindex="-1"></a><span class="in">departements = d3.json(</span></span>
<span id="cb4-686"><a href="#cb4-686" aria-hidden="true" tabindex="-1"></a><span class="in">  "https://raw.githubusercontent.com/neocarto/resources/master/geometries/France/departements.json"</span></span>
<span id="cb4-687"><a href="#cb4-687" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb4-688"><a href="#cb4-688" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-689"><a href="#cb4-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-692"><a href="#cb4-692" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-693"><a href="#cb4-693" aria-hidden="true" tabindex="-1"></a><span class="in">france = topojson.merge(departements, departements.objects.DEPT.geometries)</span></span>
<span id="cb4-694"><a href="#cb4-694" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-695"><a href="#cb4-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-698"><a href="#cb4-698" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-699"><a href="#cb4-699" aria-hidden="true" tabindex="-1"></a><span class="in">countries = d3.json(</span></span>
<span id="cb4-700"><a href="#cb4-700" aria-hidden="true" tabindex="-1"></a><span class="in">  "https://raw.githubusercontent.com/neocarto/resources/master/geometries/World/GISCO_CNTR_RG_10M_2020_4326.json"</span></span>
<span id="cb4-701"><a href="#cb4-701" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb4-702"><a href="#cb4-702" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-703"><a href="#cb4-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-706"><a href="#cb4-706" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-707"><a href="#cb4-707" aria-hidden="true" tabindex="-1"></a><span class="in">outline = ({ type: "Sphere" })</span></span>
<span id="cb4-708"><a href="#cb4-708" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-709"><a href="#cb4-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-712"><a href="#cb4-712" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-713"><a href="#cb4-713" aria-hidden="true" tabindex="-1"></a><span class="in">graticule = d3.geoGraticule().step([1, 0.7])</span></span>
<span id="cb4-714"><a href="#cb4-714" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-715"><a href="#cb4-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-718"><a href="#cb4-718" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-719"><a href="#cb4-719" aria-hidden="true" tabindex="-1"></a><span class="in">path = d3.geoPath(projection)</span></span>
<span id="cb4-720"><a href="#cb4-720" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-721"><a href="#cb4-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-724"><a href="#cb4-724" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-725"><a href="#cb4-725" aria-hidden="true" tabindex="-1"></a><span class="in">projection = d3</span></span>
<span id="cb4-726"><a href="#cb4-726" aria-hidden="true" tabindex="-1"></a><span class="in">  .geoConicConformal() // Lambert-93</span></span>
<span id="cb4-727"><a href="#cb4-727" aria-hidden="true" tabindex="-1"></a><span class="in">  .center([2.454071, 46.279229]) // Center on France</span></span>
<span id="cb4-728"><a href="#cb4-728" aria-hidden="true" tabindex="-1"></a><span class="in">  .scale(5000)</span></span>
<span id="cb4-729"><a href="#cb4-729" aria-hidden="true" tabindex="-1"></a><span class="in">  .translate([width / 2 - 10, height / 2 + 50])</span></span>
<span id="cb4-730"><a href="#cb4-730" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-731"><a href="#cb4-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-732"><a href="#cb4-732" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data</span></span>
<span id="cb4-733"><a href="#cb4-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-736"><a href="#cb4-736" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-737"><a href="#cb4-737" aria-hidden="true" tabindex="-1"></a><span class="in">ages = [</span></span>
<span id="cb4-738"><a href="#cb4-738" aria-hidden="true" tabindex="-1"></a><span class="in">  { label: "Tous les âges", value: "tot" },</span></span>
<span id="cb4-739"><a href="#cb4-739" aria-hidden="true" tabindex="-1"></a><span class="in">  { label: "De 0 à 9 ans", value: "0_9" },</span></span>
<span id="cb4-740"><a href="#cb4-740" aria-hidden="true" tabindex="-1"></a><span class="in">  { label: "De 10 à 24 ans", value: "10_24" },</span></span>
<span id="cb4-741"><a href="#cb4-741" aria-hidden="true" tabindex="-1"></a><span class="in">  { label: "De 25 à 29 ans", value: "25_29" },</span></span>
<span id="cb4-742"><a href="#cb4-742" aria-hidden="true" tabindex="-1"></a><span class="in">  { label: "De 30 à 39 ans", value: "30_39" },</span></span>
<span id="cb4-743"><a href="#cb4-743" aria-hidden="true" tabindex="-1"></a><span class="in">  { label: "De 40 à 49 ans", value: "40_49" },</span></span>
<span id="cb4-744"><a href="#cb4-744" aria-hidden="true" tabindex="-1"></a><span class="in">  { label: "De 50 à 59 ans", value: "50_59" },</span></span>
<span id="cb4-745"><a href="#cb4-745" aria-hidden="true" tabindex="-1"></a><span class="in">  { label: "De 60 à 69 ans", value: "60_69" },</span></span>
<span id="cb4-746"><a href="#cb4-746" aria-hidden="true" tabindex="-1"></a><span class="in">  { label: "De 70 à 74 ans", value: "70_74" },</span></span>
<span id="cb4-747"><a href="#cb4-747" aria-hidden="true" tabindex="-1"></a><span class="in">  { label: "De 75 à 79 ans", value: "75_79" },</span></span>
<span id="cb4-748"><a href="#cb4-748" aria-hidden="true" tabindex="-1"></a><span class="in">  { label: "80 ans et plus", value: "80etplus" }</span></span>
<span id="cb4-749"><a href="#cb4-749" aria-hidden="true" tabindex="-1"></a><span class="in">]</span></span>
<span id="cb4-750"><a href="#cb4-750" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-751"><a href="#cb4-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-754"><a href="#cb4-754" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-755"><a href="#cb4-755" aria-hidden="true" tabindex="-1"></a><span class="in">agesbyid = new Map(ages.map(d =&gt; [d.value, d.label]))</span></span>
<span id="cb4-756"><a href="#cb4-756" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-757"><a href="#cb4-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-760"><a href="#cb4-760" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-761"><a href="#cb4-761" aria-hidden="true" tabindex="-1"></a><span class="in">data = population.map(d =&gt; ({</span></span>
<span id="cb4-762"><a href="#cb4-762" aria-hidden="true" tabindex="-1"></a><span class="in">  id: d.id,</span></span>
<span id="cb4-763"><a href="#cb4-763" aria-hidden="true" tabindex="-1"></a><span class="in">  name: d.name,</span></span>
<span id="cb4-764"><a href="#cb4-764" aria-hidden="true" tabindex="-1"></a><span class="in">  pop_tot: +d.Total,</span></span>
<span id="cb4-765"><a href="#cb4-765" aria-hidden="true" tabindex="-1"></a><span class="in">  pop_0_9: +d["De 0 à 9 ans"],</span></span>
<span id="cb4-766"><a href="#cb4-766" aria-hidden="true" tabindex="-1"></a><span class="in">  pop_10_24: +d["De 10 à 24 ans"],</span></span>
<span id="cb4-767"><a href="#cb4-767" aria-hidden="true" tabindex="-1"></a><span class="in">  pop_25_29: +d["De 25 à 29 ans"],</span></span>
<span id="cb4-768"><a href="#cb4-768" aria-hidden="true" tabindex="-1"></a><span class="in">  pop_30_39: +d["De 30 à 39 ans"],</span></span>
<span id="cb4-769"><a href="#cb4-769" aria-hidden="true" tabindex="-1"></a><span class="in">  pop_40_49: +d["De 40 à 49 ans"],</span></span>
<span id="cb4-770"><a href="#cb4-770" aria-hidden="true" tabindex="-1"></a><span class="in">  pop_50_59: +d["De 50 à 59 ans"],</span></span>
<span id="cb4-771"><a href="#cb4-771" aria-hidden="true" tabindex="-1"></a><span class="in">  pop_60_69: +d["De 60 à 69 ans"],</span></span>
<span id="cb4-772"><a href="#cb4-772" aria-hidden="true" tabindex="-1"></a><span class="in">  pop_70_74: +d["De 70 à 74 ans"],</span></span>
<span id="cb4-773"><a href="#cb4-773" aria-hidden="true" tabindex="-1"></a><span class="in">  pop_75_79: +d["De 75 à 79 ans"],</span></span>
<span id="cb4-774"><a href="#cb4-774" aria-hidden="true" tabindex="-1"></a><span class="in">  pop_80etplus: +d["80 et plus"],</span></span>
<span id="cb4-775"><a href="#cb4-775" aria-hidden="true" tabindex="-1"></a><span class="in">  doses_tot: getdoses(d.id, "0"),</span></span>
<span id="cb4-776"><a href="#cb4-776" aria-hidden="true" tabindex="-1"></a><span class="in">  doses_0_9: getdoses(d.id, "9"),</span></span>
<span id="cb4-777"><a href="#cb4-777" aria-hidden="true" tabindex="-1"></a><span class="in">  doses_10_24: getdoses(d.id, "17") + getdoses(d.id, "24"),</span></span>
<span id="cb4-778"><a href="#cb4-778" aria-hidden="true" tabindex="-1"></a><span class="in">  doses_25_29: getdoses(d.id, "29"),</span></span>
<span id="cb4-779"><a href="#cb4-779" aria-hidden="true" tabindex="-1"></a><span class="in">  doses_30_39: getdoses(d.id, "39"),</span></span>
<span id="cb4-780"><a href="#cb4-780" aria-hidden="true" tabindex="-1"></a><span class="in">  doses_40_49: getdoses(d.id, "49"),</span></span>
<span id="cb4-781"><a href="#cb4-781" aria-hidden="true" tabindex="-1"></a><span class="in">  doses_50_59: getdoses(d.id, "59"),</span></span>
<span id="cb4-782"><a href="#cb4-782" aria-hidden="true" tabindex="-1"></a><span class="in">  doses_60_69: getdoses(d.id, "69"),</span></span>
<span id="cb4-783"><a href="#cb4-783" aria-hidden="true" tabindex="-1"></a><span class="in">  doses_70_74: getdoses(d.id, "74"),</span></span>
<span id="cb4-784"><a href="#cb4-784" aria-hidden="true" tabindex="-1"></a><span class="in">  doses_75_79: getdoses(d.id, "79"),</span></span>
<span id="cb4-785"><a href="#cb4-785" aria-hidden="true" tabindex="-1"></a><span class="in">  doses_80etplus: getdoses(d.id, "80"),</span></span>
<span id="cb4-786"><a href="#cb4-786" aria-hidden="true" tabindex="-1"></a><span class="in">  coordx: getcentroids.get(d.id)[0],</span></span>
<span id="cb4-787"><a href="#cb4-787" aria-hidden="true" tabindex="-1"></a><span class="in">  coordy: getcentroids.get(d.id)[1]</span></span>
<span id="cb4-788"><a href="#cb4-788" aria-hidden="true" tabindex="-1"></a><span class="in">}))</span></span>
<span id="cb4-789"><a href="#cb4-789" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-790"><a href="#cb4-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-793"><a href="#cb4-793" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-794"><a href="#cb4-794" aria-hidden="true" tabindex="-1"></a><span class="in">population = d3.csv(</span></span>
<span id="cb4-795"><a href="#cb4-795" aria-hidden="true" tabindex="-1"></a><span class="in">  "https://raw.githubusercontent.com/neocarto/resources/master/datasets/INSEE/popage2021.csv"</span></span>
<span id="cb4-796"><a href="#cb4-796" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb4-797"><a href="#cb4-797" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-798"><a href="#cb4-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-801"><a href="#cb4-801" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-802"><a href="#cb4-802" aria-hidden="true" tabindex="-1"></a><span class="in">//| echo: true</span></span>
<span id="cb4-803"><a href="#cb4-803" aria-hidden="true" tabindex="-1"></a><span class="in">vaccins = {</span></span>
<span id="cb4-804"><a href="#cb4-804" aria-hidden="true" tabindex="-1"></a><span class="in">  let psv = d3.dsvFormat(";");</span></span>
<span id="cb4-805"><a href="#cb4-805" aria-hidden="true" tabindex="-1"></a><span class="in">  let url =</span></span>
<span id="cb4-806"><a href="#cb4-806" aria-hidden="true" tabindex="-1"></a><span class="in">    "https://www.data.gouv.fr/fr/datasets/r/de4b356b-8cd9-4b9a-8878-459a62646107";</span></span>
<span id="cb4-807"><a href="#cb4-807" aria-hidden="true" tabindex="-1"></a><span class="in">  try {</span></span>
<span id="cb4-808"><a href="#cb4-808" aria-hidden="true" tabindex="-1"></a><span class="in">    let v = d3.csv(url);</span></span>
<span id="cb4-809"><a href="#cb4-809" aria-hidden="true" tabindex="-1"></a><span class="in">    v[0].clage_vacsi;</span></span>
<span id="cb4-810"><a href="#cb4-810" aria-hidden="true" tabindex="-1"></a><span class="in">    return v;</span></span>
<span id="cb4-811"><a href="#cb4-811" aria-hidden="true" tabindex="-1"></a><span class="in">  } catch (e) {</span></span>
<span id="cb4-812"><a href="#cb4-812" aria-hidden="true" tabindex="-1"></a><span class="in">    let v = d3.text(url).then((txt) =&gt; psv.parse(txt));</span></span>
<span id="cb4-813"><a href="#cb4-813" aria-hidden="true" tabindex="-1"></a><span class="in">    return v;</span></span>
<span id="cb4-814"><a href="#cb4-814" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-815"><a href="#cb4-815" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-816"><a href="#cb4-816" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-817"><a href="#cb4-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-818"><a href="#cb4-818" aria-hidden="true" tabindex="-1"></a><span class="fu">## Helpers</span></span>
<span id="cb4-819"><a href="#cb4-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-822"><a href="#cb4-822" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-823"><a href="#cb4-823" aria-hidden="true" tabindex="-1"></a><span class="in">//| echo: true</span></span>
<span id="cb4-824"><a href="#cb4-824" aria-hidden="true" tabindex="-1"></a><span class="in">getcentroids = new Map(</span></span>
<span id="cb4-825"><a href="#cb4-825" aria-hidden="true" tabindex="-1"></a><span class="in">  dpt.features</span></span>
<span id="cb4-826"><a href="#cb4-826" aria-hidden="true" tabindex="-1"></a><span class="in">    .map(d =&gt; {</span></span>
<span id="cb4-827"><a href="#cb4-827" aria-hidden="true" tabindex="-1"></a><span class="in">      return d;</span></span>
<span id="cb4-828"><a href="#cb4-828" aria-hidden="true" tabindex="-1"></a><span class="in">    })</span></span>
<span id="cb4-829"><a href="#cb4-829" aria-hidden="true" tabindex="-1"></a><span class="in">    .map(d =&gt; [d.properties.DEP, path.centroid(d)])</span></span>
<span id="cb4-830"><a href="#cb4-830" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb4-831"><a href="#cb4-831" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-832"><a href="#cb4-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-835"><a href="#cb4-835" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-836"><a href="#cb4-836" aria-hidden="true" tabindex="-1"></a><span class="in">getcolor = d3</span></span>
<span id="cb4-837"><a href="#cb4-837" aria-hidden="true" tabindex="-1"></a><span class="in">  .scaleQuantile()</span></span>
<span id="cb4-838"><a href="#cb4-838" aria-hidden="true" tabindex="-1"></a><span class="in">  .domain(</span></span>
<span id="cb4-839"><a href="#cb4-839" aria-hidden="true" tabindex="-1"></a><span class="in">    data.map(</span></span>
<span id="cb4-840"><a href="#cb4-840" aria-hidden="true" tabindex="-1"></a><span class="in">      d =&gt; Math.round((10000 * d["doses_" + myage]) / d["pop_" + myage]) / 100</span></span>
<span id="cb4-841"><a href="#cb4-841" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb4-842"><a href="#cb4-842" aria-hidden="true" tabindex="-1"></a><span class="in">  ) // pass the whole dataset to a scaleQuantile’s domain</span></span>
<span id="cb4-843"><a href="#cb4-843" aria-hidden="true" tabindex="-1"></a><span class="in">  .range(colors)</span></span>
<span id="cb4-844"><a href="#cb4-844" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-845"><a href="#cb4-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-848"><a href="#cb4-848" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-849"><a href="#cb4-849" aria-hidden="true" tabindex="-1"></a><span class="in">//| echo: true</span></span>
<span id="cb4-850"><a href="#cb4-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-851"><a href="#cb4-851" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-852"><a href="#cb4-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-855"><a href="#cb4-855" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-856"><a href="#cb4-856" aria-hidden="true" tabindex="-1"></a><span class="in">format = function(value) {</span></span>
<span id="cb4-857"><a href="#cb4-857" aria-hidden="true" tabindex="-1"></a><span class="in">  let v = value;</span></span>
<span id="cb4-858"><a href="#cb4-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-859"><a href="#cb4-859" aria-hidden="true" tabindex="-1"></a><span class="in">  if (value &gt;= 1000) {</span></span>
<span id="cb4-860"><a href="#cb4-860" aria-hidden="true" tabindex="-1"></a><span class="in">    let str = String(value);</span></span>
<span id="cb4-861"><a href="#cb4-861" aria-hidden="true" tabindex="-1"></a><span class="in">    let v1 = str.substring(0, str.length - 3);</span></span>
<span id="cb4-862"><a href="#cb4-862" aria-hidden="true" tabindex="-1"></a><span class="in">    let v2 = str.substring(str.length - 3, str.length);</span></span>
<span id="cb4-863"><a href="#cb4-863" aria-hidden="true" tabindex="-1"></a><span class="in">    v = v1 + " " + v2;</span></span>
<span id="cb4-864"><a href="#cb4-864" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-865"><a href="#cb4-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-866"><a href="#cb4-866" aria-hidden="true" tabindex="-1"></a><span class="in">  if (value &gt;= 100000) {</span></span>
<span id="cb4-867"><a href="#cb4-867" aria-hidden="true" tabindex="-1"></a><span class="in">    v = Math.round((100 * value) / 1000000) / 100 + " million";</span></span>
<span id="cb4-868"><a href="#cb4-868" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-869"><a href="#cb4-869" aria-hidden="true" tabindex="-1"></a><span class="in">  if (value &gt;= 2000000) {</span></span>
<span id="cb4-870"><a href="#cb4-870" aria-hidden="true" tabindex="-1"></a><span class="in">    v = Math.round((100 * value) / 1000000) / 100 + " millions";</span></span>
<span id="cb4-871"><a href="#cb4-871" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-872"><a href="#cb4-872" aria-hidden="true" tabindex="-1"></a><span class="in">  return v;</span></span>
<span id="cb4-873"><a href="#cb4-873" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-874"><a href="#cb4-874" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-875"><a href="#cb4-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-878"><a href="#cb4-878" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-879"><a href="#cb4-879" aria-hidden="true" tabindex="-1"></a><span class="in">legcircles = legendCircle()</span></span>
<span id="cb4-880"><a href="#cb4-880" aria-hidden="true" tabindex="-1"></a><span class="in">  .tickValues([</span></span>
<span id="cb4-881"><a href="#cb4-881" aria-hidden="true" tabindex="-1"></a><span class="in">    d3.min(data, d =&gt; d["doses_" + myage]),</span></span>
<span id="cb4-882"><a href="#cb4-882" aria-hidden="true" tabindex="-1"></a><span class="in">    d3.median(data, d =&gt; d["doses_" + myage]),</span></span>
<span id="cb4-883"><a href="#cb4-883" aria-hidden="true" tabindex="-1"></a><span class="in">    d3.max(data, d =&gt; d["doses_" + myage])</span></span>
<span id="cb4-884"><a href="#cb4-884" aria-hidden="true" tabindex="-1"></a><span class="in">  ])</span></span>
<span id="cb4-885"><a href="#cb4-885" aria-hidden="true" tabindex="-1"></a><span class="in">  .scale(radius)</span></span>
<span id="cb4-886"><a href="#cb4-886" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-887"><a href="#cb4-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-890"><a href="#cb4-890" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-891"><a href="#cb4-891" aria-hidden="true" tabindex="-1"></a><span class="in">ratiobyid = new Map(</span></span>
<span id="cb4-892"><a href="#cb4-892" aria-hidden="true" tabindex="-1"></a><span class="in">  data.map(d =&gt; [</span></span>
<span id="cb4-893"><a href="#cb4-893" aria-hidden="true" tabindex="-1"></a><span class="in">    d.id,</span></span>
<span id="cb4-894"><a href="#cb4-894" aria-hidden="true" tabindex="-1"></a><span class="in">    Math.round((10000 * d["doses_" + myage]) / d["pop_" + myage]) / 100</span></span>
<span id="cb4-895"><a href="#cb4-895" aria-hidden="true" tabindex="-1"></a><span class="in">  ])</span></span>
<span id="cb4-896"><a href="#cb4-896" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb4-897"><a href="#cb4-897" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-898"><a href="#cb4-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-901"><a href="#cb4-901" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-902"><a href="#cb4-902" aria-hidden="true" tabindex="-1"></a><span class="in">color = d3.scaleThreshold([1, 2, 3, 4, 5, 6, 7, 8, 9, 10], colors)</span></span>
<span id="cb4-903"><a href="#cb4-903" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-904"><a href="#cb4-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-907"><a href="#cb4-907" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-908"><a href="#cb4-908" aria-hidden="true" tabindex="-1"></a><span class="in">simulation = d3</span></span>
<span id="cb4-909"><a href="#cb4-909" aria-hidden="true" tabindex="-1"></a><span class="in">  .forceSimulation(data)</span></span>
<span id="cb4-910"><a href="#cb4-910" aria-hidden="true" tabindex="-1"></a><span class="in">  .force("x", d3.forceX(d =&gt; d.coordx))</span></span>
<span id="cb4-911"><a href="#cb4-911" aria-hidden="true" tabindex="-1"></a><span class="in">  .force("y", d3.forceY(d =&gt; d.coordy))</span></span>
<span id="cb4-912"><a href="#cb4-912" aria-hidden="true" tabindex="-1"></a><span class="in">  .force(</span></span>
<span id="cb4-913"><a href="#cb4-913" aria-hidden="true" tabindex="-1"></a><span class="in">    "collide",</span></span>
<span id="cb4-914"><a href="#cb4-914" aria-hidden="true" tabindex="-1"></a><span class="in">    d3.forceCollide(d =&gt; 0.5 + radius(+d["doses_" + myage]) + 1)</span></span>
<span id="cb4-915"><a href="#cb4-915" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb4-916"><a href="#cb4-916" aria-hidden="true" tabindex="-1"></a><span class="in">  .stop()</span></span>
<span id="cb4-917"><a href="#cb4-917" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-918"><a href="#cb4-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-921"><a href="#cb4-921" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-922"><a href="#cb4-922" aria-hidden="true" tabindex="-1"></a><span class="in">getdoses = function (dep, age) {</span></span>
<span id="cb4-923"><a href="#cb4-923" aria-hidden="true" tabindex="-1"></a><span class="in">  let x = vaccins</span></span>
<span id="cb4-924"><a href="#cb4-924" aria-hidden="true" tabindex="-1"></a><span class="in">    .filter((d) =&gt; d.dep == dep)</span></span>
<span id="cb4-925"><a href="#cb4-925" aria-hidden="true" tabindex="-1"></a><span class="in">    .filter((d) =&gt; d.clage_vacsi == age);</span></span>
<span id="cb4-926"><a href="#cb4-926" aria-hidden="true" tabindex="-1"></a><span class="in">  let v = x.map((d) =&gt; +d.n_tot_dose1 + +d.n_tot_complet);</span></span>
<span id="cb4-927"><a href="#cb4-927" aria-hidden="true" tabindex="-1"></a><span class="in">  let value;</span></span>
<span id="cb4-928"><a href="#cb4-928" aria-hidden="true" tabindex="-1"></a><span class="in">  v.length == 0 ? (value = 0) : (value = v[0]);</span></span>
<span id="cb4-929"><a href="#cb4-929" aria-hidden="true" tabindex="-1"></a><span class="in">  return +value;</span></span>
<span id="cb4-930"><a href="#cb4-930" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-931"><a href="#cb4-931" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-932"><a href="#cb4-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-935"><a href="#cb4-935" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-936"><a href="#cb4-936" aria-hidden="true" tabindex="-1"></a><span class="in">//| echo: true</span></span>
<span id="cb4-937"><a href="#cb4-937" aria-hidden="true" tabindex="-1"></a><span class="in">datetodate = function(dat) {</span></span>
<span id="cb4-938"><a href="#cb4-938" aria-hidden="true" tabindex="-1"></a><span class="in">  let m = [</span></span>
<span id="cb4-939"><a href="#cb4-939" aria-hidden="true" tabindex="-1"></a><span class="in">    "mois",</span></span>
<span id="cb4-940"><a href="#cb4-940" aria-hidden="true" tabindex="-1"></a><span class="in">    "janvier",</span></span>
<span id="cb4-941"><a href="#cb4-941" aria-hidden="true" tabindex="-1"></a><span class="in">    "février",</span></span>
<span id="cb4-942"><a href="#cb4-942" aria-hidden="true" tabindex="-1"></a><span class="in">    "mars",</span></span>
<span id="cb4-943"><a href="#cb4-943" aria-hidden="true" tabindex="-1"></a><span class="in">    "avril",</span></span>
<span id="cb4-944"><a href="#cb4-944" aria-hidden="true" tabindex="-1"></a><span class="in">    "mai",</span></span>
<span id="cb4-945"><a href="#cb4-945" aria-hidden="true" tabindex="-1"></a><span class="in">    "juin",</span></span>
<span id="cb4-946"><a href="#cb4-946" aria-hidden="true" tabindex="-1"></a><span class="in">    "juillet",</span></span>
<span id="cb4-947"><a href="#cb4-947" aria-hidden="true" tabindex="-1"></a><span class="in">    "août",</span></span>
<span id="cb4-948"><a href="#cb4-948" aria-hidden="true" tabindex="-1"></a><span class="in">    "septembre",</span></span>
<span id="cb4-949"><a href="#cb4-949" aria-hidden="true" tabindex="-1"></a><span class="in">    "octobre",</span></span>
<span id="cb4-950"><a href="#cb4-950" aria-hidden="true" tabindex="-1"></a><span class="in">    "novembre",</span></span>
<span id="cb4-951"><a href="#cb4-951" aria-hidden="true" tabindex="-1"></a><span class="in">    "décembre"</span></span>
<span id="cb4-952"><a href="#cb4-952" aria-hidden="true" tabindex="-1"></a><span class="in">  ];</span></span>
<span id="cb4-953"><a href="#cb4-953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-954"><a href="#cb4-954" aria-hidden="true" tabindex="-1"></a><span class="in">  let j1 = +dat.substr(8, 2);</span></span>
<span id="cb4-955"><a href="#cb4-955" aria-hidden="true" tabindex="-1"></a><span class="in">  let j = j1 == 1 ? j1 + "er" : j1;</span></span>
<span id="cb4-956"><a href="#cb4-956" aria-hidden="true" tabindex="-1"></a><span class="in">  let m1 = m[+dat.substr(5, 2)];</span></span>
<span id="cb4-957"><a href="#cb4-957" aria-hidden="true" tabindex="-1"></a><span class="in">  let a1 = dat.substr(0, 4);</span></span>
<span id="cb4-958"><a href="#cb4-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-959"><a href="#cb4-959" aria-hidden="true" tabindex="-1"></a><span class="in">  return j + " " + m1 + " " + a1;</span></span>
<span id="cb4-960"><a href="#cb4-960" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-961"><a href="#cb4-961" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-962"><a href="#cb4-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-965"><a href="#cb4-965" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-966"><a href="#cb4-966" aria-hidden="true" tabindex="-1"></a><span class="in">scaleBar = d3</span></span>
<span id="cb4-967"><a href="#cb4-967" aria-hidden="true" tabindex="-1"></a><span class="in">  .geoScaleBar()</span></span>
<span id="cb4-968"><a href="#cb4-968" aria-hidden="true" tabindex="-1"></a><span class="in">  .projection(projection)</span></span>
<span id="cb4-969"><a href="#cb4-969" aria-hidden="true" tabindex="-1"></a><span class="in">  .size([900, 860])</span></span>
<span id="cb4-970"><a href="#cb4-970" aria-hidden="true" tabindex="-1"></a><span class="in">  .left(.9)</span></span>
<span id="cb4-971"><a href="#cb4-971" aria-hidden="true" tabindex="-1"></a><span class="in">  .top(.99)</span></span>
<span id="cb4-972"><a href="#cb4-972" aria-hidden="true" tabindex="-1"></a><span class="in">  .units(d3.geoScaleKilometers)</span></span>
<span id="cb4-973"><a href="#cb4-973" aria-hidden="true" tabindex="-1"></a><span class="in">  .distance(100)</span></span>
<span id="cb4-974"><a href="#cb4-974" aria-hidden="true" tabindex="-1"></a><span class="in">  .label("100 km")</span></span>
<span id="cb4-975"><a href="#cb4-975" aria-hidden="true" tabindex="-1"></a><span class="in">  .labelAnchor("middle")</span></span>
<span id="cb4-976"><a href="#cb4-976" aria-hidden="true" tabindex="-1"></a><span class="in">  .tickSize(null)</span></span>
<span id="cb4-977"><a href="#cb4-977" aria-hidden="true" tabindex="-1"></a><span class="in">  .tickValues(null)</span></span>
<span id="cb4-978"><a href="#cb4-978" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-979"><a href="#cb4-979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-982"><a href="#cb4-982" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-983"><a href="#cb4-983" aria-hidden="true" tabindex="-1"></a><span class="in">radius = d3.scaleSqrt([0, d3.max(data, d =&gt; +d["doses_" + myage])], [0, 30])</span></span>
<span id="cb4-984"><a href="#cb4-984" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-985"><a href="#cb4-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-986"><a href="#cb4-986" aria-hidden="true" tabindex="-1"></a><span class="fu">## Depedencies</span></span>
<span id="cb4-987"><a href="#cb4-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-990"><a href="#cb4-990" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-991"><a href="#cb4-991" aria-hidden="true" tabindex="-1"></a><span class="in">import { Scrubber } from "@mbostock/scrubber"</span></span>
<span id="cb4-992"><a href="#cb4-992" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-993"><a href="#cb4-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-996"><a href="#cb4-996" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-997"><a href="#cb4-997" aria-hidden="true" tabindex="-1"></a><span class="in">import { select, radio, slider } from "@jashkenas/inputs"</span></span>
<span id="cb4-998"><a href="#cb4-998" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-999"><a href="#cb4-999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-1002"><a href="#cb4-1002" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-1003"><a href="#cb4-1003" aria-hidden="true" tabindex="-1"></a><span class="in">import { legendCircle } from "@harrystevens/circle-legend"</span></span>
<span id="cb4-1004"><a href="#cb4-1004" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-1005"><a href="#cb4-1005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-1008"><a href="#cb4-1008" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-1009"><a href="#cb4-1009" aria-hidden="true" tabindex="-1"></a><span class="in">import { legend } from "@d3/color-legend"</span></span>
<span id="cb4-1010"><a href="#cb4-1010" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-1011"><a href="#cb4-1011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-1014"><a href="#cb4-1014" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-1015"><a href="#cb4-1015" aria-hidden="true" tabindex="-1"></a><span class="in">topojson = require('topojson')</span></span>
<span id="cb4-1016"><a href="#cb4-1016" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-1017"><a href="#cb4-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-1020"><a href="#cb4-1020" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-1021"><a href="#cb4-1021" aria-hidden="true" tabindex="-1"></a><span class="in">d3 = require("d3@6", "d3-geo-scale-bar@1.0.2")</span></span>
<span id="cb4-1022"><a href="#cb4-1022" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
<!-- -->
</section>
</main>
<div class="page-navigation page-navigation-docked">
  <div class="nav-page nav-page-previous">
      <a href="../../../../docs/interactive/js/examples/passeports-colors.html">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Passports &amp; Colors</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../../../docs/interactive/js/examples/mens-tennis/mens-tennis.html">
        <span class="nav-page-text">Men's Tennis</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</div>
</div> <!-- /main column -->
</div> <!-- /row -->
</div> <!-- /container fluid -->
<script type="text/javascript">

// replace cmd keyboard shortcut w/ control on non-Mac platforms
const kPlatformMac = typeof navigator !== 'undefined' ? /Mac/.test(navigator.platform) : false;
if (!kPlatformMac) {
   var kbds = document.querySelectorAll("kbd")
   kbds.forEach(function(kbd) {
      kbd.innerHTML = kbd.innerHTML.replace(/⌘/g, '⌃');
   });
}

</script>
<script type="ojs-module-contents">
{"contents":[{"methodName":"interpret","cellName":"ojs-cell-1","inline":false,"source":"viewof myage = {\n  const myage = select({\n    title: \"Quelle classe d'âge voulez-vous cartographier ?\",\n    options: ages,\n    value: \"80etplus\"\n  });\n  return myage;\n}"},{"methodName":"interpret","cellName":"ojs-cell-2","inline":false,"source":"viewof pctvax = slider({\n  title: '<br/>Objectif de vaccination',\n  description: '200% signifie 2 doses par personnes pour tout le monde',\n  min: 50,\n  max: 200,\n  value: 200,\n  step: 10,\n  format: v => v + \"%\"\n})"},{"methodName":"interpret","cellName":"ojs-cell-3","inline":false,"source":"viewof overlay = radio({\n  title: \"Écarter les cercles\",\n  options: [{ label: 'Oui', value: 'Y' }, { label: 'Non', value: 'N' }],\n  value: 'N'\n})"},{"methodName":"interpret","cellName":"ojs-cell-4","inline":false,"source":"viewof label = radio({\n  title: \"Numéros des départements\",\n  options: [{ label: 'Afficher', value: 'Y' }, { label: 'Masquer', value: 'N' }],\n  value: 'N'\n})"},{"methodName":"interpret","cellName":"ojs-cell-5","inline":false,"source":"map = {\n  for (let i = 0; i < 200; i++) {\n    simulation.tick();\n  }\n\n  const svg = d3\n    .create(\"svg\")\n    .attr(\"viewBox\", [0, 0, width, height])\n    .style('background-color', \"white\");\n\n  // Filters\n\n  var defs = svg.append(\"defs\");\n\n  const pattern = defs\n    .append(\"pattern\")\n    .attr(\"id\", \"hatch\")\n    .attr(\"patternUnits\", \"userSpaceOnUse\")\n    .attr(\"width\", 6)\n    .attr(\"height\", 6);\n\n  const filter = defs\n    .append('filter')\n    .attr('id', 'border-blur')\n    .append('feGaussianBlur')\n    .attr('in', 'SourceGraphic')\n    .attr('stdDeviation', 10)\n    .attr('result', 'shadow');\n\n  const filter2 = defs\n    .append('filter')\n    .attr('id', 'border-blur2')\n    .append('feGaussianBlur')\n    .attr('in', 'SourceGraphic')\n    .attr('stdDeviation', 50)\n    .attr('result', 'shadow');\n\n  pattern\n    .append(\"line\")\n    .attr(\"x1\", 0)\n    .attr(\"y1\", 0)\n    .attr(\"x2\", 6)\n    .attr(\"y1\", 6)\n    .attr(\"stroke\", \"#f4f4f4\")\n    .attr(\"stroke-width\", 1)\n    .attr(\"stroke-opacity\", 0.4);\n\n  svg\n    .append(\"rect\")\n    .attr(\"x\", 0)\n    .attr(\"y\", 0)\n    .attr(\"width\", width)\n    .attr(\"height\", height)\n    .style('fill', \"#9ACBE3\")\n    .attr('filter', 'url(#border-blur2)');\n\n  svg\n    .append(\"rect\")\n    .attr(\"fill-opacity\", 0.4)\n    .attr(\"x\", 0)\n    .attr(\"y\", 0)\n    .attr(\"width\", width)\n    .attr(\"height\", height)\n    .attr('fill', \"url('#hatch')\");\n\n  // Graticule\n\n  svg\n    .append(\"g\")\n    .append(\"path\")\n    .datum(graticule)\n    .attr(\"class\", \"graticule\")\n    .attr(\"d\", path)\n    .attr(\"clip-path\", \"url(#clip)\")\n    .style('fill', \"none\")\n    .style('stroke', \"white\")\n    .style('stroke-width', .5)\n    .style('stroke-opacity', .4)\n    .style('stroke-dasharray', 0.5);\n\n  // Boxes for remotes territories\n\n  const delta = 12;\n\n  svg\n    .append(\"rect\")\n    .attr(\"x\", 30)\n    .attr(\"y\", 480)\n    .attr(\"width\", 80)\n    .attr(\"height\", 80)\n    .attr(\"stroke\", \"white\")\n    .style('fill', \"#9ACBE3\");\n\n  svg\n    .append(\"rect\")\n    .attr(\"x\", 30)\n    .attr(\"y\", 480 + 80 + delta)\n    .attr(\"width\", 80)\n    .attr(\"height\", 80)\n    .attr(\"stroke\", \"white\")\n    .style('fill', \"#9ACBE3\");\n\n  svg\n    .append(\"rect\")\n    .attr(\"x\", 30)\n    .attr(\"y\", 480 + 80 + 80 + delta + delta)\n    .attr(\"width\", 80)\n    .attr(\"height\", 80)\n    .attr(\"stroke\", \"white\")\n    .style('fill', \"#9ACBE3\");\n\n  svg\n    .append(\"rect\")\n    .attr(\"x\", 670)\n    .attr(\"y\", 885)\n    .attr(\"width\", 80)\n    .attr(\"height\", 80)\n    .attr(\"stroke\", \"white\")\n    .style('fill', \"#9ACBE3\");\n\n  svg\n    .append(\"rect\")\n    .attr(\"x\", 670 + 80 + delta)\n    .attr(\"y\", 885)\n    .attr(\"width\", 80)\n    .attr(\"height\", 80)\n    .attr(\"stroke\", \"white\")\n    .style('fill', \"#9ACBE3\");\n\n  svg\n    .append(\"path\")\n    .datum(land)\n    .attr(\"d\", path)\n    .style(\"fill\", \"white\")\n    .attr(\"fill-opacity\", .6)\n    .attr('filter', 'url(#border-blur)');\n\n  // Chart\n\n  let infos = svg\n    .append(\"g\")\n    .attr(\"id\", \"tooltip\")\n    .attr(\"font-family\", \"sans-serif\")\n    .attr(\"font-weight\", \"bold\");\n\n  let chart_x = 830;\n  let chart_y = 155;\n  let chart_height = 400;\n  let rect_max = 270;\n  let myval = 50;\n\n  let fr_label = \"France\";\n  let fr_pop = format(d3.sum(data, d => d[\"pop_\" + myage]));\n  let fr_doses = format(d3.sum(data, d => d[\"doses_\" + myage]));\n  let fr_tx =\n    (100 * d3.sum(data, d => d[\"doses_\" + myage])) /\n    d3.sum(data, d => d[\"pop_\" + myage]);\n  let fr_ratio =\n    Math.round(\n      (1000 * d3.sum(data, d => d[\"doses_\" + myage])) /\n        d3.sum(data, d => d[\"pop_\" + myage])\n    ) /\n      10 +\n    \"%\";\n\n  infos\n    .append(\"rect\")\n    .attr(\"id\", \"info_rect\")\n    .attr(\"x\", 870)\n    .attr(\"width\", 55)\n    .attr(\"height\", fr_tx * (rect_max / pctvax))\n    .attr(\"y\", 217 - fr_tx * (rect_max / pctvax) + rect_max)\n    .attr(\"fill\", \"#647382\");\n\n  let seringue = svg\n    .append(\"svg:image\")\n    .attr(\"x\", chart_x)\n    .attr(\"y\", chart_y)\n    .attr(\"height\", chart_height)\n    .attr(\n      \"xlink:href\",\n      \"https://nlambert.gitpages.huma-num.fr/resources/images/sering_b.svg\"\n    );\n\n  svg\n    .append(\"line\")\n    .attr(\"x1\", 920)\n    .attr(\"x2\", 956)\n    .attr(\"y1\", 102)\n    .attr(\"y2\", 102)\n    .attr(\"stroke\", countrycol)\n    .attr(\"stroke-linecap\", \"round\")\n    .attr(\"stroke-width\", 2.5);\n\n  svg\n    .append(\"line\")\n    .attr(\"x1\", 956)\n    .attr(\"x2\", 956)\n    .attr(\"y1\", 102)\n    .attr(\"y2\", 140)\n    .attr(\"stroke\", countrycol)\n    .attr(\"stroke-linecap\", \"round\")\n    .attr(\"stroke-width\", 2.5);\n\n  infos\n    .append(\"text\")\n    .attr(\"id\", \"info_name\")\n    .attr(\"x\", width - 60)\n    .attr(\"y\", 137)\n    .attr(\"text-anchor\", \"end\")\n    .attr(\"fill\", countrycol)\n    .style(\"font-size\", \"35px\")\n    .text(fr_label);\n\n  let yref = 580;\n\n  infos\n    .append(\"text\")\n    .attr(\"x\", 895)\n    .attr(\"y\", yref)\n    .attr(\"text-anchor\", \"middle\")\n    .attr(\"fill\", countrycol)\n    .style(\"font-size\", \"15px\")\n    .text(\"Nombre de personnes\");\n\n  infos\n    .append(\"text\")\n    .attr(\"id\", \"info_pop\")\n    .attr(\"x\", 895)\n    .attr(\"y\", yref + 27)\n    .attr(\"text-anchor\", \"middle\")\n    .attr(\"fill\", \"#4a524d\")\n    .attr(\"fill-opacity\", 0.8)\n    .style(\"font-size\", \"20px\")\n    .text(fr_pop);\n\n  infos\n    .append(\"text\")\n    .attr(\"x\", 895)\n    .attr(\"y\", yref + 50)\n    .attr(\"text-anchor\", \"middle\")\n    .attr(\"fill\", countrycol)\n    .style(\"font-size\", \"15px\")\n    .text(\"Nombre de doses\");\n\n  infos\n    .append(\"text\")\n    .attr(\"id\", \"info_doses\")\n    .attr(\"x\", 895)\n    .attr(\"y\", yref + 27 + 50)\n    .attr(\"text-anchor\", \"middle\")\n    .attr(\"fill\", \"#4a524d\")\n    .attr(\"fill-opacity\", 0.8)\n    .style(\"font-size\", \"20px\")\n    .text(fr_doses);\n\n  infos\n    .append(\"text\")\n    .attr(\"x\", 895)\n    .attr(\"y\", yref + 100)\n    .attr(\"text-anchor\", \"middle\")\n    .attr(\"fill\", countrycol)\n    .style(\"font-size\", \"15px\")\n    .text(\"Ratio\");\n\n  infos\n    .append(\"text\")\n    .attr(\"id\", \"info_tx\")\n    .attr(\"x\", 895)\n    .attr(\"y\", yref + 42 + 100)\n    .attr(\"text-anchor\", \"middle\")\n    .attr(\"fill\", \"#4a524d\")\n    .attr(\"fill-opacity\", 0.8)\n    .style(\"font-size\", \"40px\")\n    .text(fr_ratio);\n\n  // Basemap;\n\n  svg\n    .append(\"g\")\n    .attr(\"id\", \"map\")\n    .selectAll(\"path\")\n    .data(dpt.features)\n    .join(\"path\")\n    .attr(\"class\", \"dpt\")\n    .attr(\"stroke\", overlay == \"N\" ? \"white\" : countrycol)\n    .attr(\"stroke-width\", 0.5)\n    .attr(\"fill\", countrycol)\n    .attr(\"fill-opacity\", fr_doses == 0 ? 0.1 : 1)\n    .attr(\"stroke-opacity\", fr_doses == 0 ? 0 : 1)\n    .attr(\"d\", path);\n\n  svg\n    .append(\"path\")\n    .datum(france)\n    .attr(\"d\", path)\n    .attr(\"fill\", \"none\")\n    .attr(\"stroke\", \"#75a8c9\")\n    .attr(\"stroke-width\", 1);\n\n  // Bubbles;\n\n  if (fr_doses != 0) {\n    svg\n      .append(\"g\")\n      .attr(\"fill-opacity\", 0.9)\n      .attr(\"stroke\", \"#fff\")\n      .attr(\"stroke-width\", 0.5)\n      .selectAll(\"circle\")\n      .data(\n        data\n          .filter(d => d.coordx)\n          .sort((a, b) =>\n            d3.descending(a[\"doses_\" + myage], b[\"doses_\" + myage])\n          )\n      )\n\n      .join(\"circle\")\n      .attr(\"id\", d => d.id)\n      .attr(\"fill\", d => getcolor(ratiobyid.get(d.id)))\n      .attr(\"cx\", overlay == 'N' ? d => d.coordx : d => d.x)\n      .attr(\"cy\", overlay == 'N' ? d => d.coordy : d => d.y)\n      .attr(\"r\", d => radius(+d[\"doses_\" + myage]))\n      // Interactivity\n      .on(\"touchmove mousemove\", function(event, d) {\n        let tx = (100 * d[\"doses_\" + myage]) / d[\"pop_\" + myage];\n\n        d3.select(this)\n          .style(\"cursor\", \"pointer\")\n          .attr(\"stroke\", \"red\")\n          .attr(\"stroke-width\", 2);\n        d3.select(\"#info_rect\")\n          .attr(\"height\", tx * (rect_max / pctvax))\n          .attr(\"y\", 217 - tx * (rect_max / pctvax) + rect_max)\n          .attr(\"fill\", getcolor(tx));\n        d3.select(\"#info_name\").text(d.name);\n        d3.select(\"#info_pop\").text(format(d[\"pop_\" + myage]));\n        d3.select(\"#info_doses\").text(format(d[\"doses_\" + myage]));\n        d3.select(\"#info_tx\").text(\n          Math.round(1000 * (d[\"doses_\" + myage] / d[\"pop_\" + myage])) / 10 +\n            \"%\"\n        );\n      })\n      .on(\"touchend mouseleave\", function() {\n        d3.select(this)\n          .attr(\"stroke\", \"white\")\n          .attr(\"stroke-width\", 0.5);\n        d3.select(\"#info_rect\")\n          .attr(\"height\", fr_tx * (rect_max / pctvax))\n          .attr(\"y\", 217 - fr_tx * (rect_max / pctvax) + rect_max)\n          .attr(\"fill\", \"#647382\");\n        d3.select(\"#info_name\").text(fr_label);\n        d3.select(\"#info_pop\").text(fr_pop);\n        d3.select(\"#info_doses\").text(fr_doses);\n        d3.select(\"#info_tx\").text(fr_ratio);\n      });\n  }\n\n  //labels\n\n  if (label == \"Y\") {\n    svg\n      .selectAll(\"text\")\n      .data(data)\n      .enter()\n      .append(\"text\")\n      .attr(\"x\", d => (overlay == \"N\" ? d.coordx : d.x))\n      .attr(\"y\", d => (overlay == \"N\" ? d.coordy : d.y))\n      .text(d => d.id)\n      .attr(\"text-anchor\", \"middle\")\n      .attr(\"dominant-baseline\", \"middle\")\n      .attr(\"font-family\", function(d, i) {\n        return i < 5 ? \"serif\" : \"sans-serif\";\n      })\n      .attr(\"fill\", \"#4e524f\")\n      .style(\"font-size\", \"12px\");\n  }\n\n  // Legend\n\n  if (fr_doses != 0) {\n    svg\n      .append(\"text\")\n      .attr(\"x\", 35)\n      .attr(\"y\", 905)\n      .text(\"Nombre de doses / nombre de personnes (en %)\")\n      .attr(\"font-family\", \"sans-serif\")\n      .attr(\"font-weight\", \"bold\")\n      .attr(\"fill\", \"#4a524d\")\n      .style(\"font-size\", \"16px\");\n\n    svg\n      .append(\"g\")\n      .attr(\"transform\", \"translate(35, 900)\")\n      .append(() =>\n        legend({\n          color: getcolor,\n          width: 360,\n          height: 60,\n          tickFormat: \".1f\"\n        })\n      );\n\n    svg\n      .append(\"text\")\n      .attr(\"x\", 35)\n      .attr(\"y\", 780)\n      .text(\"Nombre de doses\")\n      .attr(\"font-family\", \"sans-serif\")\n      .attr(\"font-weight\", \"bold\")\n      .attr(\"fill\", \"#4a524d\")\n      .style(\"font-size\", \"16px\");\n\n    svg\n      .append(\"g\")\n      .attr(\"transform\", `translate(35, 800)`)\n      .call(legcircles);\n  }\n\n  // Title\n\n  svg\n    .append(\"rect\")\n    .attr(\"x\", 0)\n    .attr(\"y\", 0)\n    .attr(\"width\", width)\n    .attr(\"height\", 80)\n    .attr(\"fill\", countrycol)\n    .attr(\"fill-opacity\", 0.3);\n\n  svg\n    .append(\"text\")\n    .text(\n      \"État de la vaccination dans votre département au \" + datetodate(mydate)\n    )\n    .attr(\"x\", width / 2)\n    .attr(\"y\", 50)\n    .attr(\"font-family\", \"sans-serif\")\n    .attr(\"font-weight\", \"bold\")\n    .attr(\"text-anchor\", \"middle\")\n    .attr(\"fill\", \"#4a524d\")\n    .style(\"font-size\", \"28px\")\n    .attr(\"fill-opacity\", 1);\n\n  // Staging\n\n  svg\n    .append(\"g\")\n    .attr(\"transform\", `translate(-100, 0)`)\n    .append(\"g\")\n    .call(scaleBar);\n\n  var source = svg\n    .append(\"text\")\n    .attr(\"x\", 0)\n    .attr(\"y\", 0)\n    .attr('transform', 'translate(17,973) rotate(-90)')\n    .text(txtsource)\n    .attr(\"font-family\", \"sans-serif\")\n    .style(\"font-size\", \"11px\")\n    .style(\"font-style\", \"italic\")\n    .attr(\"fill-opacity\", 1)\n    .style('fill', \"#616161\");\n\n  svg\n    .append(\"text\")\n    .attr(\"x\", 210)\n    .attr(\"y\", 120)\n    .text(\"Classe d'âge\")\n    .attr(\"font-family\", \"sans-serif\")\n    .attr(\"font-weight\", \"bold\")\n    .attr(\"text-anchor\", \"middle\")\n    .attr(\"fill\", \"#4a524d\")\n    .attr(\"fill-opacity\", 0.8)\n    .style(\"font-size\", \"16px\");\n\n  svg\n    .append(\"rect\")\n    .attr(\"x\", 82)\n    .attr(\"y\", 133)\n    .attr(\"width\", 260)\n    .attr(\"height\", 50)\n    .attr(\"stroke\", \"#4a524d\")\n    .attr(\"stroke-opacity\", 0.8)\n    .attr(\"fill\", \"none\");\n\n  svg\n    .append(\"text\")\n    .attr(\"x\", 210)\n    .attr(\"y\", 170)\n    .text(agesbyid.get(myage))\n    .attr(\"font-family\", \"sans-serif\")\n    .attr(\"font-weight\", \"bold\")\n    .attr(\"text-anchor\", \"middle\")\n    .attr(\"fill\", \"#4a524d\")\n    .attr(\"fill-opacity\", 0.8)\n    .style(\"font-size\", \"35px\");\n\n  // Signature\n\n  svg\n    .append(\"svg:image\")\n    .attr(\"x\", 954)\n    .attr(\"y\", 960)\n    .attr(\"width\", 40)\n    .attr(\n      \"xlink:href\",\n      \"https://nlambert.gitpages.huma-num.fr/resources/images/signature_black.svg\"\n    );\n\n  return svg.node();\n}"},{"methodName":"interpret","cellName":"ojs-cell-6","inline":false,"source":"txtlegend = \"Taux de vaccination dans les départements (%)\""},{"methodName":"interpret","cellName":"ojs-cell-7","inline":false,"source":"txtsource = \"Carte réalisée par Nicolas Lambert, 2021. Sources : Santé publique France (https://www.data.gouv.fr/fr/datasets/donnees-relatives-aux-personnes-vaccinees-contre-la-covid-19-1/)\""},{"methodName":"interpret","cellName":"ojs-cell-8","inline":false,"source":"countrycol = \"#a3b7cc\""},{"methodName":"interpret","cellName":"ojs-cell-9","inline":false,"source":"mydate = d3.max(vaccins, d => d.jour)"},{"methodName":"interpret","cellName":"ojs-cell-10","inline":false,"source":"yellow = \"#fbd14b\""},{"methodName":"interpret","cellName":"ojs-cell-11","inline":false,"source":"height = 980"},{"methodName":"interpret","cellName":"ojs-cell-12","inline":false,"source":"width = 1000"},{"methodName":"interpret","cellName":"ojs-cell-13","inline":false,"source":"colors = [\n  '#a50026',\n  '#d73027',\n  '#f46d43',\n  '#fdae61',\n  '#fee08b',\n  '#ffffbf',\n  '#d9ef8b',\n  '#a6d96a',\n  '#66bd63',\n  '#1a9850',\n  '#006837'\n]"},{"methodName":"interpret","cellName":"ojs-cell-14","inline":false,"source":"features = new Map(\n  dpt.features\n    .map(d => {\n      d.properties.centroid = d3.geoCentroid(d);\n      return d;\n    })\n    .map(d => [d.properties.DEP, d])\n)"},{"methodName":"interpret","cellName":"ojs-cell-15","inline":false,"source":"land = topojson.merge(\n  countries,\n  countries.objects.CNTR_RG_10M_2020_4326.geometries\n)"},{"methodName":"interpret","cellName":"ojs-cell-16","inline":false,"source":"dpt = topojson.feature(departements, departements.objects.DEPT)"},{"methodName":"interpret","cellName":"ojs-cell-17","inline":false,"source":"departements = d3.json(\n  \"https://raw.githubusercontent.com/neocarto/resources/master/geometries/France/departements.json\"\n)"},{"methodName":"interpret","cellName":"ojs-cell-18","inline":false,"source":"france = topojson.merge(departements, departements.objects.DEPT.geometries)"},{"methodName":"interpret","cellName":"ojs-cell-19","inline":false,"source":"countries = d3.json(\n  \"https://raw.githubusercontent.com/neocarto/resources/master/geometries/World/GISCO_CNTR_RG_10M_2020_4326.json\"\n)"},{"methodName":"interpret","cellName":"ojs-cell-20","inline":false,"source":"outline = ({ type: \"Sphere\" })"},{"methodName":"interpret","cellName":"ojs-cell-21","inline":false,"source":"graticule = d3.geoGraticule().step([1, 0.7])"},{"methodName":"interpret","cellName":"ojs-cell-22","inline":false,"source":"path = d3.geoPath(projection)"},{"methodName":"interpret","cellName":"ojs-cell-23","inline":false,"source":"projection = d3\n  .geoConicConformal() // Lambert-93\n  .center([2.454071, 46.279229]) // Center on France\n  .scale(5000)\n  .translate([width / 2 - 10, height / 2 + 50])"},{"methodName":"interpret","cellName":"ojs-cell-24","inline":false,"source":"ages = [\n  { label: \"Tous les âges\", value: \"tot\" },\n  { label: \"De 0 à 9 ans\", value: \"0_9\" },\n  { label: \"De 10 à 24 ans\", value: \"10_24\" },\n  { label: \"De 25 à 29 ans\", value: \"25_29\" },\n  { label: \"De 30 à 39 ans\", value: \"30_39\" },\n  { label: \"De 40 à 49 ans\", value: \"40_49\" },\n  { label: \"De 50 à 59 ans\", value: \"50_59\" },\n  { label: \"De 60 à 69 ans\", value: \"60_69\" },\n  { label: \"De 70 à 74 ans\", value: \"70_74\" },\n  { label: \"De 75 à 79 ans\", value: \"75_79\" },\n  { label: \"80 ans et plus\", value: \"80etplus\" }\n]"},{"methodName":"interpret","cellName":"ojs-cell-25","inline":false,"source":"agesbyid = new Map(ages.map(d => [d.value, d.label]))"},{"methodName":"interpret","cellName":"ojs-cell-26","inline":false,"source":"data = population.map(d => ({\n  id: d.id,\n  name: d.name,\n  pop_tot: +d.Total,\n  pop_0_9: +d[\"De 0 à 9 ans\"],\n  pop_10_24: +d[\"De 10 à 24 ans\"],\n  pop_25_29: +d[\"De 25 à 29 ans\"],\n  pop_30_39: +d[\"De 30 à 39 ans\"],\n  pop_40_49: +d[\"De 40 à 49 ans\"],\n  pop_50_59: +d[\"De 50 à 59 ans\"],\n  pop_60_69: +d[\"De 60 à 69 ans\"],\n  pop_70_74: +d[\"De 70 à 74 ans\"],\n  pop_75_79: +d[\"De 75 à 79 ans\"],\n  pop_80etplus: +d[\"80 et plus\"],\n  doses_tot: getdoses(d.id, \"0\"),\n  doses_0_9: getdoses(d.id, \"9\"),\n  doses_10_24: getdoses(d.id, \"17\") + getdoses(d.id, \"24\"),\n  doses_25_29: getdoses(d.id, \"29\"),\n  doses_30_39: getdoses(d.id, \"39\"),\n  doses_40_49: getdoses(d.id, \"49\"),\n  doses_50_59: getdoses(d.id, \"59\"),\n  doses_60_69: getdoses(d.id, \"69\"),\n  doses_70_74: getdoses(d.id, \"74\"),\n  doses_75_79: getdoses(d.id, \"79\"),\n  doses_80etplus: getdoses(d.id, \"80\"),\n  coordx: getcentroids.get(d.id)[0],\n  coordy: getcentroids.get(d.id)[1]\n}))"},{"methodName":"interpret","cellName":"ojs-cell-27","inline":false,"source":"population = d3.csv(\n  \"https://raw.githubusercontent.com/neocarto/resources/master/datasets/INSEE/popage2021.csv\"\n)"},{"methodName":"interpret","cellName":"ojs-cell-28","inline":false,"source":"vaccins = {\n  let psv = d3.dsvFormat(\";\");\n  let url =\n    \"https://www.data.gouv.fr/fr/datasets/r/de4b356b-8cd9-4b9a-8878-459a62646107\";\n  try {\n    let v = d3.csv(url);\n    v[0].clage_vacsi;\n    return v;\n  } catch (e) {\n    let v = d3.text(url).then((txt) => psv.parse(txt));\n    return v;\n  }\n}"},{"methodName":"interpret","cellName":"ojs-cell-29","inline":false,"source":"getcentroids = new Map(\n  dpt.features\n    .map(d => {\n      return d;\n    })\n    .map(d => [d.properties.DEP, path.centroid(d)])\n)"},{"methodName":"interpret","cellName":"ojs-cell-30","inline":false,"source":"getcolor = d3\n  .scaleQuantile()\n  .domain(\n    data.map(\n      d => Math.round((10000 * d[\"doses_\" + myage]) / d[\"pop_\" + myage]) / 100\n    )\n  ) // pass the whole dataset to a scaleQuantile’s domain\n  .range(colors)"},{"methodName":"interpret","cellName":"ojs-cell-31","inline":false,"source":"format = function(value) {\n  let v = value;\n\n  if (value >= 1000) {\n    let str = String(value);\n    let v1 = str.substring(0, str.length - 3);\n    let v2 = str.substring(str.length - 3, str.length);\n    v = v1 + \" \" + v2;\n  }\n\n  if (value >= 100000) {\n    v = Math.round((100 * value) / 1000000) / 100 + \" million\";\n  }\n  if (value >= 2000000) {\n    v = Math.round((100 * value) / 1000000) / 100 + \" millions\";\n  }\n  return v;\n}"},{"methodName":"interpret","cellName":"ojs-cell-32","inline":false,"source":"legcircles = legendCircle()\n  .tickValues([\n    d3.min(data, d => d[\"doses_\" + myage]),\n    d3.median(data, d => d[\"doses_\" + myage]),\n    d3.max(data, d => d[\"doses_\" + myage])\n  ])\n  .scale(radius)"},{"methodName":"interpret","cellName":"ojs-cell-33","inline":false,"source":"ratiobyid = new Map(\n  data.map(d => [\n    d.id,\n    Math.round((10000 * d[\"doses_\" + myage]) / d[\"pop_\" + myage]) / 100\n  ])\n)"},{"methodName":"interpret","cellName":"ojs-cell-34","inline":false,"source":"color = d3.scaleThreshold([1, 2, 3, 4, 5, 6, 7, 8, 9, 10], colors)"},{"methodName":"interpret","cellName":"ojs-cell-35","inline":false,"source":"simulation = d3\n  .forceSimulation(data)\n  .force(\"x\", d3.forceX(d => d.coordx))\n  .force(\"y\", d3.forceY(d => d.coordy))\n  .force(\n    \"collide\",\n    d3.forceCollide(d => 0.5 + radius(+d[\"doses_\" + myage]) + 1)\n  )\n  .stop()"},{"methodName":"interpret","cellName":"ojs-cell-36","inline":false,"source":"getdoses = function (dep, age) {\n  let x = vaccins\n    .filter((d) => d.dep == dep)\n    .filter((d) => d.clage_vacsi == age);\n  let v = x.map((d) => +d.n_tot_dose1 + +d.n_tot_complet);\n  let value;\n  v.length == 0 ? (value = 0) : (value = v[0]);\n  return +value;\n}"},{"methodName":"interpret","cellName":"ojs-cell-37","inline":false,"source":"datetodate = function(dat) {\n  let m = [\n    \"mois\",\n    \"janvier\",\n    \"février\",\n    \"mars\",\n    \"avril\",\n    \"mai\",\n    \"juin\",\n    \"juillet\",\n    \"août\",\n    \"septembre\",\n    \"octobre\",\n    \"novembre\",\n    \"décembre\"\n  ];\n\n  let j1 = +dat.substr(8, 2);\n  let j = j1 == 1 ? j1 + \"er\" : j1;\n  let m1 = m[+dat.substr(5, 2)];\n  let a1 = dat.substr(0, 4);\n\n  return j + \" \" + m1 + \" \" + a1;\n}"},{"methodName":"interpret","cellName":"ojs-cell-38","inline":false,"source":"scaleBar = d3\n  .geoScaleBar()\n  .projection(projection)\n  .size([900, 860])\n  .left(.9)\n  .top(.99)\n  .units(d3.geoScaleKilometers)\n  .distance(100)\n  .label(\"100 km\")\n  .labelAnchor(\"middle\")\n  .tickSize(null)\n  .tickValues(null)"},{"methodName":"interpret","cellName":"ojs-cell-39","inline":false,"source":"radius = d3.scaleSqrt([0, d3.max(data, d => +d[\"doses_\" + myage])], [0, 30])"},{"methodName":"interpret","cellName":"ojs-cell-40","inline":false,"source":"import { Scrubber } from \"@mbostock/scrubber\""},{"methodName":"interpret","cellName":"ojs-cell-41","inline":false,"source":"import { select, radio, slider } from \"@jashkenas/inputs\""},{"methodName":"interpret","cellName":"ojs-cell-42","inline":false,"source":"import { legendCircle } from \"@harrystevens/circle-legend\""},{"methodName":"interpret","cellName":"ojs-cell-43","inline":false,"source":"import { legend } from \"@d3/color-legend\""},{"methodName":"interpret","cellName":"ojs-cell-44","inline":false,"source":"topojson = require('topojson')"},{"methodName":"interpret","cellName":"ojs-cell-45","inline":false,"source":"d3 = require(\"d3@6\", \"d3-geo-scale-bar@1.0.2\")"},{"methodName":"interpretQuiet","source":"shinyInput('myage')"},{"methodName":"interpretQuiet","source":"shinyInput('pctvax')"},{"methodName":"interpretQuiet","source":"shinyInput('overlay')"},{"methodName":"interpretQuiet","source":"shinyInput('label')"}]}
</script>
<script type="module">
window._ojs.paths.runtimeToDoc = "../../docs/interactive/js/examples";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "../../../..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>


</body></html>