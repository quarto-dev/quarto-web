<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head>
  <meta charset="utf-8">
  <meta name="generator" content="quarto-(Local Development)">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <meta name="author" content="neocarto">
  <meta name="dcterms.date" content="2020-10-20">
  <title>Quarto – Passports &amp; Colors</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>

  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
  <script src="../../../../site_libs/quarto-nav/headroom.min.js"></script>
  <meta name="quarto:offset" content="../../../../">
  <script src="../../../../site_libs/quarto-search/autocomplete.min.js"></script>
  <script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
  <script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
  <script src="../../../../site_libs/quarto-html/quarto.js"></script>
  <script src="../../../../site_libs/quarto-html/popper.min.js"></script>
  <script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
  <script src="../../../../site_libs/quarto-html/clipboard.min.js"></script>
  <script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
  <script src="../../../../site_libs/quarto-html/quarto-html.js"></script>
  <link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
  <link class="quarto-color-scheme" href="../../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
  <link class="quarto-color-scheme quarto-color-alternate" rel="prefetch" href="../../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css">
  <script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
  <link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
  <link class="quarto-color-scheme" href="../../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
  <link class="quarto-color-scheme quarto-color-alternate" rel="prefetch" href="../../../../site_libs/bootstrap/bootstrap-dark.min.css">
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-FV9Z7SDZ0M"></script>

  <script type="text/javascript">

  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-FV9Z7SDZ0M', { 'anonymize_ip': true});
  </script>
  <script type="module" src="../../../../site_libs/quarto-ojs/ojs-bundle.js"></script>
  <link href="../../../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
  <link rel="stylesheet" href="../../../../styles.css">
<meta name="og:title" content="Quarto - Passports &amp; Colors">
<meta name="og:description" content="Originally published at <https://observablehq.com/@neocartocnrs/passeports-colors>">
<meta name="og:image" content="https://quarto.org/quarto.png">
<meta name="og:site-name" content="Quarto">
<meta name="og:image:height" content="152">
<meta name="og:image:width" content="624">
<meta name="twitter:title" content="Quarto - Passports &amp; Colors">
<meta name="twitter:description" content="Originally published at <https://observablehq.com/@neocartocnrs/passeports-colors>">
<meta name="twitter:image" content="https://quarto.org/quarto.png">
<meta name="twitter:image-height" content="152">
<meta name="twitter:image-width" content="624">
<meta name="twitter:card" content="summary_large_image">
</head>
<body>
<div id="quarto-search-results"></div>
<header id="quarto-header" class="headroom fixed-top">
<nav class="navbar navbar-expand-lg navbar-light bg-light ">
    <div class="container-fluid">
  <a class="navbar-brand" href="../../../../index.html">
    <img src="../../../../quarto.png" alt="">
  </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
      <div class="collapse navbar-collapse" id="navbarCollapse">
        <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../index.html">Get Started</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../docs/authoring/markdown-basics.html">Using</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../docs/output-formats/html-basics.html">Formats</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../docs/projects/quarto-projects.html">Projects</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../about.html">About</a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/quarto-dev/quarto-cli"><i class="bi-github" role="img">
</i> 
 </a>
  </li>  
</ul>
          <div>
            <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;"><i class="bi"></i></a>
          </div>
          <form class="d-flex mb-0">
  <input id="quarto-search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>
      </div> <!-- /navcollapse -->
  </div> <!-- /container-fluid -->
</nav>
</header>
 <!-- /navbar/sidebar -->
<div class="container-fluid quarto-container d-flex flex-column page-layout-article" id="quarto-content">
<div class="row flex-fill">
  <div id="quarto-toc-sidebar" class="col col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-toc order-last"><nav id="TOC" role="doc-toc">
<h2 id="toc-title">On this page</h2>
<ul>
<li><a href="#color-matter" class="nav-link active" data-scroll-target="#color-matter">Color matter</a></li>
<li><a href="#data-import-handling" class="nav-link" data-scroll-target="#data-import-handling">Data Import &amp; handling</a></li>
<li><a href="#appendix" class="nav-link" data-scroll-target="#appendix">Appendix</a></li>
</ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/quarto-dev/quarto-web/edit/main/docs/interactive/js/examples2/passeports-colors.qmd">Edit this page</a></p><p><a href="https://github.com/quarto-dev/quarto-web/issues/new">Report an issue</a></p></div></div></nav></div>
  <div class="col mx-auto col-sm-12 col-md-9 col-lg-8 col-xl-7 px-lg-4 pe-xxl-4 ps-xxl-0">
<main>
<header id="title-block-header">
<div class="quarto-title-block"><div><h1 class="title">Passports &amp; Colors</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
<p class="subtitle lead">Originally published at <a href="https://observablehq.com/@neocartocnrs/passeports-colors" class="uri">https://observablehq.com/@neocartocnrs/passeports-colors</a></p>
<p class="author">neocarto</p>
<p class="date">2020-10-20</p>
</header>

<div class="cell panel-input card bg-light p-2 quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div>
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div>
<div id="ojs-cell-1-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div>
<div id="ojs-cell-1-3" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-2" data-nodetype="declaration">

</div>
</div>
</div>
<section id="color-matter" class="level1">
<h1>Color matter</h1>
<p>I deliver here a cartography by proportional passports (sic). And yeah, on this map, the surface of the passports represented is proportional to their power, that is to say to the number of countries they allow to reach without prior visa (in 2019 before the Covid epidemic19). And as absurd as it may seem, when it comes to international mobility, color matters. If you have a red passport, be aware that you will be able to travel easily to an average of 135 countries. If you have a blue passport, it will give you access to 103 countries. With a black passport, you will be able to reach 88 countries. And if by misfortune you have a green passport, only 78 countries will open their doors to you. In addition, you should know that the most « powerful » passport in the world is the United Arab Emirates passport, which gives you access to 179 countries around the world (compared to 170 for a French passport). On the other hand, the least powerful passport is the Afghan passport, which gives access to only 35 countries.</p>
<p>But still, you probably think it’s absurd to take the color of passports as a criterion, don’t you? And you’re not entirely wrong, even if these colors are not chosen at random. Red, for example, was chosen by the communist countries, you will easily understand why. But red is also the choice of all European countries except Croatia. The color green, for its part, was chosen by the majority of Muslim countries. As you know, green is the color of Islam. Blue is very present in America (North and South). And finally black passports are extremely rare. Only 7 countries use them.</p>
<p>Eurasia, America, Muslim countries: in the end, these colors refer more or less to a regionalization of the World. More than the color of your passport, it is actually the place of your country in the world order that determines your ability to cross borders. In other words, regardless of whether you are a citizen of a powerful country rich in peace or a poor country in war, you will not have access to the same spatial opportunities. The first criterion to be entitled to international mobility is therefore above all to be born in a good place. No more and no less.</p>
<p>Note: the data used here come from the website <a href="passportindex.org">passportindex.org</a>. But other rankings exist with significantly different data. See for example <a href="henleypassportindex.com">henleypassportindex.com</a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="sourceCode js cell-code code-with-copy"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>()</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">set</span>(<span class="st">"red"</span><span class="op">,</span> <span class="st">"#c76f65"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">set</span>(<span class="st">"green"</span><span class="op">,</span> <span class="st">"#80bd6c"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">set</span>(<span class="st">"blue"</span><span class="op">,</span> <span class="st">"#698ec9"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">set</span>(<span class="st">"black"</span><span class="op">,</span> <span class="st">"#5c5959"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="ojs-cell-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="sourceCode js cell-code code-with-copy"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>bycolor <span class="op">=</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">rollup</span>(data<span class="op">,</span> v <span class="kw">=&gt;</span> d3<span class="op">.</span><span class="fu">mean</span>(v<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">mobilityscore</span>)<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">color</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="ojs-cell-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="sourceCode js cell-code code-with-copy"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>nd2 <span class="op">=</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(d3<span class="op">.</span><span class="fu">group</span>(data<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">color</span>))<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d[<span class="dv">1</span>][<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="ojs-cell-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="sourceCode js cell-code code-with-copy"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>bycolor2 <span class="op">=</span> d3<span class="op">.</span><span class="fu">rollups</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  data<span class="op">,</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  v <span class="kw">=&gt;</span> ({</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">nb</span><span class="op">:</span> v<span class="op">.</span><span class="at">length</span><span class="op">,</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">score</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">mean</span>(v<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">mobilityscore</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  })<span class="op">,</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">color</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="ojs-cell-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="sourceCode js cell-code code-with-copy"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>hlp <span class="op">=</span> {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (type <span class="op">==</span> <span class="st">"p"</span>) {</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> t <span class="op">=</span> <span class="st">"passport"</span><span class="op">;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> t <span class="op">=</span> <span class="st">"circle"</span><span class="op">;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> txt <span class="op">=</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"On this map, the</span><span class="sc">\n</span><span class="st">surface area of each</span><span class="sc">\n</span><span class="st"> "</span> <span class="op">+</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    t <span class="op">+</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">" is proportional</span><span class="sc">\n</span><span class="st">to the number of</span><span class="sc">\n</span><span class="st">countries it allows </span><span class="sc">\n</span><span class="st">to go to in 2019</span><span class="sc">\n</span><span class="st">(before</span><span class="sc">\n</span><span class="st">Covid19)."</span><span class="op">;</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> txt<span class="op">.</span><span class="fu">split</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)<span class="op">;</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="ojs-cell-8" data-nodetype="declaration">

</div>
</div>
</div>
</section>
<section id="data-import-handling" class="level1">
<h1>Data Import &amp; handling</h1>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="sourceCode js cell-code code-with-copy"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>radius <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleSqrt</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">0</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">max</span>(data<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">mobilityscore</span>)]<span class="op">,</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">0</span><span class="op">,</span> <span class="fl">5.6</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(k)]</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="ojs-cell-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="sourceCode js cell-code code-with-copy"><code class="sourceCode javascript"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> passeports</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> {</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> id <span class="op">=</span> d<span class="op">.</span><span class="at">id</span><span class="op">;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> name <span class="op">=</span> d<span class="op">.</span><span class="at">name</span><span class="op">;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> thumb <span class="op">=</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">"https://raw.githubusercontent.com/neocarto/resources/master/datasets/passports/outputs/thumb/"</span> <span class="op">+</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>      d<span class="op">.</span><span class="at">id</span><span class="op">.</span><span class="fu">toLowerCase</span>() <span class="op">+</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">".png"</span><span class="op">;</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> color <span class="op">=</span> d<span class="op">.</span><span class="at">color</span><span class="op">;</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> mobilityscore <span class="op">=</span> mobilyscore<span class="op">.</span><span class="fu">get</span>(d<span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> feature <span class="op">=</span> features<span class="op">.</span><span class="fu">get</span>(d<span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>      id<span class="op">,</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>      <span class="dt">position</span><span class="op">:</span> feature <span class="op">&amp;&amp;</span> feature<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">position</span><span class="op">,</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>      <span class="dt">name</span><span class="op">:</span> name<span class="op">,</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>      <span class="dt">thumb</span><span class="op">:</span> thumb<span class="op">,</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>      <span class="dt">color</span><span class="op">:</span> color<span class="op">,</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>      <span class="dt">mobilityscore</span><span class="op">:</span> <span class="op">+</span>mobilityscore<span class="op">,</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>      <span class="dt">imgw</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(<span class="op">+</span>mobilityscore <span class="op">*</span> k <span class="op">*</span> <span class="fl">0.7</span>)<span class="op">,</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>      <span class="dt">imgh</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>((<span class="op">+</span>mobilityscore <span class="op">*</span> k) <span class="op">/</span> <span class="fl">0.7</span>)</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    (d) <span class="kw">=&gt;</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>      d<span class="op">.</span><span class="at">color</span> <span class="op">==</span> ch[<span class="dv">0</span>] <span class="op">||</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>      d<span class="op">.</span><span class="at">color</span> <span class="op">==</span> ch[<span class="dv">1</span>] <span class="op">||</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>      d<span class="op">.</span><span class="at">color</span> <span class="op">==</span> ch[<span class="dv">2</span>] <span class="op">||</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>      d<span class="op">.</span><span class="at">color</span> <span class="op">==</span> ch[<span class="dv">3</span>]</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="ojs-cell-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-14" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-15" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-16" data-nodetype="declaration">

</div>
</div>
</div>
</section>
<section id="appendix" class="level1">
<h1>Appendix</h1>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-17" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="sourceCode js cell-code code-with-copy"><code class="sourceCode javascript"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { checkbox<span class="op">,</span> slider<span class="op">,</span> radio } <span class="im">from</span> <span class="st">"@jashkenas/inputs"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="ojs-cell-18" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="sourceCode js cell-code code-with-copy"><code class="sourceCode javascript"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoPath</span>(projection)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="ojs-cell-19" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-20" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-21" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-22" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-23" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-24" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="ojs-cell-25" data-nodetype="declaration">

</div>
</div>
</div>

<!-- -->
<div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title anchored" id="quarto-embedded-source-code-modal-label" data-anchor-id="appendix">Source Code</h5><button class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb10" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Passports &amp; Colors"</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Originally published at &lt;https://observablehq.com/@neocartocnrs/passeports-colors&gt;"</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "neocarto"</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2020-10-20</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="an">license:</span><span class="co"> mit</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: false</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="in">//| panel: input</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="in">//| layout-ncol: 3</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="in">viewof ch = checkbox({</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="in">  title: "Passport color:",</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="in">  options: [</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="in">    { value: "red", label: "Red" },</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="in">    { value: "green", label: "Green" },</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="in">    { value: "blue", label: "Blue" },</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="in">    { value: "black", label: "Black" }</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="in">  ],</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="in">  value: ["red", "green", "blue", "black"],</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="in">  submit: false</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="in">})</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="in">viewof type = radio({</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="in">  title: "Representation:",</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a><span class="in">  options: [</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a><span class="in">    { label: 'Passports', value: 'p' },</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a><span class="in">    { label: 'Circles', value: 'c' }</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a><span class="in">  ],</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a><span class="in">  value: 'p'</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a><span class="in">})</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a><span class="in">viewof k = slider({</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a><span class="in">  title: "Symbol size:",</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a><span class="in">  min: 1,</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a><span class="in">  max: 10,</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a><span class="in">  value: 3,</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a><span class="in">  step: 1</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a><span class="in">})</span></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a><span class="in">map = {</span></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a><span class="in">  for (let i = 0; i &lt; 200; i++) {</span></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a><span class="in">    simulation.tick();</span></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a><span class="in">  const svg = d3</span></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a><span class="in">    .create("svg")</span></span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("viewBox", [0, 0, width, height])</span></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("width", "100%")</span></span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("height", "auto");</span></span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a><span class="in">  // Defs</span></span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a><span class="in">  var defs = svg.append("defs");</span></span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a><span class="in">  const pattern = defs</span></span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("pattern")</span></span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("id", "hatch")</span></span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("patternUnits", "userSpaceOnUse")</span></span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("width", 6)</span></span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("height", 6);</span></span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a><span class="in">  pattern</span></span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("line")</span></span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x1", 0)</span></span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y1", 0)</span></span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x2", 6)</span></span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y1", 6)</span></span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke", "white")</span></span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke-width", 1)</span></span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke-opacity", 0.7);</span></span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a><span class="in">  // Sphere</span></span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("rect")</span></span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("opacity", 1)</span></span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", 0)</span></span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", 0)</span></span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("width", width)</span></span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("height", height)</span></span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a><span class="in">    .style('fill', "#9ACBE3")</span></span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("opacity", 0.8);</span></span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb10-101"><a href="#cb10-101" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("rect")</span></span>
<span id="cb10-102"><a href="#cb10-102" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill-opacity", 0.4)</span></span>
<span id="cb10-103"><a href="#cb10-103" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", 0)</span></span>
<span id="cb10-104"><a href="#cb10-104" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", height - 60)</span></span>
<span id="cb10-105"><a href="#cb10-105" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("width", width)</span></span>
<span id="cb10-106"><a href="#cb10-106" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("height", 60)</span></span>
<span id="cb10-107"><a href="#cb10-107" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('fill', "white");</span></span>
<span id="cb10-108"><a href="#cb10-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-109"><a href="#cb10-109" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb10-110"><a href="#cb10-110" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("rect")</span></span>
<span id="cb10-111"><a href="#cb10-111" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill-opacity", 0.4)</span></span>
<span id="cb10-112"><a href="#cb10-112" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", 0)</span></span>
<span id="cb10-113"><a href="#cb10-113" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", 0)</span></span>
<span id="cb10-114"><a href="#cb10-114" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("width", width)</span></span>
<span id="cb10-115"><a href="#cb10-115" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("height", height)</span></span>
<span id="cb10-116"><a href="#cb10-116" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('fill', "url('#hatch')");</span></span>
<span id="cb10-117"><a href="#cb10-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-118"><a href="#cb10-118" aria-hidden="true" tabindex="-1"></a><span class="in">  // Countries</span></span>
<span id="cb10-119"><a href="#cb10-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-120"><a href="#cb10-120" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb10-121"><a href="#cb10-121" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("path")</span></span>
<span id="cb10-122"><a href="#cb10-122" aria-hidden="true" tabindex="-1"></a><span class="in">    .datum(topojson.feature(json, json.objects.countries))</span></span>
<span id="cb10-123"><a href="#cb10-123" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "white")</span></span>
<span id="cb10-124"><a href="#cb10-124" aria-hidden="true" tabindex="-1"></a><span class="in">    .style('fill-opacity', 0.7)</span></span>
<span id="cb10-125"><a href="#cb10-125" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("d", path);</span></span>
<span id="cb10-126"><a href="#cb10-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-127"><a href="#cb10-127" aria-hidden="true" tabindex="-1"></a><span class="in">  // Passeports images</span></span>
<span id="cb10-128"><a href="#cb10-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-129"><a href="#cb10-129" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb10-130"><a href="#cb10-130" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("g")</span></span>
<span id="cb10-131"><a href="#cb10-131" aria-hidden="true" tabindex="-1"></a><span class="in">    .selectAll("image")</span></span>
<span id="cb10-132"><a href="#cb10-132" aria-hidden="true" tabindex="-1"></a><span class="in">    .data(data.sort((a, b) =&gt; d3.descending(a.mobilityscore, b.mobilityscore)))</span></span>
<span id="cb10-133"><a href="#cb10-133" aria-hidden="true" tabindex="-1"></a><span class="in">    .join("image")</span></span>
<span id="cb10-134"><a href="#cb10-134" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("class", "pasp")</span></span>
<span id="cb10-135"><a href="#cb10-135" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("xlink:href", d =&gt; d.thumb)</span></span>
<span id="cb10-136"><a href="#cb10-136" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('width', d =&gt; d.imgw)</span></span>
<span id="cb10-137"><a href="#cb10-137" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('height', d =&gt; d.imgh)</span></span>
<span id="cb10-138"><a href="#cb10-138" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", d =&gt; d.x - d.imgw / 2)</span></span>
<span id="cb10-139"><a href="#cb10-139" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", d =&gt; d.y - d.imgh / 2)</span></span>
<span id="cb10-140"><a href="#cb10-140" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("style", "border: 5px solid #555")</span></span>
<span id="cb10-141"><a href="#cb10-141" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("visibility", visib[0]);</span></span>
<span id="cb10-142"><a href="#cb10-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-143"><a href="#cb10-143" aria-hidden="true" tabindex="-1"></a><span class="in">  // Test</span></span>
<span id="cb10-144"><a href="#cb10-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-145"><a href="#cb10-145" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb10-146"><a href="#cb10-146" aria-hidden="true" tabindex="-1"></a><span class="in">    .selectAll('image')</span></span>
<span id="cb10-147"><a href="#cb10-147" aria-hidden="true" tabindex="-1"></a><span class="in">    .data(data)</span></span>
<span id="cb10-148"><a href="#cb10-148" aria-hidden="true" tabindex="-1"></a><span class="in">    .enter()</span></span>
<span id="cb10-149"><a href="#cb10-149" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('image')</span></span>
<span id="cb10-150"><a href="#cb10-150" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("xlink:href", d =&gt; d.thumb)</span></span>
<span id="cb10-151"><a href="#cb10-151" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('width', d =&gt; d.imgw)</span></span>
<span id="cb10-152"><a href="#cb10-152" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('height', d =&gt; d.imgh)</span></span>
<span id="cb10-153"><a href="#cb10-153" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", d =&gt; d.x - d.imgw / 2)</span></span>
<span id="cb10-154"><a href="#cb10-154" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", d =&gt; d.y - d.imgh / 2);</span></span>
<span id="cb10-155"><a href="#cb10-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-156"><a href="#cb10-156" aria-hidden="true" tabindex="-1"></a><span class="in">  // Passeports circles</span></span>
<span id="cb10-157"><a href="#cb10-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-158"><a href="#cb10-158" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb10-159"><a href="#cb10-159" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("g")</span></span>
<span id="cb10-160"><a href="#cb10-160" aria-hidden="true" tabindex="-1"></a><span class="in">    .selectAll("circle")</span></span>
<span id="cb10-161"><a href="#cb10-161" aria-hidden="true" tabindex="-1"></a><span class="in">    .data(data.sort((a, b) =&gt; d3.descending(a.mobilityscore, b.mobilityscore)))</span></span>
<span id="cb10-162"><a href="#cb10-162" aria-hidden="true" tabindex="-1"></a><span class="in">    .join("circle")</span></span>
<span id="cb10-163"><a href="#cb10-163" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("class", "pasp")</span></span>
<span id="cb10-164"><a href="#cb10-164" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("r", d =&gt; radius(d.mobilityscore))</span></span>
<span id="cb10-165"><a href="#cb10-165" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("cx", d =&gt; d.x)</span></span>
<span id="cb10-166"><a href="#cb10-166" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("cy", d =&gt; d.y)</span></span>
<span id="cb10-167"><a href="#cb10-167" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", d =&gt; colors.get(d.color))</span></span>
<span id="cb10-168"><a href="#cb10-168" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke", "#404752")</span></span>
<span id="cb10-169"><a href="#cb10-169" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke-width", 0)</span></span>
<span id="cb10-170"><a href="#cb10-170" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("visibility", visib[1]);</span></span>
<span id="cb10-171"><a href="#cb10-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-172"><a href="#cb10-172" aria-hidden="true" tabindex="-1"></a><span class="in">  // Title</span></span>
<span id="cb10-173"><a href="#cb10-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-174"><a href="#cb10-174" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb10-175"><a href="#cb10-175" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("text")</span></span>
<span id="cb10-176"><a href="#cb10-176" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", width / 2)</span></span>
<span id="cb10-177"><a href="#cb10-177" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", height - 17)</span></span>
<span id="cb10-178"><a href="#cb10-178" aria-hidden="true" tabindex="-1"></a><span class="in">    .text("GLOBAL PASSPORT POWER RANK")</span></span>
<span id="cb10-179"><a href="#cb10-179" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("text-anchor", "middle")</span></span>
<span id="cb10-180"><a href="#cb10-180" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-family", "sans-serif")</span></span>
<span id="cb10-181"><a href="#cb10-181" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "#5c658a")</span></span>
<span id="cb10-182"><a href="#cb10-182" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill-opacity", 0.3)</span></span>
<span id="cb10-183"><a href="#cb10-183" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("font-size", "45px");</span></span>
<span id="cb10-184"><a href="#cb10-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-185"><a href="#cb10-185" aria-hidden="true" tabindex="-1"></a><span class="in">  // Chart</span></span>
<span id="cb10-186"><a href="#cb10-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-187"><a href="#cb10-187" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb10-188"><a href="#cb10-188" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("text")</span></span>
<span id="cb10-189"><a href="#cb10-189" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", 10)</span></span>
<span id="cb10-190"><a href="#cb10-190" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", 410)</span></span>
<span id="cb10-191"><a href="#cb10-191" aria-hidden="true" tabindex="-1"></a><span class="in">    .text("The Power of Colors")</span></span>
<span id="cb10-192"><a href="#cb10-192" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-family", "sans-serif")</span></span>
<span id="cb10-193"><a href="#cb10-193" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-weight", "bold")</span></span>
<span id="cb10-194"><a href="#cb10-194" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "#4a524d")</span></span>
<span id="cb10-195"><a href="#cb10-195" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("font-size", "21px");</span></span>
<span id="cb10-196"><a href="#cb10-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-197"><a href="#cb10-197" aria-hidden="true" tabindex="-1"></a><span class="in">  const x1 = 10;</span></span>
<span id="cb10-198"><a href="#cb10-198" aria-hidden="true" tabindex="-1"></a><span class="in">  const y1 = 430;</span></span>
<span id="cb10-199"><a href="#cb10-199" aria-hidden="true" tabindex="-1"></a><span class="in">  const barheight = 2;</span></span>
<span id="cb10-200"><a href="#cb10-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-201"><a href="#cb10-201" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb10-202"><a href="#cb10-202" aria-hidden="true" tabindex="-1"></a><span class="in">    .selectAll(".chart")</span></span>
<span id="cb10-203"><a href="#cb10-203" aria-hidden="true" tabindex="-1"></a><span class="in">    .data(bycolor)</span></span>
<span id="cb10-204"><a href="#cb10-204" aria-hidden="true" tabindex="-1"></a><span class="in">    .join("rect")</span></span>
<span id="cb10-205"><a href="#cb10-205" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('height', barheight)</span></span>
<span id="cb10-206"><a href="#cb10-206" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('width', d =&gt; d[1] * 5)</span></span>
<span id="cb10-207"><a href="#cb10-207" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('y', function(d, i) {</span></span>
<span id="cb10-208"><a href="#cb10-208" aria-hidden="true" tabindex="-1"></a><span class="in">      return y1 + i * 7 * barheight;</span></span>
<span id="cb10-209"><a href="#cb10-209" aria-hidden="true" tabindex="-1"></a><span class="in">    })</span></span>
<span id="cb10-210"><a href="#cb10-210" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('x', x1)</span></span>
<span id="cb10-211"><a href="#cb10-211" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('class', "chart")</span></span>
<span id="cb10-212"><a href="#cb10-212" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", d =&gt; colors.get(d[0]))</span></span>
<span id="cb10-213"><a href="#cb10-213" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("opacity", 1);</span></span>
<span id="cb10-214"><a href="#cb10-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-215"><a href="#cb10-215" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb10-216"><a href="#cb10-216" aria-hidden="true" tabindex="-1"></a><span class="in">    .selectAll(".charttxt")</span></span>
<span id="cb10-217"><a href="#cb10-217" aria-hidden="true" tabindex="-1"></a><span class="in">    .data(bycolor)</span></span>
<span id="cb10-218"><a href="#cb10-218" aria-hidden="true" tabindex="-1"></a><span class="in">    .join("text")</span></span>
<span id="cb10-219"><a href="#cb10-219" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('x', 10)</span></span>
<span id="cb10-220"><a href="#cb10-220" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('y', function(d, i) {</span></span>
<span id="cb10-221"><a href="#cb10-221" aria-hidden="true" tabindex="-1"></a><span class="in">      return y1 + i * 7 * barheight - 3;</span></span>
<span id="cb10-222"><a href="#cb10-222" aria-hidden="true" tabindex="-1"></a><span class="in">    })</span></span>
<span id="cb10-223"><a href="#cb10-223" aria-hidden="true" tabindex="-1"></a><span class="in">    .text(</span></span>
<span id="cb10-224"><a href="#cb10-224" aria-hidden="true" tabindex="-1"></a><span class="in">      d =&gt;</span></span>
<span id="cb10-225"><a href="#cb10-225" aria-hidden="true" tabindex="-1"></a><span class="in">        "People with " +</span></span>
<span id="cb10-226"><a href="#cb10-226" aria-hidden="true" tabindex="-1"></a><span class="in">        d[0] +</span></span>
<span id="cb10-227"><a href="#cb10-227" aria-hidden="true" tabindex="-1"></a><span class="in">        " passports can travel to an average of " +</span></span>
<span id="cb10-228"><a href="#cb10-228" aria-hidden="true" tabindex="-1"></a><span class="in">        Math.round(d[1]) +</span></span>
<span id="cb10-229"><a href="#cb10-229" aria-hidden="true" tabindex="-1"></a><span class="in">        " countries"</span></span>
<span id="cb10-230"><a href="#cb10-230" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb10-231"><a href="#cb10-231" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-family", "sans-serif")</span></span>
<span id="cb10-232"><a href="#cb10-232" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "#545252")</span></span>
<span id="cb10-233"><a href="#cb10-233" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("font-size", "9px");</span></span>
<span id="cb10-234"><a href="#cb10-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-235"><a href="#cb10-235" aria-hidden="true" tabindex="-1"></a><span class="in">  // Tooltip</span></span>
<span id="cb10-236"><a href="#cb10-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-237"><a href="#cb10-237" aria-hidden="true" tabindex="-1"></a><span class="in">  const tooltip = svg.append("g");</span></span>
<span id="cb10-238"><a href="#cb10-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-239"><a href="#cb10-239" aria-hidden="true" tabindex="-1"></a><span class="in">  tooltip.style("visibility", "hidden");</span></span>
<span id="cb10-240"><a href="#cb10-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-241"><a href="#cb10-241" aria-hidden="true" tabindex="-1"></a><span class="in">  tooltip</span></span>
<span id="cb10-242"><a href="#cb10-242" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("image")</span></span>
<span id="cb10-243"><a href="#cb10-243" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("class", "tooltipimg")</span></span>
<span id="cb10-244"><a href="#cb10-244" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('width', 70)</span></span>
<span id="cb10-245"><a href="#cb10-245" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('height', 100)</span></span>
<span id="cb10-246"><a href="#cb10-246" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", 10)</span></span>
<span id="cb10-247"><a href="#cb10-247" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", 32);</span></span>
<span id="cb10-248"><a href="#cb10-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-249"><a href="#cb10-249" aria-hidden="true" tabindex="-1"></a><span class="in">  tooltip</span></span>
<span id="cb10-250"><a href="#cb10-250" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("text")</span></span>
<span id="cb10-251"><a href="#cb10-251" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("class", "tooltipname")</span></span>
<span id="cb10-252"><a href="#cb10-252" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", 10)</span></span>
<span id="cb10-253"><a href="#cb10-253" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", 22)</span></span>
<span id="cb10-254"><a href="#cb10-254" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-family", "sans-serif")</span></span>
<span id="cb10-255"><a href="#cb10-255" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-weight", "bold")</span></span>
<span id="cb10-256"><a href="#cb10-256" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "#4a524d")</span></span>
<span id="cb10-257"><a href="#cb10-257" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("font-size", "21px");</span></span>
<span id="cb10-258"><a href="#cb10-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-259"><a href="#cb10-259" aria-hidden="true" tabindex="-1"></a><span class="in">  const y = 145;</span></span>
<span id="cb10-260"><a href="#cb10-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-261"><a href="#cb10-261" aria-hidden="true" tabindex="-1"></a><span class="in">  tooltip</span></span>
<span id="cb10-262"><a href="#cb10-262" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("text")</span></span>
<span id="cb10-263"><a href="#cb10-263" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", 10)</span></span>
<span id="cb10-264"><a href="#cb10-264" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", y)</span></span>
<span id="cb10-265"><a href="#cb10-265" aria-hidden="true" tabindex="-1"></a><span class="in">    .text("With this passport")</span></span>
<span id="cb10-266"><a href="#cb10-266" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-family", "sans-serif")</span></span>
<span id="cb10-267"><a href="#cb10-267" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "#4a524d")</span></span>
<span id="cb10-268"><a href="#cb10-268" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("font-size", "12px");</span></span>
<span id="cb10-269"><a href="#cb10-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-270"><a href="#cb10-270" aria-hidden="true" tabindex="-1"></a><span class="in">  tooltip</span></span>
<span id="cb10-271"><a href="#cb10-271" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("text")</span></span>
<span id="cb10-272"><a href="#cb10-272" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", 10)</span></span>
<span id="cb10-273"><a href="#cb10-273" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", y + 12)</span></span>
<span id="cb10-274"><a href="#cb10-274" aria-hidden="true" tabindex="-1"></a><span class="in">    .text("you can reach")</span></span>
<span id="cb10-275"><a href="#cb10-275" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-family", "sans-serif")</span></span>
<span id="cb10-276"><a href="#cb10-276" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "#4a524d")</span></span>
<span id="cb10-277"><a href="#cb10-277" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("font-size", "12px");</span></span>
<span id="cb10-278"><a href="#cb10-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-279"><a href="#cb10-279" aria-hidden="true" tabindex="-1"></a><span class="in">  tooltip</span></span>
<span id="cb10-280"><a href="#cb10-280" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("text")</span></span>
<span id="cb10-281"><a href="#cb10-281" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("class", "tooltiptxt")</span></span>
<span id="cb10-282"><a href="#cb10-282" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", 10)</span></span>
<span id="cb10-283"><a href="#cb10-283" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", y + 24)</span></span>
<span id="cb10-284"><a href="#cb10-284" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-family", "sans-serif")</span></span>
<span id="cb10-285"><a href="#cb10-285" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-weight", "bold")</span></span>
<span id="cb10-286"><a href="#cb10-286" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "#4a524d")</span></span>
<span id="cb10-287"><a href="#cb10-287" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("font-size", "12px");</span></span>
<span id="cb10-288"><a href="#cb10-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-289"><a href="#cb10-289" aria-hidden="true" tabindex="-1"></a><span class="in">  tooltip</span></span>
<span id="cb10-290"><a href="#cb10-290" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("text")</span></span>
<span id="cb10-291"><a href="#cb10-291" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("class", "tooltiptxt")</span></span>
<span id="cb10-292"><a href="#cb10-292" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", 10)</span></span>
<span id="cb10-293"><a href="#cb10-293" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", y + 36)</span></span>
<span id="cb10-294"><a href="#cb10-294" aria-hidden="true" tabindex="-1"></a><span class="in">    .text("without prior visa")</span></span>
<span id="cb10-295"><a href="#cb10-295" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-family", "sans-serif")</span></span>
<span id="cb10-296"><a href="#cb10-296" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "#4a524d")</span></span>
<span id="cb10-297"><a href="#cb10-297" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("font-size", "12px");</span></span>
<span id="cb10-298"><a href="#cb10-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-299"><a href="#cb10-299" aria-hidden="true" tabindex="-1"></a><span class="in">  tooltip</span></span>
<span id="cb10-300"><a href="#cb10-300" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("text")</span></span>
<span id="cb10-301"><a href="#cb10-301" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("class", "tooltiptxt")</span></span>
<span id="cb10-302"><a href="#cb10-302" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", 10)</span></span>
<span id="cb10-303"><a href="#cb10-303" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", y + 48)</span></span>
<span id="cb10-304"><a href="#cb10-304" aria-hidden="true" tabindex="-1"></a><span class="in">    .text("(in 2019 before Covid19)")</span></span>
<span id="cb10-305"><a href="#cb10-305" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-family", "sans-serif")</span></span>
<span id="cb10-306"><a href="#cb10-306" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "#4a524d")</span></span>
<span id="cb10-307"><a href="#cb10-307" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("font-size", "12px");</span></span>
<span id="cb10-308"><a href="#cb10-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-309"><a href="#cb10-309" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb10-310"><a href="#cb10-310" aria-hidden="true" tabindex="-1"></a><span class="in">    .selectAll(".pasp")</span></span>
<span id="cb10-311"><a href="#cb10-311" aria-hidden="true" tabindex="-1"></a><span class="in">    .on("touchmove mousemove", function(event, d) {</span></span>
<span id="cb10-312"><a href="#cb10-312" aria-hidden="true" tabindex="-1"></a><span class="in">      d3.select(this)</span></span>
<span id="cb10-313"><a href="#cb10-313" aria-hidden="true" tabindex="-1"></a><span class="in">        .attr("stroke-width", 2)</span></span>
<span id="cb10-314"><a href="#cb10-314" aria-hidden="true" tabindex="-1"></a><span class="in">        .raise();</span></span>
<span id="cb10-315"><a href="#cb10-315" aria-hidden="true" tabindex="-1"></a><span class="in">      tooltip.style("visibility", "visible");</span></span>
<span id="cb10-316"><a href="#cb10-316" aria-hidden="true" tabindex="-1"></a><span class="in">      svg.select(".tooltipimg").attr("xlink:href", d.thumb);</span></span>
<span id="cb10-317"><a href="#cb10-317" aria-hidden="true" tabindex="-1"></a><span class="in">      svg.select(".tooltipname").text(d.name);</span></span>
<span id="cb10-318"><a href="#cb10-318" aria-hidden="true" tabindex="-1"></a><span class="in">      svg.select(".tooltiptxt").text(d.mobilityscore + " countries");</span></span>
<span id="cb10-319"><a href="#cb10-319" aria-hidden="true" tabindex="-1"></a><span class="in">    })</span></span>
<span id="cb10-320"><a href="#cb10-320" aria-hidden="true" tabindex="-1"></a><span class="in">    .on("touchend mouseleave", function() {</span></span>
<span id="cb10-321"><a href="#cb10-321" aria-hidden="true" tabindex="-1"></a><span class="in">      tooltip.style("visibility", "hidden");</span></span>
<span id="cb10-322"><a href="#cb10-322" aria-hidden="true" tabindex="-1"></a><span class="in">      d3.select(this)</span></span>
<span id="cb10-323"><a href="#cb10-323" aria-hidden="true" tabindex="-1"></a><span class="in">        .attr("stroke-width", 0)</span></span>
<span id="cb10-324"><a href="#cb10-324" aria-hidden="true" tabindex="-1"></a><span class="in">        .lower();</span></span>
<span id="cb10-325"><a href="#cb10-325" aria-hidden="true" tabindex="-1"></a><span class="in">    });</span></span>
<span id="cb10-326"><a href="#cb10-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-327"><a href="#cb10-327" aria-hidden="true" tabindex="-1"></a><span class="in">  // Sources</span></span>
<span id="cb10-328"><a href="#cb10-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-329"><a href="#cb10-329" aria-hidden="true" tabindex="-1"></a><span class="in">  var source = svg</span></span>
<span id="cb10-330"><a href="#cb10-330" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("text")</span></span>
<span id="cb10-331"><a href="#cb10-331" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", width / 2)</span></span>
<span id="cb10-332"><a href="#cb10-332" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", height - 5)</span></span>
<span id="cb10-333"><a href="#cb10-333" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("text-anchor", "middle")</span></span>
<span id="cb10-334"><a href="#cb10-334" aria-hidden="true" tabindex="-1"></a><span class="in">    .text(</span></span>
<span id="cb10-335"><a href="#cb10-335" aria-hidden="true" tabindex="-1"></a><span class="in">      "Map designed by Nicolas Lambert, 2020 - Data Source: https://www.passportindex.org (2019 data before covid19) - Behind this map: see https://observablehq.com/@neocartocnrs/passeports-colors"</span></span>
<span id="cb10-336"><a href="#cb10-336" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb10-337"><a href="#cb10-337" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-family", "sans-serif")</span></span>
<span id="cb10-338"><a href="#cb10-338" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("font-size", "10px")</span></span>
<span id="cb10-339"><a href="#cb10-339" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("font-style", "italic")</span></span>
<span id="cb10-340"><a href="#cb10-340" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "#5c658a")</span></span>
<span id="cb10-341"><a href="#cb10-341" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill-opacity", 0.6);</span></span>
<span id="cb10-342"><a href="#cb10-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-343"><a href="#cb10-343" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb10-344"><a href="#cb10-344" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("circle")</span></span>
<span id="cb10-345"><a href="#cb10-345" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "white")</span></span>
<span id="cb10-346"><a href="#cb10-346" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("cx", width)</span></span>
<span id="cb10-347"><a href="#cb10-347" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("cy", 0)</span></span>
<span id="cb10-348"><a href="#cb10-348" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("r", 150)</span></span>
<span id="cb10-349"><a href="#cb10-349" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("opacity", 0.4);</span></span>
<span id="cb10-350"><a href="#cb10-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-351"><a href="#cb10-351" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb10-352"><a href="#cb10-352" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("circle")</span></span>
<span id="cb10-353"><a href="#cb10-353" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "white")</span></span>
<span id="cb10-354"><a href="#cb10-354" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("cx", width)</span></span>
<span id="cb10-355"><a href="#cb10-355" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("cy", 0)</span></span>
<span id="cb10-356"><a href="#cb10-356" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("r", 160)</span></span>
<span id="cb10-357"><a href="#cb10-357" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("opacity", 0.4);</span></span>
<span id="cb10-358"><a href="#cb10-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-359"><a href="#cb10-359" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb10-360"><a href="#cb10-360" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("circle")</span></span>
<span id="cb10-361"><a href="#cb10-361" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "white")</span></span>
<span id="cb10-362"><a href="#cb10-362" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("cx", width)</span></span>
<span id="cb10-363"><a href="#cb10-363" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("cy", 0)</span></span>
<span id="cb10-364"><a href="#cb10-364" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("r", 170)</span></span>
<span id="cb10-365"><a href="#cb10-365" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("opacity", 0.4);</span></span>
<span id="cb10-366"><a href="#cb10-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-367"><a href="#cb10-367" aria-hidden="true" tabindex="-1"></a><span class="in">  var help = svg</span></span>
<span id="cb10-368"><a href="#cb10-368" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("text")</span></span>
<span id="cb10-369"><a href="#cb10-369" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", 5)</span></span>
<span id="cb10-370"><a href="#cb10-370" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-family", "sans-serif")</span></span>
<span id="cb10-371"><a href="#cb10-371" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-weight", "bold")</span></span>
<span id="cb10-372"><a href="#cb10-372" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "#3e4657")</span></span>
<span id="cb10-373"><a href="#cb10-373" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("font-size", "11px")</span></span>
<span id="cb10-374"><a href="#cb10-374" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill-opacity", 0.4)</span></span>
<span id="cb10-375"><a href="#cb10-375" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("text-anchor", "end")</span></span>
<span id="cb10-376"><a href="#cb10-376" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-family", "sans-serif");</span></span>
<span id="cb10-377"><a href="#cb10-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-378"><a href="#cb10-378" aria-hidden="true" tabindex="-1"></a><span class="in">  hlp.forEach(d =&gt; {</span></span>
<span id="cb10-379"><a href="#cb10-379" aria-hidden="true" tabindex="-1"></a><span class="in">    help</span></span>
<span id="cb10-380"><a href="#cb10-380" aria-hidden="true" tabindex="-1"></a><span class="in">      .append("tspan")</span></span>
<span id="cb10-381"><a href="#cb10-381" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("x", width - 10)</span></span>
<span id="cb10-382"><a href="#cb10-382" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("dy", 15)</span></span>
<span id="cb10-383"><a href="#cb10-383" aria-hidden="true" tabindex="-1"></a><span class="in">      .text(d);</span></span>
<span id="cb10-384"><a href="#cb10-384" aria-hidden="true" tabindex="-1"></a><span class="in">  });</span></span>
<span id="cb10-385"><a href="#cb10-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-386"><a href="#cb10-386" aria-hidden="true" tabindex="-1"></a><span class="in">  return svg.node();</span></span>
<span id="cb10-387"><a href="#cb10-387" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb10-388"><a href="#cb10-388" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-389"><a href="#cb10-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-390"><a href="#cb10-390" aria-hidden="true" tabindex="-1"></a><span class="fu"># Color matter</span></span>
<span id="cb10-391"><a href="#cb10-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-392"><a href="#cb10-392" aria-hidden="true" tabindex="-1"></a>I deliver here a cartography by proportional passports (sic). And yeah, on this map, the surface of the passports represented is proportional to their power, that is to say to the number of countries they allow to reach without prior visa (in 2019 before the Covid epidemic19). And as absurd as it may seem, when it comes to international mobility, color matters. If you have a red passport, be aware that you will be able to travel easily to an average of 135 countries. If you have a blue passport, it will give you access to 103 countries. With a black passport, you will be able to reach 88 countries. And if by misfortune you have a green passport, only 78 countries will open their doors to you. In addition, you should know that the most « powerful » passport in the world is the United Arab Emirates passport, which gives you access to 179 countries around the world (compared to 170 for a French passport). On the other hand, the least powerful passport is the Afghan passport, which gives access to only 35 countries.</span>
<span id="cb10-393"><a href="#cb10-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-394"><a href="#cb10-394" aria-hidden="true" tabindex="-1"></a>But still, you probably think it’s absurd to take the color of passports as a criterion, don’t you? And you’re not entirely wrong, even if these colors are not chosen at random. Red, for example, was chosen by the communist countries, you will easily understand why. But red is also the choice of all European countries except Croatia. The color green, for its part, was chosen by the majority of Muslim countries. As you know, green is the color of Islam. Blue is very present in America (North and South). And finally black passports are extremely rare. Only 7 countries use them.</span>
<span id="cb10-395"><a href="#cb10-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-396"><a href="#cb10-396" aria-hidden="true" tabindex="-1"></a>Eurasia, America, Muslim countries: in the end, these colors refer more or less to a regionalization of the World. More than the color of your passport, it is actually the place of your country in the world order that determines your ability to cross borders. In other words, regardless of whether you are a citizen of a powerful country rich in peace or a poor country in war, you will not have access to the same spatial opportunities. The first criterion to be entitled to international mobility is therefore above all to be born in a good place. No more and no less.</span>
<span id="cb10-397"><a href="#cb10-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-398"><a href="#cb10-398" aria-hidden="true" tabindex="-1"></a>Note: the data used here come from the website <span class="co">[</span><span class="ot">passportindex.org</span><span class="co">](passportindex.org)</span>. But other rankings exist with significantly different data. See for example <span class="co">[</span><span class="ot">henleypassportindex.com</span><span class="co">](henleypassportindex.com)</span>.</span>
<span id="cb10-399"><a href="#cb10-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-402"><a href="#cb10-402" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb10-403"><a href="#cb10-403" aria-hidden="true" tabindex="-1"></a><span class="in">visib = {</span></span>
<span id="cb10-404"><a href="#cb10-404" aria-hidden="true" tabindex="-1"></a><span class="in">  if (type == "p") {</span></span>
<span id="cb10-405"><a href="#cb10-405" aria-hidden="true" tabindex="-1"></a><span class="in">    var style1 = "visible";</span></span>
<span id="cb10-406"><a href="#cb10-406" aria-hidden="true" tabindex="-1"></a><span class="in">    var style2 = "hidden";</span></span>
<span id="cb10-407"><a href="#cb10-407" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb10-408"><a href="#cb10-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-409"><a href="#cb10-409" aria-hidden="true" tabindex="-1"></a><span class="in">  if (type == "c") {</span></span>
<span id="cb10-410"><a href="#cb10-410" aria-hidden="true" tabindex="-1"></a><span class="in">    var style1 = "hidden";</span></span>
<span id="cb10-411"><a href="#cb10-411" aria-hidden="true" tabindex="-1"></a><span class="in">    var style2 = "visible";</span></span>
<span id="cb10-412"><a href="#cb10-412" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb10-413"><a href="#cb10-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-414"><a href="#cb10-414" aria-hidden="true" tabindex="-1"></a><span class="in">  for (let i = 0; i &lt; 200; i++) {</span></span>
<span id="cb10-415"><a href="#cb10-415" aria-hidden="true" tabindex="-1"></a><span class="in">    simulation.tick();</span></span>
<span id="cb10-416"><a href="#cb10-416" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb10-417"><a href="#cb10-417" aria-hidden="true" tabindex="-1"></a><span class="in">  return [style1, style2];</span></span>
<span id="cb10-418"><a href="#cb10-418" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb10-419"><a href="#cb10-419" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-420"><a href="#cb10-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-423"><a href="#cb10-423" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb10-424"><a href="#cb10-424" aria-hidden="true" tabindex="-1"></a><span class="in">//| echo: true</span></span>
<span id="cb10-425"><a href="#cb10-425" aria-hidden="true" tabindex="-1"></a><span class="in">colors = new Map()</span></span>
<span id="cb10-426"><a href="#cb10-426" aria-hidden="true" tabindex="-1"></a><span class="in">  .set("red", "#c76f65")</span></span>
<span id="cb10-427"><a href="#cb10-427" aria-hidden="true" tabindex="-1"></a><span class="in">  .set("green", "#80bd6c")</span></span>
<span id="cb10-428"><a href="#cb10-428" aria-hidden="true" tabindex="-1"></a><span class="in">  .set("blue", "#698ec9")</span></span>
<span id="cb10-429"><a href="#cb10-429" aria-hidden="true" tabindex="-1"></a><span class="in">  .set("black", "#5c5959")</span></span>
<span id="cb10-430"><a href="#cb10-430" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-431"><a href="#cb10-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-434"><a href="#cb10-434" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb10-435"><a href="#cb10-435" aria-hidden="true" tabindex="-1"></a><span class="in">//| echo: true</span></span>
<span id="cb10-436"><a href="#cb10-436" aria-hidden="true" tabindex="-1"></a><span class="in">bycolor = Array.from(</span></span>
<span id="cb10-437"><a href="#cb10-437" aria-hidden="true" tabindex="-1"></a><span class="in">  d3.rollup(data, v =&gt; d3.mean(v, d =&gt; d.mobilityscore), d =&gt; d.color)</span></span>
<span id="cb10-438"><a href="#cb10-438" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb10-439"><a href="#cb10-439" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-440"><a href="#cb10-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-443"><a href="#cb10-443" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb10-444"><a href="#cb10-444" aria-hidden="true" tabindex="-1"></a><span class="in">//| echo: true</span></span>
<span id="cb10-445"><a href="#cb10-445" aria-hidden="true" tabindex="-1"></a><span class="in">nd2 = Array.from(d3.group(data, d =&gt; d.color)).map(d =&gt; d[1][0])</span></span>
<span id="cb10-446"><a href="#cb10-446" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-447"><a href="#cb10-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-450"><a href="#cb10-450" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb10-451"><a href="#cb10-451" aria-hidden="true" tabindex="-1"></a><span class="in">//| echo: true</span></span>
<span id="cb10-452"><a href="#cb10-452" aria-hidden="true" tabindex="-1"></a><span class="in">bycolor2 = d3.rollups(</span></span>
<span id="cb10-453"><a href="#cb10-453" aria-hidden="true" tabindex="-1"></a><span class="in">  data,</span></span>
<span id="cb10-454"><a href="#cb10-454" aria-hidden="true" tabindex="-1"></a><span class="in">  v =&gt; ({</span></span>
<span id="cb10-455"><a href="#cb10-455" aria-hidden="true" tabindex="-1"></a><span class="in">    nb: v.length,</span></span>
<span id="cb10-456"><a href="#cb10-456" aria-hidden="true" tabindex="-1"></a><span class="in">    score: d3.mean(v, d =&gt; d.mobilityscore)</span></span>
<span id="cb10-457"><a href="#cb10-457" aria-hidden="true" tabindex="-1"></a><span class="in">  }),</span></span>
<span id="cb10-458"><a href="#cb10-458" aria-hidden="true" tabindex="-1"></a><span class="in">  d =&gt; d.color</span></span>
<span id="cb10-459"><a href="#cb10-459" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb10-460"><a href="#cb10-460" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-461"><a href="#cb10-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-464"><a href="#cb10-464" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb10-465"><a href="#cb10-465" aria-hidden="true" tabindex="-1"></a><span class="in">//| echo: true</span></span>
<span id="cb10-466"><a href="#cb10-466" aria-hidden="true" tabindex="-1"></a><span class="in">hlp = {</span></span>
<span id="cb10-467"><a href="#cb10-467" aria-hidden="true" tabindex="-1"></a><span class="in">  if (type == "p") {</span></span>
<span id="cb10-468"><a href="#cb10-468" aria-hidden="true" tabindex="-1"></a><span class="in">    var t = "passport";</span></span>
<span id="cb10-469"><a href="#cb10-469" aria-hidden="true" tabindex="-1"></a><span class="in">  } else {</span></span>
<span id="cb10-470"><a href="#cb10-470" aria-hidden="true" tabindex="-1"></a><span class="in">    var t = "circle";</span></span>
<span id="cb10-471"><a href="#cb10-471" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb10-472"><a href="#cb10-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-473"><a href="#cb10-473" aria-hidden="true" tabindex="-1"></a><span class="in">  var txt =</span></span>
<span id="cb10-474"><a href="#cb10-474" aria-hidden="true" tabindex="-1"></a><span class="in">    "On this map, the\nsurface area of each\n " +</span></span>
<span id="cb10-475"><a href="#cb10-475" aria-hidden="true" tabindex="-1"></a><span class="in">    t +</span></span>
<span id="cb10-476"><a href="#cb10-476" aria-hidden="true" tabindex="-1"></a><span class="in">    " is proportional\nto the number of\ncountries it allows \nto go to in 2019\n(before\nCovid19).";</span></span>
<span id="cb10-477"><a href="#cb10-477" aria-hidden="true" tabindex="-1"></a><span class="in">  return txt.split("\n");</span></span>
<span id="cb10-478"><a href="#cb10-478" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb10-479"><a href="#cb10-479" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-480"><a href="#cb10-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-481"><a href="#cb10-481" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data Import &amp; handling</span></span>
<span id="cb10-482"><a href="#cb10-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-485"><a href="#cb10-485" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb10-486"><a href="#cb10-486" aria-hidden="true" tabindex="-1"></a><span class="in">//| echo: true</span></span>
<span id="cb10-487"><a href="#cb10-487" aria-hidden="true" tabindex="-1"></a><span class="in">radius = d3.scaleSqrt(</span></span>
<span id="cb10-488"><a href="#cb10-488" aria-hidden="true" tabindex="-1"></a><span class="in">  [0, d3.max(data, d =&gt; d.mobilityscore)],</span></span>
<span id="cb10-489"><a href="#cb10-489" aria-hidden="true" tabindex="-1"></a><span class="in">  [0, 5.6 * Math.sqrt(k)]</span></span>
<span id="cb10-490"><a href="#cb10-490" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb10-491"><a href="#cb10-491" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-492"><a href="#cb10-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-495"><a href="#cb10-495" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb10-496"><a href="#cb10-496" aria-hidden="true" tabindex="-1"></a><span class="in">simulation = d3</span></span>
<span id="cb10-497"><a href="#cb10-497" aria-hidden="true" tabindex="-1"></a><span class="in">  .forceSimulation(data)</span></span>
<span id="cb10-498"><a href="#cb10-498" aria-hidden="true" tabindex="-1"></a><span class="in">  .force("x", d3.forceX(d =&gt; projection(d.position)[0]))</span></span>
<span id="cb10-499"><a href="#cb10-499" aria-hidden="true" tabindex="-1"></a><span class="in">  .force("y", d3.forceY(d =&gt; projection(d.position)[1]))</span></span>
<span id="cb10-500"><a href="#cb10-500" aria-hidden="true" tabindex="-1"></a><span class="in">  .force("collide", d3.forceCollide(d =&gt; d.imgw / 2))</span></span>
<span id="cb10-501"><a href="#cb10-501" aria-hidden="true" tabindex="-1"></a><span class="in">  .stop()</span></span>
<span id="cb10-502"><a href="#cb10-502" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-503"><a href="#cb10-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-506"><a href="#cb10-506" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb10-507"><a href="#cb10-507" aria-hidden="true" tabindex="-1"></a><span class="in">//| echo: true</span></span>
<span id="cb10-508"><a href="#cb10-508" aria-hidden="true" tabindex="-1"></a><span class="in">data = passeports</span></span>
<span id="cb10-509"><a href="#cb10-509" aria-hidden="true" tabindex="-1"></a><span class="in">  .map((d) =&gt; {</span></span>
<span id="cb10-510"><a href="#cb10-510" aria-hidden="true" tabindex="-1"></a><span class="in">    const id = d.id;</span></span>
<span id="cb10-511"><a href="#cb10-511" aria-hidden="true" tabindex="-1"></a><span class="in">    const name = d.name;</span></span>
<span id="cb10-512"><a href="#cb10-512" aria-hidden="true" tabindex="-1"></a><span class="in">    const thumb =</span></span>
<span id="cb10-513"><a href="#cb10-513" aria-hidden="true" tabindex="-1"></a><span class="in">      "https://raw.githubusercontent.com/neocarto/resources/master/datasets/passports/outputs/thumb/" +</span></span>
<span id="cb10-514"><a href="#cb10-514" aria-hidden="true" tabindex="-1"></a><span class="in">      d.id.toLowerCase() +</span></span>
<span id="cb10-515"><a href="#cb10-515" aria-hidden="true" tabindex="-1"></a><span class="in">      ".png";</span></span>
<span id="cb10-516"><a href="#cb10-516" aria-hidden="true" tabindex="-1"></a><span class="in">    const color = d.color;</span></span>
<span id="cb10-517"><a href="#cb10-517" aria-hidden="true" tabindex="-1"></a><span class="in">    const mobilityscore = mobilyscore.get(d.id);</span></span>
<span id="cb10-518"><a href="#cb10-518" aria-hidden="true" tabindex="-1"></a><span class="in">    const feature = features.get(d.id);</span></span>
<span id="cb10-519"><a href="#cb10-519" aria-hidden="true" tabindex="-1"></a><span class="in">    return {</span></span>
<span id="cb10-520"><a href="#cb10-520" aria-hidden="true" tabindex="-1"></a><span class="in">      id,</span></span>
<span id="cb10-521"><a href="#cb10-521" aria-hidden="true" tabindex="-1"></a><span class="in">      position: feature &amp;&amp; feature.properties.position,</span></span>
<span id="cb10-522"><a href="#cb10-522" aria-hidden="true" tabindex="-1"></a><span class="in">      name: name,</span></span>
<span id="cb10-523"><a href="#cb10-523" aria-hidden="true" tabindex="-1"></a><span class="in">      thumb: thumb,</span></span>
<span id="cb10-524"><a href="#cb10-524" aria-hidden="true" tabindex="-1"></a><span class="in">      color: color,</span></span>
<span id="cb10-525"><a href="#cb10-525" aria-hidden="true" tabindex="-1"></a><span class="in">      mobilityscore: +mobilityscore,</span></span>
<span id="cb10-526"><a href="#cb10-526" aria-hidden="true" tabindex="-1"></a><span class="in">      imgw: Math.sqrt(+mobilityscore * k * 0.7),</span></span>
<span id="cb10-527"><a href="#cb10-527" aria-hidden="true" tabindex="-1"></a><span class="in">      imgh: Math.sqrt((+mobilityscore * k) / 0.7)</span></span>
<span id="cb10-528"><a href="#cb10-528" aria-hidden="true" tabindex="-1"></a><span class="in">    };</span></span>
<span id="cb10-529"><a href="#cb10-529" aria-hidden="true" tabindex="-1"></a><span class="in">  })</span></span>
<span id="cb10-530"><a href="#cb10-530" aria-hidden="true" tabindex="-1"></a><span class="in">  .filter(</span></span>
<span id="cb10-531"><a href="#cb10-531" aria-hidden="true" tabindex="-1"></a><span class="in">    (d) =&gt;</span></span>
<span id="cb10-532"><a href="#cb10-532" aria-hidden="true" tabindex="-1"></a><span class="in">      d.color == ch[0] ||</span></span>
<span id="cb10-533"><a href="#cb10-533" aria-hidden="true" tabindex="-1"></a><span class="in">      d.color == ch[1] ||</span></span>
<span id="cb10-534"><a href="#cb10-534" aria-hidden="true" tabindex="-1"></a><span class="in">      d.color == ch[2] ||</span></span>
<span id="cb10-535"><a href="#cb10-535" aria-hidden="true" tabindex="-1"></a><span class="in">      d.color == ch[3]</span></span>
<span id="cb10-536"><a href="#cb10-536" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb10-537"><a href="#cb10-537" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-538"><a href="#cb10-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-541"><a href="#cb10-541" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb10-542"><a href="#cb10-542" aria-hidden="true" tabindex="-1"></a><span class="in">// centroid -&gt; position</span></span>
<span id="cb10-543"><a href="#cb10-543" aria-hidden="true" tabindex="-1"></a><span class="in">features = new Map(</span></span>
<span id="cb10-544"><a href="#cb10-544" aria-hidden="true" tabindex="-1"></a><span class="in">  topojson</span></span>
<span id="cb10-545"><a href="#cb10-545" aria-hidden="true" tabindex="-1"></a><span class="in">    .feature(json, json.objects.countries)</span></span>
<span id="cb10-546"><a href="#cb10-546" aria-hidden="true" tabindex="-1"></a><span class="in">    .features.map(d =&gt; {</span></span>
<span id="cb10-547"><a href="#cb10-547" aria-hidden="true" tabindex="-1"></a><span class="in">      d.properties.position = d3.geoCentroid(</span></span>
<span id="cb10-548"><a href="#cb10-548" aria-hidden="true" tabindex="-1"></a><span class="in">        d.geometry.type == "Polygon" ? d : largestPolygon(d)</span></span>
<span id="cb10-549"><a href="#cb10-549" aria-hidden="true" tabindex="-1"></a><span class="in">      );</span></span>
<span id="cb10-550"><a href="#cb10-550" aria-hidden="true" tabindex="-1"></a><span class="in">      return d;</span></span>
<span id="cb10-551"><a href="#cb10-551" aria-hidden="true" tabindex="-1"></a><span class="in">    })</span></span>
<span id="cb10-552"><a href="#cb10-552" aria-hidden="true" tabindex="-1"></a><span class="in">    .map(d =&gt; [d.properties.ISO2, d])</span></span>
<span id="cb10-553"><a href="#cb10-553" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb10-554"><a href="#cb10-554" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-555"><a href="#cb10-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-558"><a href="#cb10-558" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb10-559"><a href="#cb10-559" aria-hidden="true" tabindex="-1"></a><span class="in">passeports = d3.csv(</span></span>
<span id="cb10-560"><a href="#cb10-560" aria-hidden="true" tabindex="-1"></a><span class="in">  "https://raw.githubusercontent.com/neocarto/resources/master/datasets/passports/outputs/ctrindex.csv"</span></span>
<span id="cb10-561"><a href="#cb10-561" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb10-562"><a href="#cb10-562" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-563"><a href="#cb10-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-566"><a href="#cb10-566" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb10-567"><a href="#cb10-567" aria-hidden="true" tabindex="-1"></a><span class="in">powerrank = d3.csv(</span></span>
<span id="cb10-568"><a href="#cb10-568" aria-hidden="true" tabindex="-1"></a><span class="in">  "https://raw.githubusercontent.com/neocarto/resources/master/datasets/passports/outputs/passport-power-rank-2019.csv"</span></span>
<span id="cb10-569"><a href="#cb10-569" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb10-570"><a href="#cb10-570" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-571"><a href="#cb10-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-574"><a href="#cb10-574" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb10-575"><a href="#cb10-575" aria-hidden="true" tabindex="-1"></a><span class="in">mobilyscore = new Map(powerrank.map(d =&gt; [d.id, +d.mobilityscore]))</span></span>
<span id="cb10-576"><a href="#cb10-576" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-577"><a href="#cb10-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-580"><a href="#cb10-580" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb10-581"><a href="#cb10-581" aria-hidden="true" tabindex="-1"></a><span class="in">json = d3.json(</span></span>
<span id="cb10-582"><a href="#cb10-582" aria-hidden="true" tabindex="-1"></a><span class="in">  "https://raw.githubusercontent.com/neocarto/resources/master/datasets/passports/outputs/countries.topojson"</span></span>
<span id="cb10-583"><a href="#cb10-583" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb10-584"><a href="#cb10-584" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-585"><a href="#cb10-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-586"><a href="#cb10-586" aria-hidden="true" tabindex="-1"></a><span class="fu"># Appendix</span></span>
<span id="cb10-587"><a href="#cb10-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-590"><a href="#cb10-590" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb10-591"><a href="#cb10-591" aria-hidden="true" tabindex="-1"></a><span class="in">callout = (g, value) =&gt; {</span></span>
<span id="cb10-592"><a href="#cb10-592" aria-hidden="true" tabindex="-1"></a><span class="in">  if (!value) return g.style("display", "none");</span></span>
<span id="cb10-593"><a href="#cb10-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-594"><a href="#cb10-594" aria-hidden="true" tabindex="-1"></a><span class="in">  g.style("display", null)</span></span>
<span id="cb10-595"><a href="#cb10-595" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("pointer-events", "none")</span></span>
<span id="cb10-596"><a href="#cb10-596" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("font", "10px sans-serif");</span></span>
<span id="cb10-597"><a href="#cb10-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-598"><a href="#cb10-598" aria-hidden="true" tabindex="-1"></a><span class="in">  const path = g</span></span>
<span id="cb10-599"><a href="#cb10-599" aria-hidden="true" tabindex="-1"></a><span class="in">    .selectAll("path")</span></span>
<span id="cb10-600"><a href="#cb10-600" aria-hidden="true" tabindex="-1"></a><span class="in">    .data([null])</span></span>
<span id="cb10-601"><a href="#cb10-601" aria-hidden="true" tabindex="-1"></a><span class="in">    .join("path")</span></span>
<span id="cb10-602"><a href="#cb10-602" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "white")</span></span>
<span id="cb10-603"><a href="#cb10-603" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke", "black");</span></span>
<span id="cb10-604"><a href="#cb10-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-605"><a href="#cb10-605" aria-hidden="true" tabindex="-1"></a><span class="in">  const text = g</span></span>
<span id="cb10-606"><a href="#cb10-606" aria-hidden="true" tabindex="-1"></a><span class="in">    .selectAll("text")</span></span>
<span id="cb10-607"><a href="#cb10-607" aria-hidden="true" tabindex="-1"></a><span class="in">    .data([null])</span></span>
<span id="cb10-608"><a href="#cb10-608" aria-hidden="true" tabindex="-1"></a><span class="in">    .join("text")</span></span>
<span id="cb10-609"><a href="#cb10-609" aria-hidden="true" tabindex="-1"></a><span class="in">    .call(text =&gt;</span></span>
<span id="cb10-610"><a href="#cb10-610" aria-hidden="true" tabindex="-1"></a><span class="in">      text</span></span>
<span id="cb10-611"><a href="#cb10-611" aria-hidden="true" tabindex="-1"></a><span class="in">        .selectAll("tspan")</span></span>
<span id="cb10-612"><a href="#cb10-612" aria-hidden="true" tabindex="-1"></a><span class="in">        .data((value + "").split(/\n/))</span></span>
<span id="cb10-613"><a href="#cb10-613" aria-hidden="true" tabindex="-1"></a><span class="in">        .join("tspan")</span></span>
<span id="cb10-614"><a href="#cb10-614" aria-hidden="true" tabindex="-1"></a><span class="in">        .attr("x", 0)</span></span>
<span id="cb10-615"><a href="#cb10-615" aria-hidden="true" tabindex="-1"></a><span class="in">        .attr("y", (d, i) =&gt; `${i * 1.1}em`)</span></span>
<span id="cb10-616"><a href="#cb10-616" aria-hidden="true" tabindex="-1"></a><span class="in">        .style("font-weight", (_, i) =&gt; (i ? null : "bold"))</span></span>
<span id="cb10-617"><a href="#cb10-617" aria-hidden="true" tabindex="-1"></a><span class="in">        .style("font-size", (_, i) =&gt; (i ? null : 12))</span></span>
<span id="cb10-618"><a href="#cb10-618" aria-hidden="true" tabindex="-1"></a><span class="in">        .text(d =&gt; d)</span></span>
<span id="cb10-619"><a href="#cb10-619" aria-hidden="true" tabindex="-1"></a><span class="in">    );</span></span>
<span id="cb10-620"><a href="#cb10-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-621"><a href="#cb10-621" aria-hidden="true" tabindex="-1"></a><span class="in">  const { x, y, width: w, height: h } = text.node().getBBox();</span></span>
<span id="cb10-622"><a href="#cb10-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-623"><a href="#cb10-623" aria-hidden="true" tabindex="-1"></a><span class="in">  text.attr("transform", `translate(${-w / 2},${15 - y})`);</span></span>
<span id="cb10-624"><a href="#cb10-624" aria-hidden="true" tabindex="-1"></a><span class="in">  path.attr(</span></span>
<span id="cb10-625"><a href="#cb10-625" aria-hidden="true" tabindex="-1"></a><span class="in">    "d",</span></span>
<span id="cb10-626"><a href="#cb10-626" aria-hidden="true" tabindex="-1"></a><span class="in">    `M${-w / 2 - 10},5H-5l5,-5l5,5H${w / 2 + 10}v${h + 20}h-${w + 20}z`</span></span>
<span id="cb10-627"><a href="#cb10-627" aria-hidden="true" tabindex="-1"></a><span class="in">  );</span></span>
<span id="cb10-628"><a href="#cb10-628" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb10-629"><a href="#cb10-629" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-630"><a href="#cb10-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-633"><a href="#cb10-633" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb10-634"><a href="#cb10-634" aria-hidden="true" tabindex="-1"></a><span class="in">//| echo: true</span></span>
<span id="cb10-635"><a href="#cb10-635" aria-hidden="true" tabindex="-1"></a><span class="in">import { checkbox, slider, radio } from "@jashkenas/inputs"</span></span>
<span id="cb10-636"><a href="#cb10-636" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-637"><a href="#cb10-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-640"><a href="#cb10-640" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb10-641"><a href="#cb10-641" aria-hidden="true" tabindex="-1"></a><span class="in">//| echo: true</span></span>
<span id="cb10-642"><a href="#cb10-642" aria-hidden="true" tabindex="-1"></a><span class="in">path = d3.geoPath(projection)</span></span>
<span id="cb10-643"><a href="#cb10-643" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-644"><a href="#cb10-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-647"><a href="#cb10-647" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb10-648"><a href="#cb10-648" aria-hidden="true" tabindex="-1"></a><span class="in">projection = d3.geoPatterson()</span></span>
<span id="cb10-649"><a href="#cb10-649" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-650"><a href="#cb10-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-653"><a href="#cb10-653" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb10-654"><a href="#cb10-654" aria-hidden="true" tabindex="-1"></a><span class="in">// To fit svg width according to the projection (from @d3/projection-comparison)</span></span>
<span id="cb10-655"><a href="#cb10-655" aria-hidden="true" tabindex="-1"></a><span class="in">height = {</span></span>
<span id="cb10-656"><a href="#cb10-656" aria-hidden="true" tabindex="-1"></a><span class="in">  const [[x0, y0], [x1, y1]] = d3</span></span>
<span id="cb10-657"><a href="#cb10-657" aria-hidden="true" tabindex="-1"></a><span class="in">    .geoPath(projection.fitWidth(width, sphere))</span></span>
<span id="cb10-658"><a href="#cb10-658" aria-hidden="true" tabindex="-1"></a><span class="in">    .bounds(sphere);</span></span>
<span id="cb10-659"><a href="#cb10-659" aria-hidden="true" tabindex="-1"></a><span class="in">  const dy = Math.ceil(y1 - y0),</span></span>
<span id="cb10-660"><a href="#cb10-660" aria-hidden="true" tabindex="-1"></a><span class="in">    l = Math.min(Math.ceil(x1 - x0), dy);</span></span>
<span id="cb10-661"><a href="#cb10-661" aria-hidden="true" tabindex="-1"></a><span class="in">  projection.scale((projection.scale() * (l - 1)) / l).precision(0.2);</span></span>
<span id="cb10-662"><a href="#cb10-662" aria-hidden="true" tabindex="-1"></a><span class="in">  return dy;</span></span>
<span id="cb10-663"><a href="#cb10-663" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb10-664"><a href="#cb10-664" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-665"><a href="#cb10-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-668"><a href="#cb10-668" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb10-669"><a href="#cb10-669" aria-hidden="true" tabindex="-1"></a><span class="in">sphere = ({ type: "Sphere" })</span></span>
<span id="cb10-670"><a href="#cb10-670" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-671"><a href="#cb10-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-674"><a href="#cb10-674" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb10-675"><a href="#cb10-675" aria-hidden="true" tabindex="-1"></a><span class="in">// To put circles in the largest polygon (from @xangregg/proportional-geographic-scatterplot-by-country)</span></span>
<span id="cb10-676"><a href="#cb10-676" aria-hidden="true" tabindex="-1"></a><span class="in">largestPolygon = function(d) {</span></span>
<span id="cb10-677"><a href="#cb10-677" aria-hidden="true" tabindex="-1"></a><span class="in">  var best = {};</span></span>
<span id="cb10-678"><a href="#cb10-678" aria-hidden="true" tabindex="-1"></a><span class="in">  var bestArea = 0;</span></span>
<span id="cb10-679"><a href="#cb10-679" aria-hidden="true" tabindex="-1"></a><span class="in">  d.geometry.coordinates.forEach(function(coords) {</span></span>
<span id="cb10-680"><a href="#cb10-680" aria-hidden="true" tabindex="-1"></a><span class="in">    var poly = { type: 'Polygon', coordinates: coords };</span></span>
<span id="cb10-681"><a href="#cb10-681" aria-hidden="true" tabindex="-1"></a><span class="in">    var area = d3.geoArea(poly);</span></span>
<span id="cb10-682"><a href="#cb10-682" aria-hidden="true" tabindex="-1"></a><span class="in">    if (area &gt; bestArea) {</span></span>
<span id="cb10-683"><a href="#cb10-683" aria-hidden="true" tabindex="-1"></a><span class="in">      bestArea = area;</span></span>
<span id="cb10-684"><a href="#cb10-684" aria-hidden="true" tabindex="-1"></a><span class="in">      best = poly;</span></span>
<span id="cb10-685"><a href="#cb10-685" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb10-686"><a href="#cb10-686" aria-hidden="true" tabindex="-1"></a><span class="in">  });</span></span>
<span id="cb10-687"><a href="#cb10-687" aria-hidden="true" tabindex="-1"></a><span class="in">  return best;</span></span>
<span id="cb10-688"><a href="#cb10-688" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb10-689"><a href="#cb10-689" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-690"><a href="#cb10-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-693"><a href="#cb10-693" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb10-694"><a href="#cb10-694" aria-hidden="true" tabindex="-1"></a><span class="in">topojson = require("topojson@3")</span></span>
<span id="cb10-695"><a href="#cb10-695" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-696"><a href="#cb10-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-699"><a href="#cb10-699" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb10-700"><a href="#cb10-700" aria-hidden="true" tabindex="-1"></a><span class="in">d3 = require("d3@6", "d3-geo-projection@2")</span></span>
<span id="cb10-701"><a href="#cb10-701" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
<!-- -->
</section>
</main>
<div class="page-navigation ">
  <div class="nav-page nav-page-previous">
  </div>
  <div class="nav-page nav-page-next">
  </div>
</div>
</div> <!-- /main column -->
</div> <!-- /row -->
</div> <!-- /container fluid -->
<script type="text/javascript">

// replace cmd keyboard shortcut w/ control on non-Mac platforms
const kPlatformMac = typeof navigator !== 'undefined' ? /Mac/.test(navigator.platform) : false;
if (!kPlatformMac) {
   var kbds = document.querySelectorAll("kbd")
   kbds.forEach(function(kbd) {
      kbd.innerHTML = kbd.innerHTML.replace(/⌘/g, '⌃');
   });
}

</script>
<script type="ojs-module-contents">
{"contents":[{"methodName":"interpret","cellName":"ojs-cell-1","inline":false,"source":"viewof ch = checkbox({\n  title: \"Passport color:\",\n  options: [\n    { value: \"red\", label: \"Red\" },\n    { value: \"green\", label: \"Green\" },\n    { value: \"blue\", label: \"Blue\" },\n    { value: \"black\", label: \"Black\" }\n  ],\n  value: [\"red\", \"green\", \"blue\", \"black\"],\n  submit: false\n})\n\nviewof type = radio({\n  title: \"Representation:\",\n  options: [\n    { label: 'Passports', value: 'p' },\n    { label: 'Circles', value: 'c' }\n  ],\n  value: 'p'\n})\n\nviewof k = slider({\n  title: \"Symbol size:\",\n  min: 1,\n  max: 10,\n  value: 3,\n  step: 1\n})"},{"methodName":"interpret","cellName":"ojs-cell-2","inline":false,"source":"map = {\n  for (let i = 0; i < 200; i++) {\n    simulation.tick();\n  }\n\n  const svg = d3\n    .create(\"svg\")\n    .attr(\"viewBox\", [0, 0, width, height])\n    .style(\"width\", \"100%\")\n    .style(\"height\", \"auto\");\n\n  // Defs\n\n  var defs = svg.append(\"defs\");\n\n  const pattern = defs\n    .append(\"pattern\")\n    .attr(\"id\", \"hatch\")\n    .attr(\"patternUnits\", \"userSpaceOnUse\")\n    .attr(\"width\", 6)\n    .attr(\"height\", 6);\n\n  pattern\n    .append(\"line\")\n    .attr(\"x1\", 0)\n    .attr(\"y1\", 0)\n    .attr(\"x2\", 6)\n    .attr(\"y1\", 6)\n    .attr(\"stroke\", \"white\")\n    .attr(\"stroke-width\", 1)\n    .attr(\"stroke-opacity\", 0.7);\n\n  // Sphere\n\n  svg\n    .append(\"rect\")\n    .attr(\"opacity\", 1)\n    .attr(\"x\", 0)\n    .attr(\"y\", 0)\n    .attr(\"width\", width)\n    .attr(\"height\", height)\n    .style('fill', \"#9ACBE3\")\n    .attr(\"opacity\", 0.8);\n\n  svg\n    .append(\"rect\")\n    .attr(\"fill-opacity\", 0.4)\n    .attr(\"x\", 0)\n    .attr(\"y\", height - 60)\n    .attr(\"width\", width)\n    .attr(\"height\", 60)\n    .attr('fill', \"white\");\n\n  svg\n    .append(\"rect\")\n    .attr(\"fill-opacity\", 0.4)\n    .attr(\"x\", 0)\n    .attr(\"y\", 0)\n    .attr(\"width\", width)\n    .attr(\"height\", height)\n    .attr('fill', \"url('#hatch')\");\n\n  // Countries\n\n  svg\n    .append(\"path\")\n    .datum(topojson.feature(json, json.objects.countries))\n    .attr(\"fill\", \"white\")\n    .style('fill-opacity', 0.7)\n    .attr(\"d\", path);\n\n  // Passeports images\n\n  svg\n    .append(\"g\")\n    .selectAll(\"image\")\n    .data(data.sort((a, b) => d3.descending(a.mobilityscore, b.mobilityscore)))\n    .join(\"image\")\n    .attr(\"class\", \"pasp\")\n    .attr(\"xlink:href\", d => d.thumb)\n    .attr('width', d => d.imgw)\n    .attr('height', d => d.imgh)\n    .attr(\"x\", d => d.x - d.imgw / 2)\n    .attr(\"y\", d => d.y - d.imgh / 2)\n    .attr(\"style\", \"border: 5px solid #555\")\n    .style(\"visibility\", visib[0]);\n\n  // Test\n\n  svg\n    .selectAll('image')\n    .data(data)\n    .enter()\n    .append('image')\n    .attr(\"xlink:href\", d => d.thumb)\n    .attr('width', d => d.imgw)\n    .attr('height', d => d.imgh)\n    .attr(\"x\", d => d.x - d.imgw / 2)\n    .attr(\"y\", d => d.y - d.imgh / 2);\n\n  // Passeports circles\n\n  svg\n    .append(\"g\")\n    .selectAll(\"circle\")\n    .data(data.sort((a, b) => d3.descending(a.mobilityscore, b.mobilityscore)))\n    .join(\"circle\")\n    .attr(\"class\", \"pasp\")\n    .attr(\"r\", d => radius(d.mobilityscore))\n    .attr(\"cx\", d => d.x)\n    .attr(\"cy\", d => d.y)\n    .attr(\"fill\", d => colors.get(d.color))\n    .attr(\"stroke\", \"#404752\")\n    .attr(\"stroke-width\", 0)\n    .style(\"visibility\", visib[1]);\n\n  // Title\n\n  svg\n    .append(\"text\")\n    .attr(\"x\", width / 2)\n    .attr(\"y\", height - 17)\n    .text(\"GLOBAL PASSPORT POWER RANK\")\n    .attr(\"text-anchor\", \"middle\")\n    .attr(\"font-family\", \"sans-serif\")\n    .attr(\"fill\", \"#5c658a\")\n    .attr(\"fill-opacity\", 0.3)\n    .style(\"font-size\", \"45px\");\n\n  // Chart\n\n  svg\n    .append(\"text\")\n    .attr(\"x\", 10)\n    .attr(\"y\", 410)\n    .text(\"The Power of Colors\")\n    .attr(\"font-family\", \"sans-serif\")\n    .attr(\"font-weight\", \"bold\")\n    .attr(\"fill\", \"#4a524d\")\n    .style(\"font-size\", \"21px\");\n\n  const x1 = 10;\n  const y1 = 430;\n  const barheight = 2;\n\n  svg\n    .selectAll(\".chart\")\n    .data(bycolor)\n    .join(\"rect\")\n    .attr('height', barheight)\n    .attr('width', d => d[1] * 5)\n    .attr('y', function(d, i) {\n      return y1 + i * 7 * barheight;\n    })\n    .attr('x', x1)\n    .attr('class', \"chart\")\n    .attr(\"fill\", d => colors.get(d[0]))\n    .attr(\"opacity\", 1);\n\n  svg\n    .selectAll(\".charttxt\")\n    .data(bycolor)\n    .join(\"text\")\n    .attr('x', 10)\n    .attr('y', function(d, i) {\n      return y1 + i * 7 * barheight - 3;\n    })\n    .text(\n      d =>\n        \"People with \" +\n        d[0] +\n        \" passports can travel to an average of \" +\n        Math.round(d[1]) +\n        \" countries\"\n    )\n    .attr(\"font-family\", \"sans-serif\")\n    .attr(\"fill\", \"#545252\")\n    .style(\"font-size\", \"9px\");\n\n  // Tooltip\n\n  const tooltip = svg.append(\"g\");\n\n  tooltip.style(\"visibility\", \"hidden\");\n\n  tooltip\n    .append(\"image\")\n    .attr(\"class\", \"tooltipimg\")\n    .attr('width', 70)\n    .attr('height', 100)\n    .attr(\"x\", 10)\n    .attr(\"y\", 32);\n\n  tooltip\n    .append(\"text\")\n    .attr(\"class\", \"tooltipname\")\n    .attr(\"x\", 10)\n    .attr(\"y\", 22)\n    .attr(\"font-family\", \"sans-serif\")\n    .attr(\"font-weight\", \"bold\")\n    .attr(\"fill\", \"#4a524d\")\n    .style(\"font-size\", \"21px\");\n\n  const y = 145;\n\n  tooltip\n    .append(\"text\")\n    .attr(\"x\", 10)\n    .attr(\"y\", y)\n    .text(\"With this passport\")\n    .attr(\"font-family\", \"sans-serif\")\n    .attr(\"fill\", \"#4a524d\")\n    .style(\"font-size\", \"12px\");\n\n  tooltip\n    .append(\"text\")\n    .attr(\"x\", 10)\n    .attr(\"y\", y + 12)\n    .text(\"you can reach\")\n    .attr(\"font-family\", \"sans-serif\")\n    .attr(\"fill\", \"#4a524d\")\n    .style(\"font-size\", \"12px\");\n\n  tooltip\n    .append(\"text\")\n    .attr(\"class\", \"tooltiptxt\")\n    .attr(\"x\", 10)\n    .attr(\"y\", y + 24)\n    .attr(\"font-family\", \"sans-serif\")\n    .attr(\"font-weight\", \"bold\")\n    .attr(\"fill\", \"#4a524d\")\n    .style(\"font-size\", \"12px\");\n\n  tooltip\n    .append(\"text\")\n    .attr(\"class\", \"tooltiptxt\")\n    .attr(\"x\", 10)\n    .attr(\"y\", y + 36)\n    .text(\"without prior visa\")\n    .attr(\"font-family\", \"sans-serif\")\n    .attr(\"fill\", \"#4a524d\")\n    .style(\"font-size\", \"12px\");\n\n  tooltip\n    .append(\"text\")\n    .attr(\"class\", \"tooltiptxt\")\n    .attr(\"x\", 10)\n    .attr(\"y\", y + 48)\n    .text(\"(in 2019 before Covid19)\")\n    .attr(\"font-family\", \"sans-serif\")\n    .attr(\"fill\", \"#4a524d\")\n    .style(\"font-size\", \"12px\");\n\n  svg\n    .selectAll(\".pasp\")\n    .on(\"touchmove mousemove\", function(event, d) {\n      d3.select(this)\n        .attr(\"stroke-width\", 2)\n        .raise();\n      tooltip.style(\"visibility\", \"visible\");\n      svg.select(\".tooltipimg\").attr(\"xlink:href\", d.thumb);\n      svg.select(\".tooltipname\").text(d.name);\n      svg.select(\".tooltiptxt\").text(d.mobilityscore + \" countries\");\n    })\n    .on(\"touchend mouseleave\", function() {\n      tooltip.style(\"visibility\", \"hidden\");\n      d3.select(this)\n        .attr(\"stroke-width\", 0)\n        .lower();\n    });\n\n  // Sources\n\n  var source = svg\n    .append(\"text\")\n    .attr(\"x\", width / 2)\n    .attr(\"y\", height - 5)\n    .attr(\"text-anchor\", \"middle\")\n    .text(\n      \"Map designed by Nicolas Lambert, 2020 - Data Source: https://www.passportindex.org (2019 data before covid19) - Behind this map: see https://observablehq.com/@neocartocnrs/passeports-colors\"\n    )\n    .attr(\"font-family\", \"sans-serif\")\n    .style(\"font-size\", \"10px\")\n    .style(\"font-style\", \"italic\")\n    .attr(\"fill\", \"#5c658a\")\n    .attr(\"fill-opacity\", 0.6);\n\n  svg\n    .append(\"circle\")\n    .attr(\"fill\", \"white\")\n    .attr(\"cx\", width)\n    .attr(\"cy\", 0)\n    .attr(\"r\", 150)\n    .attr(\"opacity\", 0.4);\n\n  svg\n    .append(\"circle\")\n    .attr(\"fill\", \"white\")\n    .attr(\"cx\", width)\n    .attr(\"cy\", 0)\n    .attr(\"r\", 160)\n    .attr(\"opacity\", 0.4);\n\n  svg\n    .append(\"circle\")\n    .attr(\"fill\", \"white\")\n    .attr(\"cx\", width)\n    .attr(\"cy\", 0)\n    .attr(\"r\", 170)\n    .attr(\"opacity\", 0.4);\n\n  var help = svg\n    .append(\"text\")\n    .attr(\"y\", 5)\n    .attr(\"font-family\", \"sans-serif\")\n    .attr(\"font-weight\", \"bold\")\n    .attr(\"fill\", \"#3e4657\")\n    .style(\"font-size\", \"11px\")\n    .attr(\"fill-opacity\", 0.4)\n    .attr(\"text-anchor\", \"end\")\n    .attr(\"font-family\", \"sans-serif\");\n\n  hlp.forEach(d => {\n    help\n      .append(\"tspan\")\n      .attr(\"x\", width - 10)\n      .attr(\"dy\", 15)\n      .text(d);\n  });\n\n  return svg.node();\n}"},{"methodName":"interpret","cellName":"ojs-cell-3","inline":false,"source":"visib = {\n  if (type == \"p\") {\n    var style1 = \"visible\";\n    var style2 = \"hidden\";\n  }\n\n  if (type == \"c\") {\n    var style1 = \"hidden\";\n    var style2 = \"visible\";\n  }\n\n  for (let i = 0; i < 200; i++) {\n    simulation.tick();\n  }\n  return [style1, style2];\n}"},{"methodName":"interpret","cellName":"ojs-cell-4","inline":false,"source":"colors = new Map()\n  .set(\"red\", \"#c76f65\")\n  .set(\"green\", \"#80bd6c\")\n  .set(\"blue\", \"#698ec9\")\n  .set(\"black\", \"#5c5959\")"},{"methodName":"interpret","cellName":"ojs-cell-5","inline":false,"source":"bycolor = Array.from(\n  d3.rollup(data, v => d3.mean(v, d => d.mobilityscore), d => d.color)\n)"},{"methodName":"interpret","cellName":"ojs-cell-6","inline":false,"source":"nd2 = Array.from(d3.group(data, d => d.color)).map(d => d[1][0])"},{"methodName":"interpret","cellName":"ojs-cell-7","inline":false,"source":"bycolor2 = d3.rollups(\n  data,\n  v => ({\n    nb: v.length,\n    score: d3.mean(v, d => d.mobilityscore)\n  }),\n  d => d.color\n)"},{"methodName":"interpret","cellName":"ojs-cell-8","inline":false,"source":"hlp = {\n  if (type == \"p\") {\n    var t = \"passport\";\n  } else {\n    var t = \"circle\";\n  }\n\n  var txt =\n    \"On this map, the\\nsurface area of each\\n \" +\n    t +\n    \" is proportional\\nto the number of\\ncountries it allows \\nto go to in 2019\\n(before\\nCovid19).\";\n  return txt.split(\"\\n\");\n}"},{"methodName":"interpret","cellName":"ojs-cell-9","inline":false,"source":"radius = d3.scaleSqrt(\n  [0, d3.max(data, d => d.mobilityscore)],\n  [0, 5.6 * Math.sqrt(k)]\n)"},{"methodName":"interpret","cellName":"ojs-cell-10","inline":false,"source":"simulation = d3\n  .forceSimulation(data)\n  .force(\"x\", d3.forceX(d => projection(d.position)[0]))\n  .force(\"y\", d3.forceY(d => projection(d.position)[1]))\n  .force(\"collide\", d3.forceCollide(d => d.imgw / 2))\n  .stop()"},{"methodName":"interpret","cellName":"ojs-cell-11","inline":false,"source":"data = passeports\n  .map((d) => {\n    const id = d.id;\n    const name = d.name;\n    const thumb =\n      \"https://raw.githubusercontent.com/neocarto/resources/master/datasets/passports/outputs/thumb/\" +\n      d.id.toLowerCase() +\n      \".png\";\n    const color = d.color;\n    const mobilityscore = mobilyscore.get(d.id);\n    const feature = features.get(d.id);\n    return {\n      id,\n      position: feature && feature.properties.position,\n      name: name,\n      thumb: thumb,\n      color: color,\n      mobilityscore: +mobilityscore,\n      imgw: Math.sqrt(+mobilityscore * k * 0.7),\n      imgh: Math.sqrt((+mobilityscore * k) / 0.7)\n    };\n  })\n  .filter(\n    (d) =>\n      d.color == ch[0] ||\n      d.color == ch[1] ||\n      d.color == ch[2] ||\n      d.color == ch[3]\n  )"},{"methodName":"interpret","cellName":"ojs-cell-12","inline":false,"source":"// centroid -> position\nfeatures = new Map(\n  topojson\n    .feature(json, json.objects.countries)\n    .features.map(d => {\n      d.properties.position = d3.geoCentroid(\n        d.geometry.type == \"Polygon\" ? d : largestPolygon(d)\n      );\n      return d;\n    })\n    .map(d => [d.properties.ISO2, d])\n)"},{"methodName":"interpret","cellName":"ojs-cell-13","inline":false,"source":"passeports = d3.csv(\n  \"https://raw.githubusercontent.com/neocarto/resources/master/datasets/passports/outputs/ctrindex.csv\"\n)"},{"methodName":"interpret","cellName":"ojs-cell-14","inline":false,"source":"powerrank = d3.csv(\n  \"https://raw.githubusercontent.com/neocarto/resources/master/datasets/passports/outputs/passport-power-rank-2019.csv\"\n)"},{"methodName":"interpret","cellName":"ojs-cell-15","inline":false,"source":"mobilyscore = new Map(powerrank.map(d => [d.id, +d.mobilityscore]))"},{"methodName":"interpret","cellName":"ojs-cell-16","inline":false,"source":"json = d3.json(\n  \"https://raw.githubusercontent.com/neocarto/resources/master/datasets/passports/outputs/countries.topojson\"\n)"},{"methodName":"interpret","cellName":"ojs-cell-17","inline":false,"source":"callout = (g, value) => {\n  if (!value) return g.style(\"display\", \"none\");\n\n  g.style(\"display\", null)\n    .style(\"pointer-events\", \"none\")\n    .style(\"font\", \"10px sans-serif\");\n\n  const path = g\n    .selectAll(\"path\")\n    .data([null])\n    .join(\"path\")\n    .attr(\"fill\", \"white\")\n    .attr(\"stroke\", \"black\");\n\n  const text = g\n    .selectAll(\"text\")\n    .data([null])\n    .join(\"text\")\n    .call(text =>\n      text\n        .selectAll(\"tspan\")\n        .data((value + \"\").split(/\\n/))\n        .join(\"tspan\")\n        .attr(\"x\", 0)\n        .attr(\"y\", (d, i) => `${i * 1.1}em`)\n        .style(\"font-weight\", (_, i) => (i ? null : \"bold\"))\n        .style(\"font-size\", (_, i) => (i ? null : 12))\n        .text(d => d)\n    );\n\n  const { x, y, width: w, height: h } = text.node().getBBox();\n\n  text.attr(\"transform\", `translate(${-w / 2},${15 - y})`);\n  path.attr(\n    \"d\",\n    `M${-w / 2 - 10},5H-5l5,-5l5,5H${w / 2 + 10}v${h + 20}h-${w + 20}z`\n  );\n}"},{"methodName":"interpret","cellName":"ojs-cell-18","inline":false,"source":"import { checkbox, slider, radio } from \"@jashkenas/inputs\""},{"methodName":"interpret","cellName":"ojs-cell-19","inline":false,"source":"path = d3.geoPath(projection)"},{"methodName":"interpret","cellName":"ojs-cell-20","inline":false,"source":"projection = d3.geoPatterson()"},{"methodName":"interpret","cellName":"ojs-cell-21","inline":false,"source":"// To fit svg width according to the projection (from @d3/projection-comparison)\nheight = {\n  const [[x0, y0], [x1, y1]] = d3\n    .geoPath(projection.fitWidth(width, sphere))\n    .bounds(sphere);\n  const dy = Math.ceil(y1 - y0),\n    l = Math.min(Math.ceil(x1 - x0), dy);\n  projection.scale((projection.scale() * (l - 1)) / l).precision(0.2);\n  return dy;\n}"},{"methodName":"interpret","cellName":"ojs-cell-22","inline":false,"source":"sphere = ({ type: \"Sphere\" })"},{"methodName":"interpret","cellName":"ojs-cell-23","inline":false,"source":"// To put circles in the largest polygon (from @xangregg/proportional-geographic-scatterplot-by-country)\nlargestPolygon = function(d) {\n  var best = {};\n  var bestArea = 0;\n  d.geometry.coordinates.forEach(function(coords) {\n    var poly = { type: 'Polygon', coordinates: coords };\n    var area = d3.geoArea(poly);\n    if (area > bestArea) {\n      bestArea = area;\n      best = poly;\n    }\n  });\n  return best;\n}"},{"methodName":"interpret","cellName":"ojs-cell-24","inline":false,"source":"topojson = require(\"topojson@3\")"},{"methodName":"interpret","cellName":"ojs-cell-25","inline":false,"source":"d3 = require(\"d3@6\", \"d3-geo-projection@2\")"},{"methodName":"interpretQuiet","source":"shinyInput('ch')"},{"methodName":"interpretQuiet","source":"shinyInput('type')"},{"methodName":"interpretQuiet","source":"shinyInput('k')"}]}
</script>
<script type="module">
window._ojs.paths.runtimeToDoc = "../../docs/interactive/js/examples2";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "../../../..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>


</body></html>